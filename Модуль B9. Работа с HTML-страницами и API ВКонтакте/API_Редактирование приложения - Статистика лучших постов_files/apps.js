!function(e){function t(t){for(var n,a,s=t[0],c=t[1],l=t[2],d=0,u=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&u.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(p&&p(t);u.length;)u.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={"web/apps":0},i=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var p=c;i.push([113,"vendors","common","145f605746e8e55e54cfd5bb0b7dca57","15942e60c2552d8c9c8d9c9d8dcedf2e"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return f})),r.d(t,"connectAdvanced",(function(){return T})),r.d(t,"ReactReduxContext",(function(){return l})),r.d(t,"connect",(function(){return ne})),r.d(t,"batch",(function(){return de.unstable_batchedUpdates})),r.d(t,"useDispatch",(function(){return ae})),r.d(t,"useSelector",(function(){return le})),r.d(t,"useStore",(function(){return ie})),r.d(t,"shallowEqual",(function(){return k}));var n=r("JX7q"),o=r("dI71"),i=r("q1tI"),a=r.n(i),s=r("17x9"),c=r.n(s),l=a.a.createContext(null);var p=function(e){e()},d={notify:function(){}};function u(){var e=p,t=[],r=[];return{clear:function(){r=null,t=null},notify:function(){var n=t=r;e((function(){for(var e=0;e<n.length;e++)n[e]()}))},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&null!==t&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}}var _=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=d,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=u())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=d)},e}(),h=function(e){function t(t){var r;r=e.call(this,t)||this;var o=t.store;r.notifySubscribers=r.notifySubscribers.bind(Object(n.default)(r));var i=new _(o);return i.onStateChange=r.notifySubscribers,r.state={store:o,subscription:i},r.previousState=o.getState(),r}Object(o.default)(t,e);var r=t.prototype;return r.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},r.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},r.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new _(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},r.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},r.render=function(){var e=this.props.context||l;return a.a.createElement(e.Provider,{value:this.state},this.props.children)},t}(i.Component);h.propTypes={store:c.a.shape({subscribe:c.a.func.isRequired,dispatch:c.a.func.isRequired,getState:c.a.func.isRequired}),context:c.a.object,children:c.a.any};var f=h,m=r("wx14"),g=r("zLVn"),b=r("2mql"),v=r.n(b),E=r("QLaP"),w=r.n(E),O=r("TOwV"),y=[],C=[null,null];function S(e,t){var r=e[1];return[t.payload,r+1]}var A=function(){return[null,0]},P="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect;function T(e,t){void 0===t&&(t={});var r=t,n=r.getDisplayName,o=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,s=r.methodName,c=void 0===s?"connectAdvanced":s,p=r.renderCountProp,d=void 0===p?void 0:p,u=r.shouldHandleStateChanges,h=void 0===u||u,f=r.storeKey,b=void 0===f?"store":f,E=r.withRef,T=void 0!==E&&E,R=r.forwardRef,D=void 0!==R&&R,k=r.context,M=void 0===k?l:k,I=Object(g.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);w()(void 0===d,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),w()(!T,"withRef is removed. To access the wrapped instance, use a ref on the connected component");w()("store"===b,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var L=M;return function(t){var r=t.displayName||t.name||"Component",n=o(r),s=Object(m.default)({},I,{getDisplayName:o,methodName:c,renderCountProp:d,shouldHandleStateChanges:h,storeKey:b,displayName:n,wrappedComponentName:r,WrappedComponent:t}),l=I.pure;var p=l?i.useMemo:function(e){return e()};function u(r){var o=Object(i.useMemo)((function(){var e=r.forwardedRef,t=Object(g.default)(r,["forwardedRef"]);return[r.context,e,t]}),[r]),c=o[0],l=o[1],d=o[2],u=Object(i.useMemo)((function(){return c&&c.Consumer&&Object(O.isContextConsumer)(a.a.createElement(c.Consumer,null))?c:L}),[c,L]),f=Object(i.useContext)(u),b=Boolean(r.store),v=Boolean(f)&&Boolean(f.store);w()(b||v,'Could not find "store" in the context of "'+n+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+n+" in connect options.");var E=r.store||f.store,T=Object(i.useMemo)((function(){return function(t){return e(t.dispatch,s)}(E)}),[E]),R=Object(i.useMemo)((function(){if(!h)return C;var e=new _(E,b?null:f.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[E,b,f]),D=R[0],k=R[1],M=Object(i.useMemo)((function(){return b?f:Object(m.default)({},f,{subscription:D})}),[b,f,D]),I=Object(i.useReducer)(S,y,A),x=I[0][0],N=I[1];if(x&&x.error)throw x.error;var B=Object(i.useRef)(),j=Object(i.useRef)(d),W=Object(i.useRef)(),U=Object(i.useRef)(!1),H=p((function(){return W.current&&d===j.current?W.current:T(E.getState(),d)}),[E,x,d]);P((function(){j.current=d,B.current=H,U.current=!1,W.current&&(W.current=null,k())})),P((function(){if(h){var e=!1,t=null,r=function(){if(!e){var r,n,o=E.getState();try{r=T(o,j.current)}catch(e){n=e,t=e}n||(t=null),r===B.current?U.current||k():(B.current=r,W.current=r,U.current=!0,N({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};D.onStateChange=r,D.trySubscribe(),r();return function(){if(e=!0,D.tryUnsubscribe(),t)throw t}}}),[E,D,T]);var K=Object(i.useMemo)((function(){return a.a.createElement(t,Object(m.default)({},H,{ref:l}))}),[l,t,H]);return Object(i.useMemo)((function(){return h?a.a.createElement(u.Provider,{value:M},K):K}),[u,K,M])}var f=l?a.a.memo(u):u;if(f.WrappedComponent=t,f.displayName=n,D){var E=a.a.forwardRef((function(e,t){return a.a.createElement(f,Object(m.default)({},e,{forwardedRef:t}))}));return E.displayName=n,E.WrappedComponent=t,v()(E,t)}return v()(f,t)}}var R=Object.prototype.hasOwnProperty;function D(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function k(e,t){if(D(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!R.call(t,r[o])||!D(e[r[o]],t[r[o]]))return!1;return!0}var M=r("ANjH");function I(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function L(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function x(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=L(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=L(o),o=n(t,r)),o},n}}var N=[function(e){return"function"==typeof e?x(e):void 0},function(e){return e?void 0:I((function(e){return{dispatch:e}}))},function(e){return e&&"object"==typeof e?I((function(t){return Object(M.bindActionCreators)(e,t)})):void 0}];var B=[function(e){return"function"==typeof e?x(e):void 0},function(e){return e?void 0:I((function(){return{}}))}];function j(e,t,r){return Object(m.default)({},r,e,t)}var W=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,i=r.areMergedPropsEqual,a=!1;return function(t,r,s){var c=e(t,r,s);return a?o&&i(c,n)||(n=c):(a=!0,n=c),n}}}(e):void 0},function(e){return e?void 0:function(){return j}}];function U(e,t,r,n){return function(o,i){return r(e(o,i),t(n,i),i)}}function H(e,t,r,n,o){var i,a,s,c,l,p=o.areStatesEqual,d=o.areOwnPropsEqual,u=o.areStatePropsEqual,_=!1;function h(o,_){var h,f,m=!d(_,a),g=!p(o,i);return i=o,a=_,m&&g?(s=e(i,a),t.dependsOnOwnProps&&(c=t(n,a)),l=r(s,c,a)):m?(e.dependsOnOwnProps&&(s=e(i,a)),t.dependsOnOwnProps&&(c=t(n,a)),l=r(s,c,a)):g?(h=e(i,a),f=!u(h,s),s=h,f&&(l=r(s,c,a)),l):l}return function(o,p){return _?h(o,p):(s=e(i=o,a=p),c=t(n,a),l=r(s,c,a),_=!0,l)}}function K(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,i=Object(g.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),a=r(e,i),s=n(e,i),c=o(e,i);return(i.pure?H:U)(a,s,c,e,i)}function F(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function V(e,t){return e===t}var G,q,z,Y,X,$,Z,J,Q,ee,te,re,ne=(z=(q=void 0===G?{}:G).connectHOC,Y=void 0===z?T:z,X=q.mapStateToPropsFactories,$=void 0===X?B:X,Z=q.mapDispatchToPropsFactories,J=void 0===Z?N:Z,Q=q.mergePropsFactories,ee=void 0===Q?W:Q,te=q.selectorFactory,re=void 0===te?K:te,function(e,t,r,n){void 0===n&&(n={});var o=n,i=o.pure,a=void 0===i||i,s=o.areStatesEqual,c=void 0===s?V:s,l=o.areOwnPropsEqual,p=void 0===l?k:l,d=o.areStatePropsEqual,u=void 0===d?k:d,_=o.areMergedPropsEqual,h=void 0===_?k:_,f=Object(g.default)(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),b=F(e,$,"mapStateToProps"),v=F(t,J,"mapDispatchToProps"),E=F(r,ee,"mergeProps");return Y(re,Object(m.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:b,initMapDispatchToProps:v,initMergeProps:E,pure:a,areStatesEqual:c,areOwnPropsEqual:p,areStatePropsEqual:u,areMergedPropsEqual:h},f))});function oe(){var e=Object(i.useContext)(l);return w()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ie(){return oe().store}function ae(){return ie().dispatch}var se="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,ce=function(e,t){return e===t};function le(e,t){void 0===t&&(t=ce),w()(e,"You must pass a selector to useSelectors");var r,n=oe(),o=n.store,a=n.subscription,s=Object(i.useReducer)((function(e){return e+1}),0)[1],c=Object(i.useMemo)((function(){return new _(o,a)}),[o,a]),l=Object(i.useRef)(),p=Object(i.useRef)(),d=Object(i.useRef)();try{r=e!==p.current||l.current?e(o.getState()):d.current}catch(e){var u="An error occured while selecting the store state: "+e.message+".";throw l.current&&(u+="\nThe error may be correlated with this previous error:\n"+l.current.stack+"\n\nOriginal stack trace:"),new Error(u)}return se((function(){p.current=e,d.current=r,l.current=void 0})),se((function(){function e(){try{var e=p.current(o.getState());if(t(e,d.current))return;d.current=e}catch(e){l.current=e}s({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[o,c]),r}var pe,de=r("i8i4");pe=de.unstable_batchedUpdates,p=pe},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),i=r("/MKj"),a=r("ANjH"),s=r("dImZ"),c=r.n(s),l=r("/TnQ"),p=r("sINF"),d=r("xYVc"),u=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n};function _(e){var t=e.present.background,r=t.currentBackgroundType,n=t.currentPhotoUrl,o=t.currentBackgroundId,i="";if(r===d.default.BACKGROUND_MODES.PHOTO)i=n||"";else{var a=e.present.data.backgrounds,s=a.gradients,c=a.emojies;i=u(s,c).filter((function(e){return e.id===o}))[0].url}return i}function h(e){var t=e.present.data,r=t.addons,n=t.artboardHeight,o=n;return r&&r.photoHeight&&(o=r.photoHeight),n/2-o/2}var f,m="SET_SETTING_COLOR_CORRECTION",g="SET_SETTING_FILTER_AMOUNT",b="SET_SETTING_BLUR_SIZE",v="SET_SETTING_BLUR_POSITION",E="SET_LAYER_FONT_SIZE",w=function(){return(w=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},O={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:d.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},y=function(e,t){switch(void 0===e&&(e=O),t.type){case"SET_DATA_LOADED":return w(w({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return w(w({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return w(w({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return w(w({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return w(w({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return w(w({},e),{stickerHeaderScrollPosition:t.value});default:return e}},C=function(){return(C=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},S={color:d.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:d.default.FONTS[0],filter:{name:d.default.PHOTO_FILTERS[0],value:.5},colorCorrection:{exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},blur:{isEnabled:!1,form:d.default.BLUR_TYPES.ROUND,size:50,position:[.5,.5]},isAutoCorrection:!1,cropAspect:d.default.CROP_ASPECT_FREE,isCropped:!1,flipX:!1,flipY:!1,rotation:0},A=function(e,t){var r;switch(void 0===e&&(e=S),t.type){case"SET_SETTING_COLOR":return C(C({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return C(C({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return C(C({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return C(C({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return C(C({},e),{fontStyle:t.fontStyle});case m:return C(C({},e),{colorCorrection:C(C({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case"SET_SETTING_FILTER":return C(C({},e),{filter:C(C({},e.filter),{name:t.name})});case g:return C(C({},e),{filter:C(C({},e.filter),{value:t.value})});case"SET_SETTING_BLUR_ENABLE":return C(C({},e),{blur:C(C({},e.blur),{isEnabled:t.isEnabled})});case"SET_SETTING_BLUR_FORM":return C(C({},e),{blur:C(C({},e.blur),{form:t.form})});case b:return C(C({},e),{blur:C(C({},e.blur),{size:t.size})});case v:return C(C({},e),{blur:C(C({},e.blur),{position:t.position})});case"SET_SETTING_AUTO_CORRECTION":return C(C({},e),{isAutoCorrection:t.isAutoCorrection});case"SET_SETTING_CROP_ASPECT":return C(C({},e),{cropAspect:t.aspect});case"SET_SETTING_CROPPED":return C(C({},e),{isCropped:t.isCropped});case"SET_SETTING_FLIP_X":return C(C({},e),{flipX:t.value});case"SET_SETTING_FLIP_Y":return C(C({},e),{flipY:t.value});case"SET_SETTING_ROTATE":return C(C({},e),{rotation:t.value});default:return e}},P=function(){return(P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},T=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},R={currentIndex:null,items:[{canvas:document.createElement("canvas"),type:d.default.LAYER_TYPES.BACKGROUND,width:1,height:1,isBackground:!0,locked:!0,x:0,y:0,rotate:0,canDelete:!1,scale:1,avgColor:{r:128,g:128,b:128}}]},D=function(e,t){switch(void 0===e&&(e=R),t.type){case"SET_CURRENT_LAYER":return P(P({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return P(P({},e),{items:T(e.items,[t.payload])});case"SET_LAYER_POSITION":case"SET_LAYER_SCALE":case"SET_LAYER_COLOR":case E:case"SET_LAYER_FONT_STYLE":case"SET_LAYER_TEXT":case"TOGGLE_TEXT_EDITOR":return P(P({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?P(P({},r),t.payload):r}))});case"START_LAYER_SCALE":return P({},e);case"UPDATE_BACKGROUND_LAYER":return P(P({},e),{items:e.items.map((function(e,r){return 0===r?P(P({},e),t.payload):e}))});case"DELETE_LAYER":return P(P({},e),{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))});case"UPDATE_LAYERS_AFTER_CROP":return P(P({},e),{items:t.items});default:return e}},k=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},M=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return k(e,[t.payload]);case"UPDATE_DRAWING":return t.payload;default:return e}},I=function(){return(I=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},L={currentBackgroundType:d.default.BACKGROUND_MODES.BACKGROUND,currentPhotoUrl:null,currentBackgroundId:1},x=function(e,t){switch(void 0===e&&(e=L),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return I(I({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return I(I({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return I(I({},e),{currentBackgroundId:t.value});default:return e}},N=function(){return(N=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},B=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return N(N({},e),t.payload);default:return e}},j=!1;var W=c()(Object(a.combineReducers)({ui:y,settings:A,layers:D,drawings:M,background:x,data:B}),{limit:100,syncFilter:!0,filter:Object(s.combineFilters)(Object(s.includeAction)([m,b,v,"SET_SETTING_BLUR_ENABLE","SET_SETTING_BLUR_FORM","SET_SETTING_AUTO_CORRECTION","SET_SETTING_FILTER",g,"ADD_LAYER_STICKER","ADD_LAYER_TEXT","DELETE_LAYER","ADD_VECTOR","SET_CURRENT_BACKGROUND_TYPE","SET_CURRENT_PHOTO_URL","SET_CURRENT_BACKGROUND_ID","SET_LAYER_COLOR",E,"SET_LAYER_FONT_STYLE","TOGGLE_TEXT_EDITOR","SET_SHOW_DROP_BOX","START_LAYER_SCALE"]),(function(e){return"TOGGLE_TEXT_EDITOR"===e.type?e.payload.isEdit:"SET_SHOW_DROP_BOX"===e.type?e.value:![m,g,b,v,E].includes(e.type)||(e.type!==f?(j=!1,f=e.type,!0):!j&&(j=!0,setTimeout((function(){j=!1}),500),!0))}))}),U=r("ufMw"),H=r("nAFc"),K=r("jE6c"),F=function(e){return{type:"SET_CURRENT_LAYER",index:e}},V=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var i=o().present.layers.items;n({type:e,payload:t}),r&&n(F(i.length))}},G=function(e,t){return function(r,n){var o,i=n().present,a=i.data,s=i.settings,c=h(n()),l=a.artboardWidth/2,p=a.artboardHeight/2-c,u=Object(H.decodeHTMLEntities)(a.placeholders[Object(K.irand)(0,a.placeholders.length-1)]),_=0,f=!1,m=s.fontStyle,g=s.color,b=s.fontSize,v=1;t&&(l=void 0!==t.x?t.x:l,p=void 0!==t.y?t.y:p,u=void 0!==t.text?t.text:u,_=void 0!==t.rotate?t.rotate:_,f=void 0!==t.isEdit?t.isEdit:f,m=void 0!==t.style?t.style:m,g=void 0!==t.color?t.color:g,b=void 0!==t.fontSize?t.fontSize:b,o=t.initialFontSize,v=void 0!==t.scale?t.scale:v),Object(U.sendStat)(U.EVENTS.ADD_TEXT),e&&r(Z(d.default.TABS.TEXT)),r(V("ADD_LAYER_TEXT",{type:d.default.LAYER_TYPES.TEXT,text:u,x:l,y:p,rotate:_,isEdit:f,fontSize:b,initialFontSize:o,fontStyle:m,color:g,scale:v,canDelete:!0},e))}},q=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"TOGGLE_TEXT_EDITOR",payload:{isEdit:e}})}},z=function(e){return{type:"UPDATE_BACKGROUND_LAYER",payload:e}},Y=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&(i.type===d.default.LAYER_TYPES.STICKER?Object(U.sendStat)(U.EVENTS.DELETE_STICKER):i.type===d.default.LAYER_TYPES.TEXT&&Object(U.sendStat)(U.EVENTS.DELETE_TEXT),e($(!1)),e({type:"DELETE_LAYER",index:n}))}}},X=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&i.type===d.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(q(!1)):e(Y()))}}},$=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},Z=function(e){return function(t,r){var n=r().present.layers,o=n.items,i=n.currentIndex;null!==i&&(o[i].type===d.default.LAYER_TYPES.TEXT&&t(X()),[d.default.TABS.PAINT,d.default.TABS.FILTERS,d.default.TABS.COLOR,d.default.TABS.CROP].includes(e)&&t(F(null))),t({type:"SET_CURRENT_TAB",value:e})}},J=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_COLOR",payload:{color:e}})}}(e)),t({type:"SET_SETTING_COLOR",color:e})}},Q=function(e){return{type:"SET_SETTING_CROP_ASPECT",aspect:e}},ee=function(e){return{type:"SET_CURRENT_BACKGROUND_TYPE",value:e}},te=function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}},re=function(e){return{type:"SET_DATA",payload:e}},ne=function(e){return function(t){Object(i.batch)((function(){var r;e.hasOwnProperty("url")&&t(te(e.url)),e.hasOwnProperty("data")&&t(re(e.data)),e.hasOwnProperty("isCropped")&&t({type:"SET_SETTING_CROPPED",isCropped:e.isCropped}),e.hasOwnProperty("flipX")&&t((r=e.flipX,Object(U.sendStat)(U.EVENTS.FLIP_X),{type:"SET_SETTING_FLIP_X",value:r})),e.hasOwnProperty("flipY")&&t(function(e){return Object(U.sendStat)(U.EVENTS.FLIP_Y),{type:"SET_SETTING_FLIP_Y",value:e}}(e.flipY)),e.hasOwnProperty("rotate")&&t(function(e){return{type:"SET_SETTING_ROTATE",value:e}}(e.rotate)),e.hasOwnProperty("layers")&&t({type:"UPDATE_LAYERS_AFTER_CROP",items:e.layers}),e.hasOwnProperty("drawings")&&t(function(e){return{type:"UPDATE_DRAWING",payload:e}}(e.drawings))}))}},oe=r("i8i4");function ie(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function ae(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0,width:0,height:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top,i=r.width,a=r.height;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o,width:i,height:a}}function se(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function ce(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],i=URL.createObjectURL(o);ie(i).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,i=2;i<o;){if(n.getUint16(i+2,!1)<=8)return t(-1);var a=n.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=n.getUint32(i+=2,!1))return t(-1);var s=18761==n.getUint16(i+=6,!1);i+=n.getUint32(i+4,s);var c=n.getUint16(i,s);i+=2;for(var l=0;l<c;l++)if(274==n.getUint16(i+12*l,s))return t(n.getUint16(i+12*l+8,s))}else{if(65280!=(65280&a))break;i+=n.getUint16(i,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(i):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,i=o.height,a=document.createElement("canvas"),s=a.getContext("2d");if(!s)return n();switch(4<t&&t<9?(a.width=i,a.height=e):(a.width=e,a.height=i),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,i);break;case 4:s.transform(1,0,0,-1,0,i);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,i,0);break;case 7:s.transform(0,-1,-1,0,i,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(a.toDataURL())},o.src=e}))}(i,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function le(e,t,r,n,o,i,a){var s=0,c=0;switch(e){case"left_top":s=n+i,c=o+a;break;case"left_center":s=n+i,c=r/2+a;break;case"left_bottom":s=n+i,c=r-o+a;break;case"center_top":s=t/2+i,c=o+a;break;case"center":s=t/2+i,c=r/2+a;break;case"center_bottom":s=t/2+i,c=r-o+a;break;case"right_top":s=t-n+i,c=o+a;break;case"right_center":s=t-n+i,c=r/2+a;break;case"right_bottom":s=t-n+i,c=r-o+a}return{x:s,y:c}}function pe(e,t,r){var n=e.getContext("2d");n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgb(30, 30, 30)",n.fillRect(0,0,e.width,e.height),n.save(),n.filter="blur(135px)",n.drawImage(t,0,0,e.width,e.height),n.restore(),"none"!==n.filter&&(n.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",n.fillRect(0,0,e.width,e.height)))}var de,ue=r("ZxpX"),_e=(de=function(e,t){return(de=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}de(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),he=function(e){function t(t){var r=e.call(this,t)||this;return r.renderDrawings=function(){var e=r.props.drawings,t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*d.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=se(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===d.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=ae(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var i=r.props.settings;r.props.addDrawing({color:i.color,width:i.brushWidth,opacity:i.brushOpacity,path:r.currentDrawing}),r.renderDrawings()}},r.drawProcess=function(e){var t=ae(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings()},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvas=n.createRef(),r.currentDrawing=[],r}return _e(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height,i=e.ui,a=Object(ue.classNames)("EditorCanvas__canvas","EditorCanvas__canvas--draw",{"EditorCanvas__canvas--disabled":i.currentMode!==d.default.TABS.PAINT});return n.createElement("canvas",{ref:this.canvas,className:a,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t.prototype.componentDidMount=function(){this.renderDrawings()},t.prototype.componentDidUpdate=function(){this.renderDrawings()},t}(n.PureComponent),fe={addDrawing:function(e){return Object(U.sendStat)(U.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}},addLayerText:G},me=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,drawings:e.present.drawings,data:e.present.data}}),fe)(he),ge=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):ie(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),be="WebGL context not found",ve="Create texture failed",Ee="Shader compile failed",we="Create program failed",Oe="Incomplete framebuffer",ye="Filter not found",Ce=function(e,t,r){var n=e.createShader(r);if(!n)throw new Error(Ee);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(""+e.getShaderInfoLog(n));this.shader=n},Se=function(){function e(e,t,r){if(!e)throw new Error(be);var n=e.createTexture();if(!n)throw new Error(ve);this.texture=n,e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&r&&this.updateSize(e,t,r),e.bindTexture(e.TEXTURE_2D,null)}return e.prototype.attachImage=function(e,t){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.updateSize=function(e,t,r){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.use=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},e.unuse=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.destroy=function(e){e.deleteTexture(this.texture)},e}(),Ae=r("t7n3"),Pe=function(){function e(e,t,r){if(!e)throw new Error(be);var n=new Ce(e,t,e.VERTEX_SHADER).shader,o=new Ce(e,r,e.FRAGMENT_SHADER).shader;this.gl=e,this.program=this.createProgram(n,o),this.framebuffer=e.createFramebuffer()}return e.prototype.createProgram=function(e,t){var r=this.gl.createProgram();if(!r)throw new Error(we);if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(""+this.gl.getProgramInfoLog(r));return r},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e.prototype.attribute=function(e,t){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)},e.prototype.uniforms=function(e){for(var t in this.gl.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=this.gl.getUniformLocation(this.program,t),n=e[t];if(Array.isArray(n))switch(n.length){case 1:this.gl.uniform1fv(r,new Float32Array(n));break;case 2:this.gl.uniform2fv(r,new Float32Array(n));break;case 3:this.gl.uniform3fv(r,new Float32Array(n));break;case 4:this.gl.uniform4fv(r,new Float32Array(n))}else Object(Ae.isNumber)(n)&&this.gl.uniform1f(r,n)}},e.prototype.textures=function(e,t){var r=this;this.gl.useProgram(this.program),e.forEach((function(e,n){t?(e.use(r.gl,n),r.gl.uniform1i(r.gl.getUniformLocation(r.program,"u_image"+n),n)):Se.unuse(r.gl,n)}))},e.prototype.draw=function(e,t){this.gl.useProgram(this.program),t&&(t.updateSize(this.gl,e.width,e.height),this.bindTexture(t.texture)),this.gl.canvas.width=e.width,this.gl.canvas.height=e.height,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);var r=e.width,n=e.height;this.attribute("a_position",[0,0,r,0,0,n,0,n,r,0,r,n]),this.attribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]),this.uniforms(Object.assign(e.uniforms,{u_resolution:[e.width,e.height]})),e.textures&&this.textures(e.textures,!0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6),e.textures&&this.textures(e.textures,!1),t&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.prototype.bindTexture=function(e,t){if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),t){var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE){var n="";switch(r){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:n="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:n="There is no attachment.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:n="Height and width of the attachment are not the same.";break;case this.gl.FRAMEBUFFER_UNSUPPORTED:n="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer."}throw new Error(Oe+". "+n)}}},e}(),Te="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n",Re=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},De={regular:"/images/filters/maps/regular.png",nox:"/images/filters/maps/nox.png",vesper:"/images/filters/maps/vesper.png",latona:"/images/filters/maps/latona.png",liber:"/images/filters/maps/liber.png",luna:"/images/filters/maps/luna.png",minerva:"/images/filters/maps/minerva.png",mitra:"/images/filters/maps/mitra.png",pro:"/images/filters/maps/pro.png",terra:"/images/filters/maps/terra.png",veles:"/images/filters/maps/veles.png",vesta:"/images/filters/maps/vesta.png",zaria:"/images/filters/maps/zaria.png",sepia:"/images/filters/maps/sepia.png",genius:"/images/filters/maps/genius.png",horus:"/images/filters/maps/horus.png",fortuna:"/images/filters/maps/fortuna.png"},ke=["/images/filters/maps/contrast_negative.png","/images/filters/maps/contrast_positive.png","/images/filters/maps/exposure_negative.png","/images/filters/maps/exposure_positive.png","/images/filters/maps/warm_negative_lut.png","/images/filters/maps/warm_positive_lut.png"];var Me=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},Ie={preserveDrawingBuffer:!0,premultipliedAlpha:!1},Le=document.createElement("canvas"),xe=Le.getContext("webgl",Ie)||Le.getContext("experimental-webgl",Ie),Ne={},Be=function(){function e(){this.baseColorCorrectionProgram=new Pe(xe,Te,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0; // image\nuniform sampler2D u_image1; // contrast_negative.png\nuniform sampler2D u_image2; // contrast_positive.png\nuniform sampler2D u_image3; // exposure_negative.png\nuniform sampler2D u_image4; // exposure_positive.png\nuniform sampler2D u_image5; // warm_negative_lut.png\nuniform sampler2D u_image6; // warm_positive_lit.png\nuniform sampler2D u_image7; // color table\n\nuniform float u_exposure;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_warmth;\nuniform float u_amount;\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\n\treturn conColor;\n}\n\nfloat BF_SoftLight(float base, float blend) {\n\treturn 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\n}\n\nvec3 BF_SoftLight(vec3 base, vec3 blend) {\n\treturn vec3(BF_SoftLight(base.r, blend.r), BF_SoftLight(base.g, blend.g), BF_SoftLight(base.b, blend.b));\n}\n\nvec3 Exposure(vec3 view, float intensity) {\n\tvec3 exposure1;\n\texposure1.r = texture2D(u_image3, vec2(view.r, 0.5)).r;\n\texposure1.g = texture2D(u_image3, vec2(view.g, 0.5)).g;\n\texposure1.b = texture2D(u_image3, vec2(view.b, 0.5)).b;\n\n\tvec3 exposure2;\n\texposure2.r = texture2D(u_image4, vec2(view.r, 0.5)).r;\n\texposure2.g = texture2D(u_image4, vec2(view.g, 0.5)).g;\n\texposure2.b = texture2D(u_image4, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, exposure2, intensity);\n\t} else {\n\t\tresult = mix(view, exposure1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Contrast(vec3 view, float intensity) {\n\tvec3 contrast1;\n\tcontrast1.r = texture2D(u_image1, vec2(view.r, 0.5)).r;\n\tcontrast1.g = texture2D(u_image1, vec2(view.g, 0.5)).g;\n\tcontrast1.b = texture2D(u_image1, vec2(view.b, 0.5)).b;\n\n\tvec3 contrast2;\n\tcontrast2.r = texture2D(u_image2, vec2(view.r, 0.5)).r;\n\tcontrast2.g = texture2D(u_image2, vec2(view.g, 0.5)).g;\n\tcontrast2.b = texture2D(u_image2, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, contrast2, intensity);\n\t} else {\n\t\tresult = mix(view, contrast1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 ColorTemp(vec3 view, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec3 coldColor1 = texture2D(u_image5, texPos1).rgb;\n\tvec3 coldColor2 = texture2D(u_image5, texPos2).rgb;\n\tvec3 coldColor = mix(coldColor1, coldColor2, fract(blueColor));\n\n\tvec3 warmColor1 = texture2D(u_image6, texPos1).rgb;\n\tvec3 warmColor2 = texture2D(u_image6, texPos2).rgb;\n\tvec3 warmColor = mix(warmColor1, warmColor2, fract(blueColor));\n\n\tvec3 result;\n\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, warmColor, intensity);\n\t} else {\n\t\tresult = mix(view, coldColor, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Saturation(vec3 view, float intensity) {\n\treturn ContrastSaturationBrightness(view, 1.0, intensity, 1.0);\n}\n\nvec3 Lut(vec3 view, sampler2D tex, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec3 newColor1 = texture2D(tex, texPos1).rgb;\n\tvec3 newColor2 = texture2D(tex, texPos2).rgb;\n\n\tvec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\tvec3 color = mix(view, newColor, intensity);\n\n\treturn color;\n}\n\n// [-1.0; 1.0]\nvec3 pExposure(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Exposure(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pContrast(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Contrast(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pColorTemp(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn ColorTemp(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pSaturation(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.6);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? 1.0 + (range.y - 1.0) * intensity : range.x + (1.0 - range.x) * (intensity + 1.0);\n\treturn Saturation(view, intensity);\n}\n\n// [0.0; 1.0]\nvec3 pLut(vec3 view,sampler2D tex, float intensity) {\n\tvec2 range = vec2(0.0, 1.0);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\treturn Lut(view, tex, intensity);\n}\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 texture = texture2D(u_image0, texelCoord);\n\n\ttexture.rgb = pColorTemp(texture.rgb, u_warmth);\n\ttexture.rgb = pLut(texture.rgb, u_image7, u_amount);\n\ttexture.rgb = pExposure(texture.rgb, u_exposure);\n\ttexture.rgb = pContrast(texture.rgb, u_contrast);\n\ttexture.rgb = pSaturation(texture.rgb, u_saturation);\n\n\tgl_FragColor = texture;\n}\n"),this.postProcessProgram=new Pe(xe,Te,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0;\n\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_grain;\n\nuniform vec2 u_sourceSize;\n\nvec4 rnm(in vec2 tc) {\n\tfloat timer = 0.4;\n\tfloat noise = sin(dot(tc + vec2(timer, timer), vec2(12.9898, 78.233))) * 43758.5453;\n\n\tfloat noiseR = fract(noise) * 2.0 - 1.0;\n\tfloat noiseG = fract(noise * 1.2154) * 2.0 - 1.0;\n\tfloat noiseB = fract(noise * 1.3453) * 2.0 - 1.0;\n\tfloat noiseA = fract(noise * 1.3647) * 2.0 - 1.0;\n\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\n\nfloat fade(in float t) {\n\treturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = 0.00195313 * floor(p) + 0.00195313;\n\tvec3 pf = fract(p); // Fractional part for interpolation\n\n\t// Noise contributions from (x=0, y=0), z=0 and z=1\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3  grad001 = rnm(vec2(perm00, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=0, y=1), z=0 and z=1\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, 0.00195313)).a ;\n\tvec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3  grad011 = rnm(vec2(perm01, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\n\t// Noise contributions from (x=1, y=0), z=0 and z=1\n\tfloat perm10 = rnm(pi.xy + vec2(0.00195313, 0.0)).a ;\n\tvec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3  grad101 = rnm(vec2(perm10, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=1, y=1), z=0 and z=1\n\tfloat perm11 = rnm(pi.xy + vec2(0.00195313, 0.00195313)).a ;\n\tvec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3  grad111 = rnm(vec2(perm11, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\n\t// Blend contributions along x\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\n\t// Blend contributions along y\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\n\t// Blend contributions along z\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\n\t// We're done, return the final noise value.\n\treturn n_xyz;\n}\n\n//2d coordinate orientation thing\nvec2 coordRot(in vec2 tc, in float angle) {\n\tfloat aspect = u_sourceSize.x / u_sourceSize.y;\n\tvec2 uv = (tc * 2.0) - 1.0;\n\tfloat rotX = (uv.x * aspect * cos(angle)) - (uv.y * sin(angle));\n\tfloat rotY = (uv.y * cos(angle)) + (uv.x * aspect * sin(angle));\n\trotX = ((rotX / aspect) * 0.5 + 0.5);\n\trotY = rotY * 0.5 + 0.5;\n\treturn vec2(rotX, rotY);\n}\n\nvec3 BF_Multiply(vec3 base, vec3 blend) {\n\treturn base * blend;\n}\n\nfloat BF_Screen(float base, float blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 BF_Screen(vec3 base, vec3 blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 Sharpness(vec3 view, float intensity) {\n\tvec2 uv = v_texCoord;\n\tvec2 step = 1.0 / u_sourceSize;\n\n\tvec3 texA = texture2D(u_image0, uv + vec2(-step.x, -step.y) * 1.0).rgb;\n\tvec3 texB = texture2D(u_image0, uv + vec2( step.x, -step.y) * 1.0).rgb;\n\tvec3 texC = texture2D(u_image0, uv + vec2(-step.x,  step.y) * 1.0).rgb;\n\tvec3 texD = texture2D(u_image0, uv + vec2( step.x,  step.y) * 1.0).rgb;\n\n\tvec3 around = 0.25 * (texA + texB + texC + texD);\n\tvec3 center  = texture2D(u_image0, uv ).rgb;\n\tvec3 col = center + (center - around) * intensity;\n\n\treturn col;\n}\n\nvec3 Grain(vec3 view, float intensity) {\n\tvec2 texCoord = v_texCoord;\n\n\tfloat timer = 0.4;\n\tfloat coloramount = 0.4;\n\tfloat grainsize = 2.0;\n\tfloat lumamount = 0.3;\n\n\tbool colored = true;\n\n\tvec3 rotOffset = vec3(1.425, 3.892, 5.835); // rotation offset values\n\tvec2 rotCoordsR = coordRot(texCoord, timer + rotOffset.x);\n\tvec3 noise = vec3(pnoise3D(vec3(rotCoordsR * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 0.0)));\n\n\tif (colored) {\n\t\tvec2 rotCoordsG = coordRot(texCoord, timer + rotOffset.y);\n\t\tvec2 rotCoordsB = coordRot(texCoord, timer + rotOffset.z);\n\t\tnoise.g = mix(noise.r, pnoise3D(vec3(rotCoordsG * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 1.0)), coloramount);\n\t\tnoise.b = mix(noise.r, pnoise3D(vec3(rotCoordsB * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 2.0)), coloramount);\n\t}\n\n\tvec3 col = view.rgb;\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat luminance = lumamount * dot(col, lumcoeff);\n\tfloat lum = smoothstep(0.2, 0.0, luminance);\n\n\tlum += luminance;\n\tnoise = mix(noise, vec3(0.0), pow(lum, 4.0));\n\tcol = col + noise * intensity;\n\n\treturn col;\n}\n\nvec3 Vignette(vec3 view, float intensity) {\n\tfloat inten = abs(intensity);\n\tfloat dist = distance(v_texCoord, vec2(0.5, 0.5));\n\tfloat size = 0.5 - inten * 0.4;\n\tfloat amount = inten * inten * 0.1 + 0.5 * inten;\n\tfloat vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n\treturn (intensity >= 0.0) ? view * vignette : BF_Screen(view,vec3(1.0-vignette));\n}\n\n// [-1; 1]\nvec3 pSharpness(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.5);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity+1.0) + range.x;\n\treturn Sharpness(view, intensity);\n}\n\n// [0; 1]\nvec3 pGrain(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 0.2);\n\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Grain(view, intensity);\n}\n\n// [-1; 1]\nvec3 pVignette(vec3 view, float intensity) {\n\tvec2 range = vec2(-1.0, 1.0);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Vignette(view, intensity);\n}\n\nvoid main() {\n\tvec4 texture = texture2D(u_image0, v_texCoord);\n\n\ttexture.rgb = pSharpness(texture.rgb, u_sharpness);\n\ttexture.rgb = pVignette(texture.rgb, u_vignette);\n\ttexture.rgb = pGrain(texture.rgb, u_grain);\n\n\tgl_FragColor = texture;\n}\n"),this.flippedProgram=new Pe(xe,Te,"precision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = texture2D(u_texture, vec2(v_texCoord.x, 1.0 - v_texCoord.y));\n\tgl_FragColor = color;\n}\n"),this.triangleBlurProgram=new Pe(xe,Te,"precision mediump float;\n\nuniform sampler2D u_image0; // original image\nuniform vec2 u_delta;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = vec4(0.0);\n\tfloat total = 0.0;\n\tfloat offset = fract(sin(dot(gl_FragCoord.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453);\n\n\tfor (float t = -30.0; t <= 30.0; t++) {\n\t\tfloat percent = (t + offset - 0.5) / 30.0;\n\t\tfloat weight = 1.0 - abs(percent);\n\t\tvec4 sampleColor = texture2D(u_image0, v_texCoord + u_delta * percent);\n\t\tsampleColor.rgb *= sampleColor.a;\n\n\t\tcolor += sampleColor * weight;\n\t\ttotal += weight;\n\t}\n\n\tcolor = color / total;\n\tcolor.rgb /= color.a + 0.00001;\n\tgl_FragColor = color;\n}\n"),this.roundBlurProgram=new Pe(xe,Te,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tfloat distanceFromCenter = distance(u_position, texelCoord);\n\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.3 - 0.2, 0.3, distanceFromCenter), 0.0, 1.0));\n\tgl_FragColor = color;\n}\n"),this.squareBlurProgram=new Pe(xe,Te,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tvec2 realPosition = u_position;\n\trealPosition.x = texelCoord.x;\n\n\tfloat distanceFromCenter = distance(realPosition, texelCoord);\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.2 - 0.1, 0.2, distanceFromCenter), 0.0, 1.0));\n\n\tgl_FragColor = color;\n}\n"),this.colorCorrectionTexture=new Se(xe),this.postProcessTexture=new Se(xe),this.blurTexture1=new Se(xe),this.blurTexture2=new Se(xe),this.resultBlurTexture=new Se(xe)}return e.getOrCreateTexture=function(t,r,n){var o=n?r.src+"_auto":r.src;if(!Ne[o]){var i=void 0;i=n?e.getAuto(r):r;var a=new Se(t);a.attachImage(t,i),Ne[o]=a}return Ne[o]},e.loadTextures=function(t,r){return new Promise((function(n){var o=[],i=r.map((function(e){return ge.get(e)}));Promise.all(i).then((function(r){r.forEach((function(r){var n=e.getOrCreateTexture(t,r);o.push(n)})),n(o)})).catch((function(){}))}))},e.getAuto=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return t;t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);var n=e.width*e.height,o=r.getImageData(0,0,e.width,e.height),i=o.data;function a(e,t,r,n){t+r>=e&&(t=(e-1)/2,r=(e-1)/2);var o=function(e,t,r,n){for(var o,a=[],s=0;s<256;s++)a.push(0);for(o=0;o<e;o++)a[i[4*o+n]]+=1;for(o=1;o<256;o++)a[o]+=a[o-1];var c={};for(o=0;o<256&&a[o]<=t;)o++;for(c.min=o,o=255;o<256&&a[o]>e-r;)o--;return o<255&&o++,c.max=o,c}(e,t,r,n);!function(e,t,r,n){var o,a;if(r<=t)for(o=0;o<e;o++)i[(a=4*o)+n]=127.5;else{var s=new Array(256);for(o=0;o<t;o++)s[o]=0;for(o=t;o<r;o++)s[o]=255*(o-t)/(r-t)+.5;for(o=r;o<256;o++)s[o]=255;for(o=0;o<e;o++)i[(a=4*o)+n]=s[i[a+n]]}}(e,o.min,o.max,n)}!function(e,t,r){a(e,t,r,0),a(e,t,r,1),a(e,t,r,2)}(n,.01*n,.01*n),r.putImageData(o,0,0);var s=document.createElement("canvas");return s.width=e.width,s.height=e.height,null==(r=s.getContext("2d"))||r.drawImage(t,0,0,t.width,t.height),t},e.prototype.render=function(t,r,n,o,i,a,s){var c=this;return void 0===i&&(i={}),new Promise((function(l){requestAnimationFrame((function(){if(!xe)throw new Error(be);var p=function(e){var t=De[e];if(t)return Re(ke,[t])}(o);if(!p)throw new Error(ye);var u=e.getOrCreateTexture(xe,n,s);e.loadTextures(xe,p).then((function(e){var n=c.postProcessTexture;if(c.baseColorCorrectionProgram.draw({width:t,height:r,uniforms:{u_exposure:i.exposure,u_contrast:i.contrast,u_warmth:i.warmth,u_saturation:i.saturation,u_amount:i.amount},textures:Me([u],e)},c.colorCorrectionTexture),c.postProcessProgram.draw({width:t,height:r,uniforms:{u_vignette:i.vignette,u_sharpness:i.sharpness,u_sourceSize:i.sourceSize,u_grain:i.grain},textures:[c.colorCorrectionTexture]},c.postProcessTexture),a&&a.isEnabled){var o=a.form===d.default.BLUR_TYPES.ROUND?c.roundBlurProgram:c.squareBlurProgram;c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[a.size/t,0]},textures:[c.postProcessTexture]},c.blurTexture1),c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[0,a.size/r]},textures:[c.blurTexture1]},c.blurTexture2),o.draw({width:t,height:r,uniforms:{u_position:a.position},textures:[c.blurTexture2,c.postProcessTexture]},c.resultBlurTexture),n=c.resultBlurTexture}return c.flippedProgram.draw({width:t,height:r,uniforms:{},textures:[n]}),l(Le)})).catch((function(e){console.error(new Error(e))}))}))}))},e}(),je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),We={},Ue=function(e){function t(t){var r=e.call(this,t)||this;return r.canvas=n.createRef(),r.renderer=new Be,r.needUpdateSize=!0,r}return je(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.originalWidth,n=t.originalHeight,o=t.background,i=r!==e.originalWidth||n!==e.originalHeight;this.needUpdateSize=i||JSON.stringify(o)!==JSON.stringify(e.background),this.update()},t.prototype.render=function(){var e=this.props,t=e.originalWidth,r=e.originalHeight;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:t,height:r,style:{width:this.props.width,height:this.props.height}})},t.prototype.update=function(){var e=this,t=this.props.currentBackgroundUrl;t&&ge.get(t).then((function(t){e.renderImage(t)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this,r=this.canvas.current;if(r&&r.getContext("2d")){var n=this.props.background,o=this.props,i=o.colorCorrection,a=o.filter,s=o.blur,c=o.isAutoCorrection;n.currentBackgroundType===d.default.BACKGROUND_MODES.BACKGROUND&&(a={name:d.default.PHOTO_FILTERS[0],value:0},i={exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},s={isEnabled:!1,form:s.form,size:s.size,position:s.position},c=!1);var l={exposure:i.exposure,contrast:i.contrast,saturation:i.saturation,warmth:i.warmth,amount:a.value,vignette:i.vignette,sharpness:i.sharpness,grain:i.grain,sourceSize:[e.width,e.height]};this.renderer.render(e.width,e.height,e,a.name,l,s,c).then((function(n){if(n){var o,i,a=e.height/e.width;a>1.77?(o=t.props.height/a,i=t.props.height):(o=t.props.width,i=t.props.width*a);var s=Math.floor(t.props.width/2),c=Math.floor(t.props.height/2),l=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,null==r||r.drawImage(e,0,0,e.width,e.height),t}(n),p=We[e.src];p||(We[e.src]=function(e){var t,r=e.getContext("2d"),n={r:0,g:0,b:0};if(!r)return n;try{t=r.getImageData(0,0,r.canvas.width,r.canvas.height)}catch(e){return n}for(var o=-4,i=0;(o+=20)<t.data.length;)++i,n.r+=t.data[o],n.g+=t.data[o+1],n.b+=t.data[o+2];return n.r=~~(n.r/i),n.g=~~(n.g/i),n.b=~~(n.b/i),n}(l),p=We[e.src]),pe(r,l,p);var d={canvas:l,width:o,height:i,avgColor:p};t.needUpdateSize&&Object.assign(d,{x:s,y:c,locked:!0,rotate:0,scale:1}),t.props.updateBackgroundLayer(d)}})).catch((function(e){console.error(new Error(e))}))}},t}(n.PureComponent),He={updateBackgroundLayer:z},Ke=Object(i.connect)((function(e){return{currentBackgroundUrl:_(e),originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight,background:e.present.background,isAutoCorrection:e.present.settings.isAutoCorrection,colorCorrection:e.present.settings.colorCorrection,filter:e.present.settings.filter,blur:e.present.settings.blur}}),He)(Ue),Fe=r("4+be"),Ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ge=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},qe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,i=t.items,a=null!==o&&i[o],s=a&&a.type===d.default.LAYER_TYPES.TEXT&&a.isEdit,c="";return a&&(a.type===d.default.LAYER_TYPES.STICKER?c=Object(Fe.getLang)("photos_pe_delete_sticker"):a.type===d.default.LAYER_TYPES.TEXT&&(c=Object(Fe.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==d.default.BACKGROUND_MODES.BACKGROUND||a||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,a&&!s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},c),a&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(Fe.getLang)("photos_pe_save_text")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(Fe.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(Fe.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===d.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(Fe.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,o=t.gradients,i=t.emojies,a=r.scrollElement.current,s=a?e+a.offsetWidth:0,c=!!e,l=!a||!!(a.scrollWidth-s);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},Ge(o,i).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(ue.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),c&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),l&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:a})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return Ve(t,e),t}(n.Component),ze={deleteLayer:Y,closeTextEditor:X},Ye=Object(i.connect)((function(e){return{context:e.present.data.context,layers:e.present.layers,addons:e.present.data.addons}}),ze)(qe),Xe=r("Ht+d"),$e=r("6krn"),Ze=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Je=function(){return(Je=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Qe=function(e,t,r){[d.default.CROP_ASPECT_ORIGINAL,d.default.CROP_ASPECT_FREE].includes(e)&&(e=t/r);var n=t,o=n/e;return o>r&&(n=(o=r)*e),{x:t/2-n/2,y:r/2-o/2,width:n,height:o}},et=function(e){function t(t){var r=e.call(this,t)||this;r.controlMouseDown=function(e,t){e.stopPropagation();var n=r.areaEl.current;if(n){window.addEventListener("mousemove",r.controlMouseMove),window.addEventListener("mouseup",r.controlMouseUp);var o=ae(e.nativeEvent,n),i=o.x,a=o.y;r.shiftX=i,r.shiftY=a,r.initCrop=r.state,r.side=t}},r.controlMouseMove=function(e){var t=r.containerEl.current;if(t){var n=r.state,o=r.props,i=o.artboardWidth,a=o.artboardHeight,s=o.cropAspect,c=s===d.default.CROP_ASPECT_ORIGINAL?i/a:s,l=ae(e,t),p=l.x,u=l.y,_=l.width,h=l.height,f=n.x,m=n.y,g=n.width,b=n.height,v=d.default.CROP_MIN_SIZE,E=d.default.CROP_MIN_SIZE;if(c&&(c>1?v=d.default.CROP_MIN_SIZE*c:c<1&&(E=d.default.CROP_MIN_SIZE/c)),r.side===d.default.CROP_SIDES.CENTER)f=Math.min(Math.max(0,p-r.shiftX),_-g),m=Math.min(Math.max(0,u-r.shiftY),h-b);else{var w=Math.max(0,p-r.shiftX),O=Math.max(0,u-r.shiftY);switch(r.side){case d.default.CROP_SIDES.S:b=u-m-(r.shiftY-r.initCrop.height);break;case d.default.CROP_SIDES.N:b-=(m=O)-n.y;break;case d.default.CROP_SIDES.W:g-=(f=w)-n.x;break;case d.default.CROP_SIDES.E:g=p-f-(r.shiftX-r.initCrop.width);break;case d.default.CROP_SIDES.NW:m=O,g-=(f=w)-n.x,b-=m-n.y;break;case d.default.CROP_SIDES.NE:m=O,g=p-f-(r.shiftX-r.initCrop.width),b-=m-n.y;break;case d.default.CROP_SIDES.SW:g-=(f=w)-n.x,b=u-m-(r.shiftY-r.initCrop.height);break;case d.default.CROP_SIDES.SE:g=p-f-(r.shiftX-r.initCrop.width),b=u-m-(r.shiftY-r.initCrop.height)}if(c){var y=Math.min(g,_-f)/c;if([d.default.CROP_SIDES.NW,d.default.CROP_SIDES.NE].includes(r.side)&&(m=Math.max(0,m+b-y)),h-(m+y)<0)return;b=y}g=Math.min(Math.max(v,g),_-f),b=Math.min(Math.max(E,b),h-m),g-v<=0&&(f=n.x,g=n.width),b-E<=0&&(m=n.y,b=n.height)}r.setState({x:f,y:m,width:g,height:b})}},r.controlMouseUp=function(){window.removeEventListener("mousemove",r.controlMouseMove),window.removeEventListener("mouseup",r.controlMouseUp),delete r.shiftX,delete r.shiftY,delete r.initCrop,delete r.side},r.cropImage=function(){var e=r.state,t=e.width,n=e.height,o=e.x,i=e.y,a=r.props,s=a.currentBackgroundUrl,c=a.artboardWidth,l=a.artboardHeight;r.setState({isButtonDisable:!0});var p=document.createElement("canvas"),d=p.getContext("2d");d&&ge.get(s).then((function(e){var a=e.width/c,s=e.height/l;p.width=t*a,p.height=n*s,d.drawImage(e,o*a,i*s,t*a,n*s,0,0,p.width,p.height),p.toBlob((function(e){r.props.setCrop({url:URL.createObjectURL(e),isCropped:!0,data:{artboardWidth:t,originalWidth:p.width,originalHeight:p.height,addons:Je(Je({},r.props.addons),{photoHeight:n})},layers:r.props.layers.items.map((function(e){return Je(Je({},e),{x:e.x-o,y:e.y-i})})),drawings:r.props.drawings.map((function(e){return Je(Je({},e),{path:e.path.map((function(e){return[e[0]-o,e[1]-i]}))})}))}),r.reset(t,n)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},r.reset=function(e,t){r.props.setAspect(d.default.CROP_ASPECT_FREE),r.setState({x:0,y:0,width:e,height:t,isButtonDisable:!1})},r.containerEl=n.createRef(),r.areaEl=n.createRef();var o=t.cropAspect,i=t.artboardWidth,a=t.artboardHeight;return r.state=Je({isButtonDisable:!1},Qe(o,i,a)),r}return Ze(t,e),t.prototype.shouldComponentUpdate=function(e){return e.cropAspect===this.props.cropAspect&&e.artboardWidth===this.props.artboardWidth&&e.artboardHeight===this.props.artboardHeight||this.setState(Qe(e.cropAspect,e.artboardWidth,e.artboardHeight)),!0},t.prototype.render=function(){var e=this,t=d.default.CROP_SIDES,r=this.props,o=r.artboardWidth,i=r.artboardHeight,a=this.state,s=a.x,c=a.y,l=a.width,p=a.height,u=a.isButtonDisable,_=l<210,h=_?100:60,f=Object(ue.classNames)("CropControls__buttons",{"CropControls__buttons--top":c+p+h>=i,"CropControls__buttons--small":_}),m=0!==s||0!==c||l!==o||p!==i;return n.createElement("div",{className:"CropControls",ref:this.containerEl},n.createElement("div",{className:"CropControls__inner",ref:this.areaEl,style:{top:c,left:s,width:l,height:p}},m&&n.createElement("div",{className:f},n.createElement(Xe.default,{size:"s",className:"CropControls__button CropControls__button--cancel",onClick:function(){return e.reset(e.props.artboardWidth,e.props.artboardHeight)}},Object($e.getLang)("photos_pe_crop_cancel")),n.createElement(Xe.default,{size:"s",className:"CropControls__button",onClick:this.cropImage,disabled:u},Object($e.getLang)("photos_pe_crop_apply"))),n.createElement("div",{className:"CropControls__grid",onMouseDown:function(r){return e.controlMouseDown(r,t.CENTER)}},n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"66.6666%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"66.6666%"}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--nw",onMouseDown:function(r){return e.controlMouseDown(r,t.NW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--ne",onMouseDown:function(r){return e.controlMouseDown(r,t.NE)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--sw",onMouseDown:function(r){return e.controlMouseDown(r,t.SW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--se",onMouseDown:function(r){return e.controlMouseDown(r,t.SE)}}),this.props.cropAspect===d.default.CROP_ASPECT_FREE&&n.createElement(n.Fragment,null,n.createElement("div",{className:"CropControls__handle CropControls__handle--n",onMouseDown:function(r){return e.controlMouseDown(r,t.N)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--s",onMouseDown:function(r){return e.controlMouseDown(r,t.S)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--w",onMouseDown:function(r){return e.controlMouseDown(r,t.W)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--e",onMouseDown:function(r){return e.controlMouseDown(r,t.E)}})))))},t}(n.Component),tt={setAspect:Q,setCrop:ne},rt=Object(i.connect)((function(e){return{currentBackgroundUrl:_(e),cropAspect:e.present.settings.cropAspect,addons:e.present.data.addons,layers:e.present.layers,drawings:e.present.drawings}}),tt)(et),nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ot=function(e){function t(t){var r=e.call(this,t)||this;return r.canvasBg=n.createRef(),r}return nt(t,e),t.prototype.componentDidUpdate=function(){this.drawImage()},t.prototype.render=function(){var e=this.props.layer,t=e.width*e.scale,r=e.height*e.scale;return n.createElement("canvas",{ref:this.canvasBg,width:t*d.default.CANVAS_SCALE,height:r*d.default.CANVAS_SCALE,style:{width:t,height:r}})},t.prototype.drawImage=function(){var e=this.props.layer,t=this.canvasBg.current,r=null==t?void 0:t.getContext("2d");if(r){var n=e.width*e.scale,o=e.height*e.scale;r.drawImage(e.canvas,0,0,n*d.default.CANVAS_SCALE,o*d.default.CANVAS_SCALE)}},t}(n.PureComponent),it=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),at=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.props.startLayerScale(),t.layer=t.props.layer,t.layer.type===d.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth/t.layer.scale,t.height=n.offsetHeight/t.layer.scale}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=ae(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var i={x:n-t.layer.x,y:o-t.layer.y},a=180*(Math.atan2(i.y,i.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(d.default.LAYER_MIN_SIZE,Math.sqrt(i.x*i.x+i.y*i.y))/t.distanceToZero;t.props.setLayerScale(s,a)}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return it(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),st=r("Xrg9"),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ct(t,e),t.prototype.render=function(){return st.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),i=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:i+"%"}})})):null},t}(n.Component),pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDoubleClick=function(){t.props.toggleTextEditor(!0)},t}return pt(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,i=Object(ue.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--locked":t.locked});switch(t.type){case d.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,i);break;case d.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,i);break;case d.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,i);break;case d.default.LAYER_TYPES.BACKGROUND:o=this.renderLayerBackground(t,n,i)}if(t.isBackground){var a=document.querySelector(".EditorCanvas__layers--bg");return a?oe.createPortal(o,a):null}return o},t.prototype.renderLayerBackground=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner"},n.createElement(ot,{layer:e}),this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerSticker=function(e,t,r){var o=this.props.getStickerUrlById(e.id,d.default.STICKER_LARGE);return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+o+"')"}},this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerImage=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+e.url+"')"}},this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale}),e.clickableZones&&n.createElement(lt,{clickableZones:e.clickableZones})))},t.prototype.renderLayerText=function(e,t,r){var o=Math.max(10,e.fontSize*d.default.FONT_SIZE_COEFFICIENT);r+=" PhotoEditorFontStyle--"+e.fontStyle;var i={fontSize:o*e.scale,color:e.color};return this.props.currentIndex===t&&e.isEdit?null:n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:i,onDoubleClick:this.handleDoubleClick},n.createElement("div",null,Object(H.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t}(n.Component),ut=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ut(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,i=Object(ue.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":[d.default.TABS.PAINT,d.default.TABS.FILTERS,d.default.TABS.COLOR,d.default.TABS.CROP].includes(this.props.currentMode)});return n.createElement(n.Fragment,null,n.createElement("div",{className:i+" EditorCanvas__layers--items"},r.map((function(t,r){return n.createElement(dt,{key:r,index:r,currentIndex:o,layer:t,setLayerScale:e.props.setLayerScale,startLayerScale:e.props.startLayerScale,toggleTextEditor:e.props.toggleTextEditor,getStickerUrlById:e.props.getStickerUrlById})}))),n.createElement("div",{className:i+" EditorCanvas__layers--bg"}))},t}(n.Component),ht=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=Math.max(10,e.fontSize*d.default.FONT_SIZE_COEFFICIENT);return e.initialFontSize&&(t=e.initialFontSize*d.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(H.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onKeyDown:r.onKeyDown,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onKeyDown=function(e){if("Enter"===e.key)if(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey||e.shiftKey){var t=r.textareaEl.current;if(t){var n=e.target.selectionStart,o=e.target.selectionEnd;t.value=t.value.substring(0,n)+"\n"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,r.onChange()}}else r.props.closeTextEditor()},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,i=-1;o<t.length;o++){var a=t.charAt(o);if(" "!=a&&"-"!=a&&"+"!=a||(i=o),r.value+=a,r.scrollWidth>n){var s="";if(i>=0){for(var c=i+1;c<o;c++)s+=t.charAt(c);i=-1}s+=a,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(U.sendStat)(U.EVENTS.EDIT_TEXT),r}return ht(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontSize===this.props.layer.fontSize&&e.layer.fontStyle===this.props.layer.fontStyle||this.onChange()},t}(n.Component),mt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===d.default.BACKGROUND_MODES.PHOTO?Object(U.sendStat)(U.EVENTS.CLICK_TO_CAMERA_ICON):e===d.default.BACKGROUND_MODES.BACKGROUND&&Object(U.sendStat)(U.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return mt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(d.default.BACKGROUND_MODES).map((function(t){var r=Object(ue.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.PureComponent),bt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vt=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return bt(t,e),t.prototype.render=function(){var e=this,r=Object(ue.classNames)("DropBox",{"DropBox--hover":this.state.onHover});return n.createElement("div",{className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},t.renderIcon())},t.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",fill:"none"},n.createElement("path",{fill:"#fff",d:"M17.5 18.38a1 1 0 00-2 .24l1.8 15.23a3 3 0 002.98 2.65h9.44a3 3 0 002.98-2.65l1.8-15.23a1 1 0 10-2-.24l-1.78 15.24a1 1 0 01-1 .88h-9.44a1 1 0 01-1-.88L17.5 18.38z"}),n.createElement("path",{fill:"#fff",d:"M22 21.45a1 1 0 00-2 .1l.5 10a1 1 0 102-.1l-.5-10zm8 .1a1 1 0 00-2-.1l-.5 10a1 1 0 102 .1l.5-10zm-4-.05a1 1 0 10-2 0v10a1 1 0 002 0v-10z"}),n.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M20.62 16.5c.08-.35.2-.77.42-1.2.32-.64.8-1.19 1.38-1.59A4.55 4.55 0 0125 13c1.05 0 1.9.27 2.58.71.59.4 1.06.95 1.38 1.6.21.42.34.84.42 1.19H36a1 1 0 010 2H14a1 1 0 010-2h6.63zm6.68 0a2.9 2.9 0 00-.13-.3c-.16-.33-.4-.61-.7-.82-.31-.2-.77-.38-1.47-.38s-1.16.17-1.47.38c-.32.2-.54.5-.7.82-.05.1-.1.2-.13.3h4.6z",className:"DropBox__cap",clipRule:"evenodd"}))},t}(n.PureComponent),Et=r("dt/K"),wt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?oe.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,i=e.data,a=e.ui,s=e.settings,c=i.addons,l=i.artboardWidth,p=i.artboardHeight,u=i.attachment,_=t.props.layers,h=_.currentIndex,f=_.items,m=null!==h&&f[h],g=m&&m.type===d.default.LAYER_TYPES.TEXT&&m.isEdit,b=t.props.ui.isDataLoaded&&t.props.data.context===d.default.CONTEXT_TYPES.STORY,v=t.props.marginTop,E=p;c&&c.photoHeight&&(E=c.photoHeight);var w=Object(ue.classNames)("EditorCanvas",{"EditorCanvas--blurCursor":d.default.TABS.COLOR===a.currentMode&&s.blur.isEnabled}),O=Object(ue.classNames)("EditorCanvas__scaleButton",{"EditorCanvas__scaleButton--enabled":!r.items[0].locked});return n.createElement(n.Fragment,null,n.createElement("div",{style:{width:l,height:E,marginTop:v},className:w},t.props.ui.isDataLoaded&&a.currentMode===d.default.TABS.CROP&&n.createElement(rt,{artboardWidth:l,artboardHeight:E}),n.createElement(_t,{setLayerScale:t.props.setLayerScale,startLayerScale:t.props.startLayerScale,toggleTextEditor:t.props.toggleTextEditor,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),g&&m?n.createElement(ft,{layer:m,onChange:t.onChangeText,closeTextEditor:t.props.closeTextEditor}):b&&n.createElement(n.Fragment,null,!!u&&!a.isShowDropBox&&n.createElement(Et.default,{text:Object($e.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),!a.isShowDropBox&&t.props.background.currentBackgroundType===d.default.BACKGROUND_MODES.PHOTO&&[d.default.TABS.STICKERS,d.default.TABS.TEXT].includes(t.props.ui.currentMode)&&n.createElement("button",{className:O,onClick:t.onClickScaleButton}),!a.isShowDropBox&&n.createElement(gt,{current:o.currentBackgroundType,setMode:t.props.setMode})),a.isShowDropBox&&m&&m.canDelete&&n.createElement(vt,{onDelete:t.props.deleteLayer}),t.props.ui.isDataLoaded&&n.createElement(me,{width:l,height:E}),t.props.ui.isDataLoaded&&n.createElement(Ke,{width:l,height:E})),t.props.ui.isDataLoaded&&n.createElement(Ye,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.props.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onClickScaleButton=function(){var e,r,n=t.props.layers.items[0],o={},i=t.props.data,a=i.artboardWidth,s=i.artboardHeight,c=n.height/n.width;c>1.77?e=(r=s)/c:(e=a,r=a*c);var l=a/2,p=s/2;n.locked?(Object(U.sendStat)(U.EVENTS.ZOOM),Object.assign(o,{locked:!1,scale:.7})):(Object(U.sendStat)(U.EVENTS.UNZOOM),Object.assign(o,{locked:!0,rotate:0,x:l,y:p,width:e,height:r,scale:1})),t.props.updateBackgroundLayer(o),t.props.setCurrentLayer(n.locked?0:null)},t.onChangeText=function(e){t.props.setLayerText(e)},t}return wt(t,e),t}(n.Component),yt={setCurrentBackgroundId:function(e){return Object(U.sendStat)(U.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}},setLayerScale:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:"SET_LAYER_SCALE",payload:{scale:e,rotate:t}})}},startLayerScale:function(){return{type:"START_LAYER_SCALE"}},setLayerText:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_TEXT",payload:{text:e}})}},toggleTextEditor:q,deleteLayer:Y,updateBackgroundLayer:z,setCurrentLayer:F,setBackgroundType:ee,closeTextEditor:X},Ct=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data,marginTop:h(e)}}),yt)(Ot),St=r("TfWv"),At=r("754W"),Pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTabClick=function(e,r){r||t.props.change(e)},t}return Pt(t,e),t.prototype.render=function(){var e=this,t=this.props.current;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(r){if(r){var o=r.props["data-disabled"],i=Object(ue.classNames)("EditorTabs__item","EditorTabs__item--"+r.props["data-mode"],{"EditorTabs__item--current":t===r.props["data-mode"],"EditorTabs__item--disabled":o}),a=n.createElement("div",{className:i,key:r.props["data-mode"],onClick:function(){return e.onTabClick(r.props["data-mode"],o)}});if(o){var s=n.createElement("div",{className:"EditorTabsTooltip"},n.createElement("span",{className:"EditorTabsTooltip__text"},Object($e.getLang)("photos_pe_filters_disabled_text")),n.createElement(At.default,{onClick:function(){return e.props.setMode(d.default.BACKGROUND_MODES.PHOTO)},className:"EditorTabsTooltip__link"},Object($e.getLang)("photos_pe_filters_disabled_button")));return n.createElement(St.default,{className:"EditorTabs__tooltip",text:s,appearance:"light",position:"b",maxWidth:203},a)}return a}}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){if(e){var r={className:Object(ue.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}}))))},t}(n.Component),Rt=r("vRp6"),Dt=r("EasH"),kt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Mt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.fetchStickers()},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,i=r.props.ui,a=i.stickerHeaderScrollPosition,s=i.currentStickerPackIndex,c=r.scrollElement.current,l=!!a,p=!1,u=0;c&&(u=a+c.offsetWidth,p=!!(c.scrollWidth-u));var _=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,_=[],r.setState({}));for(var h=[],f=0,m=_.length;f<m;f+=3)h.push(_.slice(f,f+3));return n.createElement("div",{className:"StickersPanel"},n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+a+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},n.createElement("div",{className:"StickersPanel__tab StickersPanel__tab--store",onClick:function(){return r.showStickerShop()}}),t.map((function(e,t){var o=e.id,i=r.getTabPreviewUrl(t);if(!i)return null;var a=!Object(Ae.inArray)(o,["recent","editor"]),c=Object(ue.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:a?{backgroundImage:"url('"+i+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),p&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(Rt.default,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},h.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[d.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[d.default.STICKER_THUMB]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(a)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return kt(t,e),t.prototype.fetchStickers=function(){var e=this;window.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){var r={};t.stickers.forEach((function(e){e.items.forEach((function(e){r[e.id]=e}))})),e.props.setData({stickers:t.stickers,stickersMap:r})},onFail:function(e){return console.error(e),!0}})},t.prototype.showStickerShop=function(){var e=this;Object(Dt.showBox)("al_im.php",{act:"stickers_store",box:1},{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy:function(){e.fetchStickers()}}})},t}(n.Component),It={setCurrentStickerPackIndex:function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}},setHeaderScrollPosition:function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}},setData:re},Lt=Object(i.connect)((function(e){return{ui:e.present.ui,stickers:e.present.data.stickers}}),It)(Mt),xt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nt=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},Bt=function(e){function t(t){var r=e.call(this,t)||this;return r.colors=r.getColors(t.avgColor),r}return xt(t,e),t.prototype.shouldComponentUpdate=function(e){return JSON.stringify(e.avgColor)!==JSON.stringify(this.props.avgColor)&&(this.colors=this.getColors(e.avgColor)),!0},t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},this.colors.map((function(t,r){var o=Object(ue.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:r,className:o,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t.prototype.getColors=function(e){var t,r=function(e,t,r){var n=0,o=0,i=e/255,a=t/255,s=r/255,c=Math.max(i,a,s),l=c-Math.min(i,a,s),p=function(e){return(c-e)/6/l+.5},d=function(e){return Math.round(100*e)/100};if(0!==l){o=l/c;var u=p(i),_=p(a),h=p(s);i===c?n=h-_:a===c?n=1/3+u-h:s===c&&(n=2/3+_-u),n<0?n+=1:n>1&&(n-=1)}return{h:Math.round(360*n),s:d(100*o),v:d(100*c)}}(e.r,e.g,e.b),n=[];return d.default.AVERAGE_COLORS_MAP.forEach((function(e){var t=Math.round(Math.min(Math.max(r.s+e.s,0),100)),o=Math.round(Math.min(Math.max(r.v+e.v,0),100));n.push(function(e,t,r){t/=100,r/=100;var n=(1-Math.abs(2*r-1))*t,o=n*(1-Math.abs(e/60%2-1)),i=r-n/2,a=0,s=0,c=0;return 0<=e&&e<60?(a=n,s=o,c=0):60<=e&&e<120?(a=o,s=n,c=0):120<=e&&e<180?(a=0,s=n,c=o):180<=e&&e<240?(a=0,s=o,c=n):240<=e&&e<300?(a=o,s=0,c=n):300<=e&&e<360&&(a=n,s=0,c=o),a=Math.round(255*(a+i)).toString(16),s=Math.round(255*(s+i)).toString(16),c=Math.round(255*(c+i)).toString(16),1==a.length&&(a="0"+a),1==s.length&&(s="0"+s),1==c.length&&(c="0"+c),"#"+a+s+c}(r.h,t,o).toUpperCase())})),(t=Nt(d.default.COLORS,n),t.filter((function(e,t,r){return r.indexOf(e)==t}))).slice(0,30)},t}(n.Component),jt=r("clTp"),Wt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ut=function(e){function t(r){var o,i=e.call(this,r)||this;return i.onMouseDown=function(e){0===e.button&&(i.update(e),i.setState({isActive:!0}),window.addEventListener("mouseup",i.onMouseUp),window.addEventListener("mousemove",i.onMouseMove))},i.onMouseMove=function(e){requestAnimationFrame((function(){return i.update(e)}))},i.onMouseUp=function(){i.setState({isActive:!1}),window.removeEventListener("mousemove",i.onMouseMove),window.removeEventListener("mouseup",i.onMouseUp)},i.onMouseEnter=function(){window.addEventListener("mousemove",i.updateHint)},i.onMouseLeave=function(){window.removeEventListener("mousemove",i.updateHint)},i.update=function(e){var r=i.props,n=r.min,o=r.max,a=r.gravity,s=i.getOffset(e),c=s.offset,l=s.width,p=i.getZeroPosition(),d=t.valueToPercent(c,0,l);a&&a>0&&d>=p-a&&d<=p+a&&(d=p),i.state.percentValue!==d&&(i.setState({hintPosition:d}),i.props.onChange(t.percentToValue(d,n,o)),i.isControlledOutside||i.setState({percentValue:d}))},i.updateHint=function(e){var r=i.getOffset(e),n=r.offset,o=r.width;i.setState({hintPosition:t.valueToPercent(n,0,o)})},o=r.value?t.valueToPercent(r.value,r.min,r.max):r.defaultValue?t.valueToPercent(r.defaultValue,r.min,r.max):i.getZeroPosition(),i.state={percentValue:o,hintPosition:0,isActive:!1},i.isControlledOutside=i.props.hasOwnProperty("value"),i.slider=n.createRef(),i}return Wt(t,e),t.prototype.componentDidMount=function(){this.slider.current&&this.slider.current.addEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.addEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){this.slider.current&&this.slider.current.removeEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.removeEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.removeEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentDidUpdate=function(e){var r=this.props.value;if(this.isControlledOutside&&void 0!==r&&r!==e.value){var n=this.props,o=n.min,i=n.max;this.setState({percentValue:t.valueToPercent(r,o,i)})}},t.valueToPercent=function(e,t,r){return e<t&&(e=t),e>r&&(e=r),100*(e-t)/(r-t)},t.percentToValue=function(e,t,r){return Math.round(100*(e*(r-t)/100+t))/100},t.getFillPosition=function(e,t){var r,n;return e<t?(r=e,n=t-e):(r=t,n=e-t),{left:r,width:n}},t.prototype.getZeroPosition=function(){var e=this.props,r=e.min,n=e.max;return t.valueToPercent(0,r,n)},t.prototype.getOffset=function(e){var t=this.props,r=t.min,n=t.max,o=t.step,i=Object(jt.default)(this.slider.current),a=i.left,s=i.width,c=e.clientX-a;if(o>0){var l=s/((n-r)/o);c=Math.round(c/l)*l}return{offset:c,left:a,width:s}},t.prototype.render=function(){var e=this.props,r=e.min,o=e.max,i=e.isShowZero,a=e.isShowHandle,s=e.appearance,c=this.state,l=c.percentValue,p=c.hintPosition,d=c.isActive,u=this.getZeroPosition(),_=t.getFillPosition(l,u),h=_.left,f=_.width,m=l!==u,g=this.props.formatHint(t.percentToValue(p,r,o)),b=Object(ue.classNames)("Slider","Slider--"+s,{Slider__active:d}),v=Object(ue.classNames)("Slider__handle",{"Slider__handle--active":m,"Slider__handle--show":a});return n.createElement("div",{className:b,ref:this.slider},n.createElement("input",{type:"hidden",name,value:l}),i&&m&&n.createElement("div",{className:"Slider__middletick",style:{left:u+"%"}}),n.createElement("span",{className:"Slider__hint",style:{left:p+"%"}},g),n.createElement("div",{className:"Slider__fill",style:{left:h+"%",width:f+"%"}}),n.createElement("div",{className:v,style:{left:l+"%"}}))},t.defaultProps={min:0,max:100,step:0,gravity:0,isShowZero:!1,isShowHandle:!1,defaultValue:0,appearance:"blue",name:"value",onChange:function(){},formatHint:function(e){return e}},t}(n.Component),Ht=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Kt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,i=e.setBrushWidth,a=e.setBrushOpacity,s=e.avgColor;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:d.default.DRAWING_PREVIEW_WIDTH*d.default.CANVAS_SCALE,height:d.default.DRAWING_PREVIEW_HEIGHT*d.default.CANVAS_SCALE,style:{width:d.default.DRAWING_PREVIEW_WIDTH,height:d.default.DRAWING_PREVIEW_HEIGHT}}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object($e.getLang)("photos_pe_intensity")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object($e.getLang)("photos_pe_line_width")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}}))),n.createElement("div",{className:"DrawPanel__colors"},n.createElement("div",{className:"DrawPanel__title DrawPanel__title--largeOffset"},Object($e.getLang)("photos_pe_color")),n.createElement(Bt,{color:t.color,avgColor:s,setColor:o})))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,i=o.width,a=o.height;n.clearRect(0,0,i,a);var s=d.default.CANVAS_SCALE,c=new Path2D("M"+69*s+" "+65*s+"L"+93*s+" "+41*s+"L"+121*s+" "+69*s+"L"+149*s+" "+41*s+"L"+177*s+" "+69*s+"L"+201*s+" "+45*s),l="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*d.default.BRUSH_WIDTH_COEFFICIENT*s,n.strokeStyle=se(l,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke(c)}}},r.previewCanvas=n.createRef(),r}return Ht(t,e),t}(n.Component),Ft={setColor:J,setBrushWidth:function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}},setBrushOpacity:function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}},Vt=Object(i.connect)((function(e){return{settings:e.present.settings,drawings:e.present.drawings,avgColor:e.present.layers.items[0].avgColor}}),Ft)(Kt),Gt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qt=function(){return(qt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flip=function(e,r){var n=document.createElement("canvas"),o=null==n?void 0:n.getContext("2d"),i=t.props.currentBackgroundUrl;o&&ge.get(i).then((function(i){n.width=i.width,n.height=i.height,e?(o.translate(n.width,0),o.scale(-1,1)):r&&(o.translate(0,n.height),o.scale(1,-1)),o.drawImage(i,0,0),n.toBlob((function(n){var o={url:URL.createObjectURL(n)};e&&(o.flipX=!t.props.flipX),r&&(o.flipY=!t.props.flipY),t.props.setCrop(o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t.rotate=function(e){var r=document.createElement("canvas"),n=null==r?void 0:r.getContext("2d"),o=t.props,i=o.currentBackgroundUrl,a=o.originalWidth,s=o.originalHeight;n&&ge.get(i).then((function(o){r.width=o.height,r.height=o.width;var i=e?-90:90;n.translate(r.width/2,r.height/2),n.rotate(i*Math.PI/180),n.drawImage(o,-o.width/2,-o.height/2),r.toBlob((function(e){var n=r.height/r.width,o=t.props.rotate+i;t.props.rotate>o?Object(U.sendStat)(U.EVENTS.TURN_LEFT):Object(U.sendStat)(U.EVENTS.TURN_RIGHT);var c,l,p=document.getElementById("pv_photo").getBoundingClientRect(),u=p.width,_=p.height;_-=d.default.BOTTOM_PANEL_HEIGHT,n>=.67?(c=_/n,l=_):(c=u,l=u*n),t.props.setCrop({url:URL.createObjectURL(e),data:{artboardWidth:c,originalWidth:s,originalHeight:a,addons:qt(qt({},t.props.addons),{photoHeight:l})},rotate:o>270?0:o})}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t}return Gt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"CropPanel"},n.createElement("span",{className:"CropPanel__title"},Object($e.getLang)("photos_pe_crop_aspect_title")),n.createElement("ul",{className:"CropPanelRatioTabs"},d.default.CROP_ASPECTS.map((function(t){var r=Object(ue.classNames)("CropPanelRatioTabs__button",{"CropPanelRatioTabs__button--active":e.props.cropAspect===t.value});return n.createElement("li",{className:"CropPanelRatioTabs__item",key:t.title},n.createElement("button",{className:r,onClick:function(){return e.props.setAspect(t.value)}},Object($e.getLang)(t.title)))}))),n.createElement("ul",{className:"CropPanelSettings"},n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(At.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateRight",onClick:function(){return e.rotate(!1)}},Object($e.getLang)("photos_pe_rotate_right"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(At.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateLeft",onClick:function(){return e.rotate(!0)}},Object($e.getLang)("photos_pe_rotate_left"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(At.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipHorizontal",onClick:function(){return e.flip(!0,!1)}},Object($e.getLang)("photos_pe_flip_horizontal"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(At.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipVertical",onClick:function(){return e.flip(!1,!0)}},Object($e.getLang)("photos_pe_flip_vertical")))))},t}(n.Component),Yt={setCrop:ne,setAspect:Q},Xt=Object(i.connect)((function(e){return{flipX:e.present.settings.flipX,flipY:e.present.settings.flipY,rotate:e.present.settings.rotation,cropAspect:e.present.settings.cropAspect,currentBackgroundUrl:_(e),addons:e.present.data.addons,artboardWidth:e.present.data.artboardWidth,artboardHeight:e.present.data.artboardHeight,originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight}}),Yt)(zt),$t=r("TBLV"),Zt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,i=e.setFontSize,a=e.layer,s=e.fontsPlaceholders,c=e.avgColor,l=a&&a.isEdit,p=a&&a.fontStyle,u=a&&a.fontSize,_=a&&a.color;return n.createElement("div",{className:"TextPanel"},l?n.createElement(Xe.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(Fe.getLang)("photos_pe_save_text")):n.createElement(Xe.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(Fe.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_font")),d.default.FONTS.map((function(e,o){return n.createElement($t.default,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:p?p===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font TextPanelButton__font--"+e+" PhotoEditorFontStyle--"+e},s[o]))}))),n.createElement("div",{className:"TextPanelButton__fontSize"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_font_size")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,value:u||r.fontSize,formatHint:function(e){return""+Math.round(100*e)},onChange:function(e){return i(e)}})),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_color")),n.createElement(Bt,{color:_||r.color,avgColor:c,setColor:o})))},t}return Zt(t,e),t}(n.Component),Qt={addLayerText:G,setColor:J,setFontSize:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:E,payload:{fontSize:e}})}}(e)),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}},setFontStyle:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_FONT_STYLE",payload:{fontStyle:e}})}}(e)),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}},closeTextEditor:X},er=Object(i.connect)((function(e){var t=e.present.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{settings:e.present.settings,layer:o,fontsPlaceholders:e.present.data.fontsPlaceholders,avgColor:e.present.layers.items[0].avgColor}}),Qt)(Jt),tr=r("aFGQ"),rr=r("2zsc"),nr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),or=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return nr(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return n.createElement("div",{className:"ColorPanel"},n.createElement("div",{className:"ColorPanel__items"},n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_exposure")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_contrast")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_saturation")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_warmth")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_vignette")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_sharpness")),n.createElement(Ut,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_grain")),n.createElement(Ut,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.grain,onChange:function(e){return r("grain",e)},formatHint:function(e){return Math.round(100*e)}}))),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderAutoCorrectionPanel()),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderBlurPanel()))},t.prototype.renderAutoCorrectionPanel=function(){var e=this.props,t=e.settings,r=e.setAutoCorrection;return t.isAutoCorrection?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(rr.default,{className:""},Object($e.getLang)("photos_pe_correction_auto_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(At.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object($e.getLang)("photos_pe_cancel")))):n.createElement(At.default,{className:"ColorPanel__link ColorPanel__link--auto",onClick:function(){return r(!0)}},Object($e.getLang)("photos_pe_correction_auto"))},t.prototype.renderBlurPanel=function(){var e=this.props,t=e.settings,r=e.setBlurEnable,o=e.setBlurForm,i=e.setBlurSize,a=t.blur,s=[{label:Object($e.getLang)("photos_pe_correction_blur_type_round"),value:d.default.BLUR_TYPES.ROUND},{label:Object($e.getLang)("photos_pe_correction_blur_type_rec"),value:d.default.BLUR_TYPES.RECTANGULAR}];return a.isEnabled?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(rr.default,{className:""},Object($e.getLang)("photos_pe_correction_blur_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(At.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object($e.getLang)("photos_pe_cancel"))),n.createElement("div",{className:"ColorPanelEnabledBox__select"},n.createElement("span",{className:"ColorPanelEnabledBox__type"},Object($e.getLang)("photos_pe_correction_blur_type")),n.createElement(tr.default,{appearance:"fancy",value:a.form,options:s,onChange:function(e){return o(String(e.selected.value))}})),n.createElement(Ut,{min:0,max:100,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.blur.size,onChange:function(e){return i(e)},formatHint:function(e){return Math.round(e)}})):n.createElement(At.default,{className:"ColorPanel__link ColorPanel__link--blur",onClick:function(){return r(!0)}},Object($e.getLang)("photos_pe_correction_blur"))},t}(n.Component),ir={setColorCorrection:function(e,t){return{type:m,filter:e,value:t}},setBlurEnable:function(e){return e?Object(U.sendStat)(U.EVENTS.ENABLE_BLUR):Object(U.sendStat)(U.EVENTS.DISABLE_BLUR),{type:"SET_SETTING_BLUR_ENABLE",isEnabled:e}},setBlurForm:function(e){return{type:"SET_SETTING_BLUR_FORM",form:e}},setBlurSize:function(e){return{type:b,size:e}},setAutoCorrection:function(e){return e?Object(U.sendStat)(U.EVENTS.ENABLE_AUTOCORRECTION):Object(U.sendStat)(U.EVENTS.DISABLE_AUTOCORRECTION),{type:"SET_SETTING_AUTO_CORRECTION",isAutoCorrection:e}}},ar=Object(i.connect)((function(e){return{settings:e.present.settings}}),ir)(or),sr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cr=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.currentBackgroundUrl,o=t.currentFilterName,i=n!==e.currentBackgroundUrl;return o!==e.currentFilterName||(i&&r.update(e.currentBackgroundUrl),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter)},r.canvas=n.createRef(),r.renderer=new Be,r}return sr(t,e),t.prototype.componentDidMount=function(){this.update(this.props.currentBackgroundUrl)},t.prototype.render=function(){var e=Object(ue.classNames)("FiltersItem",{"FiltersItem--active":this.props.currentFilterName===this.props.filter});return n.createElement("div",{className:e,onClick:this.handleClick},n.createElement("div",{className:"FiltersItem__inner",style:{width:d.default.FILTER_PREVIEW_WIDTH}},n.createElement("canvas",{className:"FiltersItem__image",ref:this.canvas,width:d.default.FILTER_PREVIEW_WIDTH*d.default.CANVAS_SCALE,height:d.default.FILTER_PREVIEW_HEIGHT*d.default.CANVAS_SCALE,style:{width:d.default.FILTER_PREVIEW_WIDTH,height:d.default.FILTER_PREVIEW_HEIGHT}}),n.createElement("span",{className:"FiltersItem__name"},Object($e.getLang)("photos_pe_filter_"+this.props.filter))))},t.prototype.update=function(e){var t=this;e&&ge.get(e).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this;this.renderer.render(d.default.FILTER_PREVIEW_WIDTH*d.default.CANVAS_SCALE,d.default.FILTER_PREVIEW_HEIGHT*d.default.CANVAS_SCALE,e,this.props.filter,{amount:.75,sourceSize:[e.width,e.height]}).then((function(r){if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var i,a,s=+(e.height/e.width).toFixed(2);s>1.77?(i=n.height/s,a=n.height):(i=n.width,a=n.width*s);var c=n.width/2-i/2,l=n.height/2-a/2;pe(n,r,t.props.avgColor),o.drawImage(r,c,l,i,a)}}}})).catch((function(e){console.error(new Error(e))}))},t}(n.Component),lr={setFilter:function(e){return"regular"===e?Object(U.sendStat)(U.EVENTS.REMOVE_FILTER):Object(U.sendStat)(U.EVENTS.ADD_FILTER),{type:"SET_SETTING_FILTER",name:e}}},pr=Object(i.connect)((function(e){return{currentFilterName:e.present.settings.filter.name,currentBackgroundUrl:_(e)}}),lr)(cr),dr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ur=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dr(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"FiltersPanel"},n.createElement("div",{className:"FiltersPanel__header"},this.renderHeader()),n.createElement("div",{className:"FiltersPanel__inner"},d.default.PHOTO_FILTERS.map((function(t){return n.createElement(pr,{key:t,avgColor:e.props.avgColor,filter:t})}))))},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?n.createElement("span",null,Object($e.getLang)("photos_pe_filter_disabled")):n.createElement("div",{className:"FiltersPanel__slider"},n.createElement("span",{className:"FiltersPanel__title"},Object($e.getLang)("photos_pe_filter_enabled")),n.createElement(Ut,{min:0,max:1,value:e.filter.value,isShowHandle:!0,onChange:this.props.setFilterAmount,formatHint:function(e){return Math.round(100*e)+"%"}}))},t}(n.Component),_r={setFilterAmount:function(e){return{type:g,value:e}}},hr=Object(i.connect)((function(e){return{settings:e.present.settings,avgColor:e.present.layers.items[0].avgColor}}),_r)(ur),fr=s.ActionCreators,mr=Object(i.connect)((function(e){return{canUndo:e.past.length>0,canRedo:e.future.length>0}}),fr)((function(e){var t=e.canUndo,r=e.canRedo,n=e.undo,i=e.redo;return o.a.createElement("div",{className:"UndoRedo"},o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--undo",onClick:function(){Object(U.sendStat)(U.EVENTS.UNDO),n()},disabled:!t}),o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--redo",onClick:function(){Object(U.sendStat)(U.EVENTS.REDO),i()},disabled:!r}))})),gr=new(function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.draw=function(e,t,r,n,o,i){var a=this;return new Promise((function(s,c){var l=r[0];a.canvas.width=e,a.canvas.height=t,pe(a.canvas,l.canvas,l.avgColor);var p=l.width*l.scale,d=l.height*l.scale,u=l.x-p/2,_=l.y-d/2;a.drawImage(l.canvas,p*o,d*o,u*o,_*o,l.rotate),a.drawBrush(n,o),a.drawLayers(r,o,e,t,i).then((function(){a.canvas.toBlob((function(e){s({blob:e,width:a.canvas.width,height:a.canvas.height})}),"image/jpeg",1)})).catch((function(e){c(e)}))}))},e.prototype.drawImage=function(e,t,r,n,o,i){this.context&&(this.context.save(),this.context.translate(n,o),this.context.translate(t/2,r/2),this.context.rotate(i*Math.PI/180),this.context.translate(-t/2,-r/2),this.context.drawImage(e,0,0,t,r),this.context.restore())},e.prototype.drawBrush=function(e,t){var r=this.context;r&&(r.save(),r.lineCap="round",r.lineJoin="round",e.forEach((function(e){r.lineWidth=e.width*d.default.BRUSH_WIDTH_COEFFICIENT*t,r.strokeStyle=se(e.color,e.opacity),r.beginPath(),r.moveTo(e.path[0][0]*t,e.path[0][1]*t),e.path.forEach((function(e){r.lineTo(e[0]*t,e[1]*t)})),r.stroke()})),r.restore())},e.prototype.drawLayers=function(e,t,r,n,o){var i=this;return new Promise((function(r,n){var a=[];e.forEach((function(e,t){var r=null;if(e.type!==d.default.LAYER_TYPES.BACKGROUND){if(e.type===d.default.LAYER_TYPES.STICKER){var n=o((e=e).id,d.default.STICKER_LARGE);r=i.fetchImage(n,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate)}else if(e.type===d.default.LAYER_TYPES.IMAGE)e=e,r=i.fetchImage(e.url,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate);else if(e.type===d.default.LAYER_TYPES.TEXT){var s=document.querySelector('[data-index="'+t+'"] .EditorLayer__inner');s&&(r=i.drawTextLayer(e,s))}r&&a.push(r)}})),Promise.all(a).then((function(e){e.forEach((function(e){var r=e.width,n=e.height,o=e.x-r/2,a=e.y-n/2;i.drawImage(e.image,r*t,n*t,o*t,a*t,e.rotate)})),r()})).catch((function(e){n(e)}))}))},e.prototype.drawTextLayer=function(e,t){return new Promise((function(r,n){var o=document.createElement("canvas"),i=o.getContext("2d");if(!i)return n();o.width=t.offsetWidth*d.default.CANVAS_SCALE+100,o.height=t.offsetHeight*d.default.CANVAS_SCALE+100;var a="";switch(e.fontStyle){case"classic":a="RobotoPE";break;case"cursive":a="PacificoPE";break;case"marker":a="AmaticPE";break;case"italics":a="TTCommonsPE";break;case"typewriter":a="GoraPE";break;case"poster":a="DinPE";break;case"retro":a="Rodchenko";break;case"impact":a="Impact";break;case"lobster":a="Lobster"}var s=e.fontSize*e.scale*d.default.FONT_SIZE_COEFFICIENT*d.default.CANVAS_SCALE;i.font=s+"px "+a+", serif",i.fillStyle=e.color,i.textAlign="center",i.textBaseline="top",function(e,t,r,n,o,i){if((i=i||0)<=0)e.fillText(t,r,n);else{for(var a=t.replace(/(\v)/gm,"\n").split("\n"),s=0,c=1;a.length>0&&c<=a.length;){var l=a.slice(0,c).join(" ");e.measureText(l).width>i?(1===c&&(c=2),e.fillText(a.slice(0,c-1).join(" "),r,n+o*s),s++,a=a.splice(c-1),c=1):c++}c>0&&e.fillText(a.join(" "),r,n+o*s)}}(i,e.text,o.width/2,50,s,o.width-100),r({image:o,width:o.width/d.default.CANVAS_SCALE,height:o.height/d.default.CANVAS_SCALE,x:e.x,y:e.y,rotate:e.rotate})}))},e.prototype.fetchImage=function(e,t,r,n,o,i){return new Promise((function(a){ie(e).then((function(e){a({image:e,width:t,height:r,x:n,y:o,rotate:i})})).catch((function(e){console.error(e)}))}))},e}()),br=r("3oLO"),vr=r("W9Tc"),Er=r("zxIV"),wr=r("6raB"),Or=r("PjZB"),yr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cr=function(){return(Cr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Sr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown,{capture:!0}),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r=e.stickers,n=e.backgrounds,o=e.storyUploadUrlHash,i=e.storySaveHash,a={};r.forEach((function(e){e.items.forEach((function(e){a[e.id]=e}))})),t.props.setData({stickers:r,stickersMap:a,backgrounds:n,placeholders:Object($e.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object($e.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:o,storySaveHash:i}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===d.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object($e.getLang)("global_error")},Object($e.getLang)("global_error"),Object($e.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown,{capture:!0}),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){br.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,i=r.data,a=r.drawings,s=r.layers,c=r.settings;if(i.artboardContainer||(e={width:i.artboardWidth,height:parseInt(i.artboardHeight)+d.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,i.context===d.default.CONTEXT_TYPES.STORY)t.isSaveDisabled=!1;else{var l=c.colorCorrection,p=c.filter,u=c.blur,_=c.isAutoCorrection,h=c.isCropped,f=c.flipX,m=c.flipY,g=c.rotation;t.isSaveDisabled=!(!(s.items.length<=1)||a.length||l.exposure||l.contrast||l.saturation||l.warmth||l.vignette||l.sharpness||l.grain||"regular"!==p.name||u.isEnabled||_||h||f||m||g)}return n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(i.artboardHeight)+d.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(Ct,{getStickerUrlById:t.getStickerUrlById,uploadPhoto:t.uploadPhoto,setMode:t.setMode})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(Or.default,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e,r=t.props,o=r.data,i=r.background,a=o.context===d.default.CONTEXT_TYPES.STORY&&i.currentBackgroundType===d.default.BACKGROUND_MODES.BACKGROUND,s=Object(vr.partConfigEnabled)("web_new_photo_editor"),c=Object(vr.partConfigEnabled)("web_new_photo_editor_crop"),l=Object($e.getLang)("photos_pe_save_action");return t.props.data.context===d.default.CONTEXT_TYPES.STORY&&(l=Object($e.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Tt,{current:t.props.ui.currentMode,change:t.props.setMode,setMode:t.setMode},n.createElement("div",{"data-mode":d.default.TABS.STICKERS},n.createElement(Lt,{stickerMouseDown:t.addSticker})),n.createElement("div",{"data-mode":d.default.TABS.TEXT},n.createElement(er,null)),n.createElement("div",{"data-mode":d.default.TABS.PAINT},n.createElement(Vt,null)),c&&!(null===(e=o.addons)||void 0===e?void 0:e.disableCrop)&&o.context===d.default.CONTEXT_TYPES.PHOTO&&n.createElement("div",{"data-mode":d.default.TABS.CROP},n.createElement(Xt,null)),s&&n.createElement("div",{"data-mode":d.default.TABS.FILTERS,"data-disabled":a},n.createElement(hr,null)),s&&n.createElement("div",{"data-mode":d.default.TABS.COLOR,"data-disabled":a},n.createElement(ar,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(mr,null),n.createElement("div",null,n.createElement(Xe.default,{appearance:"secondary",onClick:t.props.data.close},Object($e.getLang)("photos_pe_cancel_action")),n.createElement(wr.default,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},l))))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},d.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){var e=t.props.data,r=e.artboardWidth,n=e.originalWidth,o=e.originalHeight,i=n/r;t.props.closeTextEditor(),t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),setTimeout((function(){gr.draw(n,o,t.props.layers.items,t.props.drawings,i,t.getStickerUrlById).then((function(e){var r=e.blob,n=e.width,o=e.height,i=t.props,a=i.layers,s=i.drawings,c=i.background,l=i.settings,p=Object(U.prepareStat)(a.items,s,c.currentBackgroundType,c.currentBackgroundId),d=Object(U.prepareMediaEditorStat)(a.items,l),u=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){u.push(t.getPreparedClickableZone(e,r))}))}));var _={original_width:n,original_height:o,clickable_stickers:u};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(p),mediaEditorAnalytics:JSON.stringify(d),clickableStickers:JSON.stringify(_)})})).catch((function(e){t.props.setSaveLoading(!1),console.error(e)}))}),0)},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,i=e.rotate*(Math.PI/180),a=e.x-e.width/2,s=e.y-e.height/2,c=parseFloat(e.x)+(a-e.x)*Math.cos(i)-(s-e.y)*Math.sin(i),l=parseFloat(e.y)+(s-e.y)*Math.cos(i)+(a-e.x)*Math.sin(i),p=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,a=r*Math.cos(i)-n*Math.sin(i),s=r*Math.sin(i)+n*Math.cos(i);return{x:(c+a)*o,y:(l+s)*o}})),d={type:r.action_type,clickable_area:p};return"link"===r.action_type?(d.link=r.action.link,r.action.tooltip_text_key&&(d.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(d.app_id=r.action.app_id,r.action.app_context&&(d.app_id=r.action.app_id)),d},t.handleKeyDown=function(e){if("Escape"==e.key&&t.props.layers.currentIndex&&t.props.layers.items[t.props.layers.currentIndex].isEdit&&(e.preventDefault(),e.stopPropagation(),t.props.closeTextEditor()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.shiftKey?t.props.redo():t.props.undo()),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(["Backspace","Delete"].includes(e.key))e.preventDefault(),t.props.layers.items[t.props.layers.currentIndex].canDelete&&t.props.deleteLayer();else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.key){case"ArrowUp":n.y-=o;break;case"ArrowDown":n.y+=o;break;case"ArrowLeft":n.x-=o;break;case"ArrowRight":n.x+=o}t.props.setLayerPosition(n.x,n.y)}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void([d.default.TABS.PAINT,d.default.TABS.FILTERS].includes(t.props.ui.currentMode)||(r&&r.type===d.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():(t.props.ui.currentMode===d.default.TABS.COLOR&&t.props.settings.blur.isEnabled&&t.moveBlurStart(e),n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null)))))},t.moveBlurStart=function(e){window.addEventListener("mousemove",t.moveBlurProcess),window.addEventListener("mouseup",t.moveBlurFinish),t.moveBlurProcess(e)},t.moveBlurProcess=function(e){var r=ae(e,document.querySelector(".EditorCanvas__canvas--bg")),n=r.x,o=r.y,i=r.width,a=r.height,s=[Math.max(0,Math.min(n/i,1)),1-Math.max(0,Math.min(o/a,1))];t.props.setBlurPosition(s)},t.moveBlurFinish=function(){window.removeEventListener("mousemove",t.moveBlurProcess),window.removeEventListener("mouseup",t.moveBlurFinish)},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var r,n=e.target.closest("[data-index]");r=n?+Object(Er.domData)(n,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==r&&t.props.setCurrentLayer(r);var o=ae(e,document.querySelector(".EditorCanvas__canvas--draw")),i=o.x,a=o.y;if(t.currentLayer=t.getCurrentLayer(),t.currentLayer){var s=t.currentLayer;s.isBackground&&s.locked?t.props.setCurrentLayer(null):(t.clientX=e.clientX,t.clientY=e.clientY,t.shiftX=i-t.currentLayer.x,t.shiftY=a-t.currentLayer.y)}},t.layerDragProcess=function(e){if(t.currentLayer){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ae(e,r),o=n.x,i=n.y;if(void 0!==t.shiftX&&void 0!==t.shiftY){var a=o-t.shiftX,s=i-t.shiftY;t.props.setLayerPosition(a,s),t.props.ui.isShowDropBox||t.props.setShowDropBox(!0)}}}},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ae(e,r),o=n.x,i=n.y,a=o-t.shiftX,s=i-t.shiftY;t.props.setLayerPosition(Math.round(a),Math.round(s)),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.addSticker=function(e,r){e.persist();var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=ae(e.nativeEvent,n),i=o.width,a=o.height;t.props.addLayerSticker({id:r,x:i/2,y:a/2,width:d.default.LAYER_DEFAULT_SIZE,height:d.default.LAYER_DEFAULT_SIZE,rotate:0,canDelete:!0,scale:1})}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},i=r.gravity,a=void 0===i?"center":i,s=r.rotation,c=void 0===s?0:s,l=r.translation_x,p=void 0===l?0:l,u=r.translation_y,_=void 0===u?0:u,h=r.relation_width;if(p=Math.min(Math.max(p,-1),1),_=Math.min(Math.max(_,-1),1),h&&(h=Math.min(Math.max(h,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,a,p,_,h).then((function(e){var r=e.url,n=e.x,o=e.y,i=e.stickerWidth,a=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(i),height:Math.round(a),rotate:-c,clickableZones:s,canDelete:!0,scale:1})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var f=h?n*h:d.default.LAYER_DEFAULT_SIZE,m=h?n*h:d.default.LAYER_DEFAULT_SIZE,g=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[g]){var b=le(a,n,o,f/2,m/2,p*n,_*o),v=b.x,E=b.y;t.props.addLayerSticker({id:g,x:v,y:E,width:f,height:m,rotate:-c,canDelete:!0,scale:1})}break;case"text":var w=.5;h&&(w=t.getFontSize(e.sticker.action.text,n*h,e.sticker.action.style));var O=t.getTextRect(e.sticker.action.text,w*d.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),y=(f=O.width,m=O.height,le(a,n,o,f/2,m/2,p*n,_*o));v=y.x,E=y.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:w,initialFontSize:w,rotate:-c,scale:1,x:v,y:E})}}))},t.prepareRenderableSticker=function(e,r,n,o,i){var a=t.props.data,s=a.artboardWidth,c=a.artboardHeight,l=a.originalWidth/s;return new Promise((function(t,a){"string"!=typeof e.url&&"string"!=typeof e.blob&&a();var p=e.url||e.blob||"";ie(p).then((function(a){var d=a.height/a.width,u=0,_=0;i?_=(u=s*i)*d:(u=a.width/l,_=a.height/l,u>s&&(_=(u=s)*d));var h,f=le(r,s,c,u/2,_/2,n*s,o*c),m=f.x,g=f.y;e.clickable_zones&&(h=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/a.width,y:e.y/a.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],Cr(Cr({},e),{clickable_area:t})}))),t({url:p,x:m,y:g,stickerWidth:u,stickerHeight:_,clickableZones:h})})).catch((function(){a()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t.uploadPhoto=function(e){ce().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object($e.getLang)("global_error")},Object($e.getLang)("stories_create_image_incorrect"))}))},t.setMode=function(e){var r=t.props.ui,n=t.props.background,o=n.currentBackgroundType,i=n.currentPhotoUrl;t.props.setCurrentLayer(null),e===d.default.BACKGROUND_MODES.PHOTO&&!i||o===d.default.BACKGROUND_MODES.PHOTO&&o===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):(t.props.setBackgroundType(e),e===d.default.BACKGROUND_MODES.BACKGROUND&&[d.default.TABS.COLOR,d.default.TABS.FILTERS].includes(r.currentMode)&&t.props.setMode(d.default.TABS.STICKERS))},t}return yr(t,e),t}(n.Component),Ar=Object.assign(s.ActionCreators,{setMode:Z,addLayerSticker:function(e){return Object(U.sendStat)(U.EVENTS.ADD_STICKER),V("ADD_LAYER_STICKER",{type:d.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,canDelete:e.canDelete,scale:e.scale})},addLayerText:G,addLayerImage:function(e){return V("ADD_LAYER_IMAGE",{type:d.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,clickableZones:e.clickableZones,canDelete:e.canDelete,scale:e.scale})},setLayerPosition:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:"SET_LAYER_POSITION",payload:{x:e,y:t}})}},deleteLayer:Y,setCurrentLayer:F,setDataLoaded:function(){return{type:"SET_DATA_LOADED"}},setShowDropBox:$,setSaveLoading:function(e){return{type:"SET_SAVE_LOADING",value:e}},closeTextEditor:X,setData:re,setBlurPosition:function(e){return{type:v,position:e}},setCurrentPhotoUrl:te,setBackgroundType:ee}),Pr=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data}}),Ar)(Sr),Tr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=d.default.CONTEXT_TYPES,r=d.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Tr(t,e),t.prototype.render=function(){var e,t,r;return window.cur.photoEditorStore=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},t=Object(s.newHistory)([],e,[]),r=l.composeWithDevTools(Object(a.applyMiddleware)(p.default)),Object(a.createStore)(W,t,r)),n.createElement(i.Provider,{store:window.cur.photoEditorStore},n.createElement(Pr,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:d.default.STORY_BASE_WIDTH,originalHeight:d.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=Rr},113:function(e,t,r){e.exports=r("aYW+")},"1VNw":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreators=t.ActionTypes=void 0;var n={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"};t.ActionTypes=n;var o={undo:function(){return{type:n.UNDO}},redo:function(){return{type:n.REDO}},jumpToFuture:function(e){return{type:n.JUMP_TO_FUTURE,index:e}},jumpToPast:function(e){return{type:n.JUMP_TO_PAST,index:e}},jump:function(e){return{type:n.JUMP,index:e}},clearHistory:function(){return{type:n.CLEAR_HISTORY}}};t.ActionCreators=o},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function i(e,t,r,i,a,s){o(e)&&n(t,r,i,a,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return i}))},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return n.isMemo(e)?a:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=a;var l=Object.defineProperty,p=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,_=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var o=_(r);o&&o!==h&&e(t,o,n)}var a=p(r);d&&(a=a.concat(d(r)));for(var s=c(t),f=c(r),m=0;m<a.length;++m){var g=a[m];if(!(i[g]||n&&n[g]||f&&f[g]||s&&s[g])){var b=u(r,g);try{l(t,g,b)}catch(e){}}}}return t}},"2zsc":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};t.default=function(e){var t=e.children,r=e.className,n=a(e,["children","className"]),s=t?String(t):"";return o.a.createElement("span",i({},n,{dangerouslySetInnerHTML:{__html:s},className:r||""}))}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"3f+a":function(e,t,r){"use strict";r.r(t);var n=class{constructor(e){this.link=e,this.onClick=this.onClick.bind(this)}onClick(){this.copyToClipboard(this.link),this.copy.classList.add("vk_app_copy_link__copy--hidden"),this.copied.classList.add("vk_app_copy_link__copied--visible"),setTimeout(()=>{this.copy.classList.remove("vk_app_copy_link__copy--hidden"),this.copied.classList.remove("vk_app_copy_link__copied--visible")},2400)}copyToClipboard(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var r=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),r&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(r))}renderCopied(){this.copied=document.createElement("span"),this.copied.classList.add("vk_app_copy_link__copied"),this.copied.innerHTML=getLang("vkapps_link_copied")}renderCopy(){this.copy=document.createElement("span"),this.copy.classList.add("vk_app_copy_link__copy"),this.copy.innerHTML=getLang("vkapps_link_copy"),this.copy.addEventListener("click",this.onClick)}render(){return this.linkEl=document.createElement("span"),this.linkEl.classList.add("vk_app_copy_link__container"),this.renderCopy(),this.renderCopied(),this.linkEl.appendChild(this.copy),this.linkEl.appendChild(this.copied),this.linkEl}},o=r("wZQE"),i=r("lNyc"),a=r("9kLB");t.default=class{constructor(){this.onHide=this.onHide.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.isVisible=!1}init(){var e;this.render(),(e=cur.app?cur.app.cont:ge("apps_test_id"))&&e.appendChild(this.container)}toggle(){this.isVisible?this.hide():this.show()}show(){var e,t;setTimeout(()=>this.container.classList.add("show"),300),this.container.addEventListener("click",this.onHide),this.isVisible=!0,this.container.setAttribute("aria-hidden",this.isVisible),cur.app&&Object(i.sendMessage)({type:(e=a.CONNECT_EVENTS.SHARE,t=a.EVENT_STATES.SUCCESS,void 0===t&&(t=a.EVENT_STATES.FIRE),""+e+t),data:{type:"qr"}},cur.app.cont)}hide(){setTimeout(()=>this.container.classList.remove("show"),300),this.container.removeEventListener("click",this.onHide),this.closeBtn.removeEventListener("click",this.onHide),this.isVisible=!1,this.container.setAttribute("aria-hidden",this.isVisible)}onHide(e){(e.target===this.container||e.target===this.closeBtn||this.closeBtn.contains(e.target))&&(this.hide(),this.destroy())}destroy(){this.container.parentNode.removeChild(this.container),this.callback&&this.callback()}_renderCloseBtn(){this.closeBtn=document.createElement("button"),this.closeBtn.setAttribute("type","button"),this.closeBtn.classList.add("vk_app_modal_close_btn"),this.closeBtn.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',this.closeBtn.addEventListener("click",this.onHide),this.container.childNodes[0].appendChild(this.closeBtn)}_renderOuter(){this.container=document.createElement("div"),this.container.classList.add("vk_app_modal_outer")}renderModal(){var e=new n(window.location.href);this.modal=document.createElement("div"),this.modal.classList.add("vk_app_modal_container","vk_app_modal_container--qr","vk_app_modal_container--flex","MiniAppModalContainer__qr");var t=window.location.href,r=o.createQR(t,120,"",{isShowLogo:!0});this.modal.innerHTML=`${r}\n<h2>${cur.backLang}</h2>\n<p>${getLang("vkapps_focus_camera_on_qr_code")}</p>`,this.modal.appendChild(e.render())}render(){this.container||this._renderOuter(),this.renderModal(),this.container.innerHTML="",this.container.appendChild(this.modal),this._renderCloseBtn(this.container)}}},"4zn2":function(e,t,r){"use strict";r.r(t),r.d(t,"API_VERSION",(function(){return n})),r.d(t,"VKPAY_TRANSACTION_EVENT",(function(){return o})),r.d(t,"PLATFORM",(function(){return i})),r.d(t,"CLIENT_SCHEME",(function(){return a})),r.d(t,"ERROR_CODES",(function(){return s})),r.d(t,"ERROR_REASONS",(function(){return c})),r.d(t,"ERROR_TYPES",(function(){return l})),r.d(t,"CLOSE_STATUS",(function(){return p})),r.d(t,"GROUP_STATUS",(function(){return d})),r.d(t,"VKPAY_APPS",(function(){return u})),r.d(t,"TEXTLIVE_APPS",(function(){return _})),r.d(t,"VK_CONNECT_EVENTS",(function(){return h}));var n="5.95",o="VKWebAppActionDone",i={WEB:"web",MOBILE_WEB:"mobile-web"},a={BRIGHT_LIGHT:"bright_light",SPACE_GRAY:"space_gray"},s={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,CUSTOM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11},c={UNSUPPORTED_PLATFORM:"Unsupported platform",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",NETWORK_ERROR:"Network error"},l={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},p=["success","failed"],d={OPEN:0,CLOSED:1,PRIVATE:2},u=[6217559,7131443],_=[7512376],h={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppGetCommunityAuthToken:"get_community_token",VKWebAppGetCommunityAuthTokenPreload:"get_community_scope",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_scope",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroup:"join_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppLeaveGroup:"leave_group",VKWebAppLeaveGroupPreload:"is_group_member",VKWebAppOpenApp:"open_app",VKWebAppGetUserInfo:"get_user_info",VKWebAppSendPayload:"send_payload",VKWebAppShowOrderBox:"order",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetGroupInfo:"get_group_info",VKWebAppGetGroupInfoPreload:"is_group_info_allowed"}},"59zB":function(e,t,r){"use strict";r.r(t);r("pIFo"),r("KKXr");var n,o=r("gdug"),i=r("t7n3"),a=r("zxIV"),s=r("Egk5"),c=r("7jxN"),l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),p=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function d(e){n&&p(n),n=l(e)}function u(e){return Object(i.isString)(e)&&"_"===e[0]?geByClass1(e):ge(e)}function _(e,t){if((e=u(e))&&Object(i.isFunction)(t)){if(o.browser.msie9||o.browser.opera&&o.browser.version<13){var r=!1,n=!1,a=function e(){if(!s.contentDocument)return setTimeout(e,100);s.contentDocument.defaultView.removeEventListener("resize",t),s.contentDocument.defaultView.addEventListener("resize",t),t()},s=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){n=!0,r&&a()}});return e.appendChild(s),e.__resizeSensor__=[s,function(){r=!0,n&&a()}]}var c=ce("div",{className:"ui_scroll_resize_sensor"}),l=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),p=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),d=ce("div"),_=ce("div"),h=null;return l.appendChild(d),p.appendChild(_),c.appendChild(l),c.appendChild(p),e.appendChild(c),e.__resizeSensor__=[c,l.onscroll=p.onscroll=function(){var r=(e.offsetWidth||1e4)+10,n=(e.offsetHeight||1e4)+10;d.style.width=r+"px",d.style.height=n+"px",l.scrollLeft=r,l.scrollTop=n,p.scrollLeft=r,p.scrollTop=n,h!==(h=r+" "+n)&&t()}]}}class h{constructor(e,t){if(!(e=u(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},t),this.options.native&&(this.options.shadows=!1),o.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,Object(i.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),Object(i.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),Object(i.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),Object(i.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),Object(i.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),Object(i.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),Object(i.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),Object(i.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),Object(i.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},Object(a.data)(this.el.container,"ui-scroll",this);var r=Object(a.cf)(),n=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),(function(e,t){t&&n.push("ui_scroll_"+t+"_theme")})),addClass(this.el.container,n.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),r.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),r.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),o.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var c=_(this.el.inner,this.resize.bind(this,!0)),l=_(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(c[0]),this.removeElements.push(l[0]),this.startResizeListening=function(){c[1](),l[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(r),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var p="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":o.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,p,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&Object(s.cancelEvent)(e):this.isScrollEventUnused(e)?Object(s.cancelEvent)(e):Object(s.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(e,t){this.addEvent(t,p,function(e){this.disabled||this.unnecessary||(this.scrollBy(h.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||Object(s.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;var t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){removeEvent(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,r,n){return this.removeEvents.push([e,t,r]),addEvent(e,t,r,void 0,void 0,n?{passive:!0}:void 0),r}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,(function(e,t){removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){for(var e=Object(a.cf)();this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return Object(a.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,(function(e,t){Object(a.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if(Object(i.isFunction)(e)){this.animation&&this.animation.stop();var t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if(Object(i.isFunction)(e)){this.animation&&this.animation.stop();var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){o.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",e?Object(a.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){var t=0,r=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,o.browser.mac&&o.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==r?15:2==r?450:1)}isScrollEventUnused(e){return h.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),Object(a.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,Object(s.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var t=(e.pageY-Object(a.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&Object(s.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(!this.disabled&&this.dragging&&!this.options.native){e||(e=window.event);var t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),Object(s.cancelEvent)(e),this.emitEvent("drag"),this.api}}scroll(e,t,r){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new c.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:c.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:Object(i.isFunction)(r)?r.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,Object(i.isFunction)(r)&&r(this.api)),this.api}scrollTop(e,t,r,n){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(Object(i.intval)(t),r,n)}scrollBottom(e,t,r,n){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-Object(i.intval)(t),r,n)}scrollBy(e,t,r){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+Object(i.intval)(e),t,r)}scrollIntoView(e,t,r,n){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=u(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var o=Object(a.getXY)(t)[1],s=Object(a.getXY)(this.el.overflow)[1],c=Object(a.getSize)(t)[1];if(o<=s&&o+c>=s+this.api.data.viewportHeight||o>=s&&o+c<=s+this.api.data.viewportHeight)Object(i.isFunction)(n)&&(r?setTimeout(n.bind(this.api),0):n(this.api));else if(c>this.api.data.viewportHeight||o<s)this.scrollTop(!1,o-s+this.api.data.scrollTop-(this.options.shadows?Object(a.getSize)(this.el.shadowTop)[1]:0),r,n);else{var l=this.options.shadows?Object(a.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,o-s+this.api.data.scrollTop+c-this.api.data.viewportHeight+l,r,n)}}return this.api}update(e){var t,r;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var n=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==n)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,n))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(r=(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var o=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==o)&&(this.barOuterHeight=o,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),d(()=>{var e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`})}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!r)&&Object(a.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!r),this.shadowBottom!=(this.api.data.scrollBottom&&!r)&&Object(a.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!r)),this.unnecessary!==r&&(Object(a.toggleClass)(this.el.container,"ui_scroll_unnecessary",r),this.unnecessary=r,this.options.stopScrollPropagation&&this.fixBlocker(),r&&this.barInnerHeight&&this.barOuterHeight&&d(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var r=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${r}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||n>=0)&&this.more(),!0}return!1}more(){var e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}}h.addResizeSensor=_;t.default=h},"5Hok":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return VkIframeApp}));var core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("KKXr"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Vd3H"),_shared_apps_xdm__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("lyAj"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("gdug"),_shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("xo6n"),_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4zn2"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("EasH"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4+be"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("jE6c"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("t7n3"),_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("z9Td"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("v+DW"),blueimp_md5__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("jYEY"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("59zB"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("lXE5"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("Egk5"),_web_apps_AppsUtils__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("F+Y4"),_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("d4g6"),IFRAME_APP_TYPE=1;class VkIframeApp{constructor(e,t,r,n){this.onReady=[],this.vkBridgeCallbacks=Object.create(null),this.funcs=Object.create(null),this.sessionLogger=null,this.frame=null,this.RPC=null,this.params=r||{},this.options=t||{},this.onInit=n,this._init(e),this._initSessionLogger()}isOpenInLayer(){return"layer"===this.params.source}checkExternalAppResponse(){cur.onExternalAppResults&&this.params.api_id===cur.onExternalAppResults.api_id&&(cur.onExternalAppResults.result&&this.runCallback("onExternalAppDone",cur.onExternalAppResults.result),cur.onExternalAppResults.error&&this.runCallback("onExternalAppFail",cur.onExternalAppResults.error)),cur.onExternalAppResults=null}runCallback(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];this.vkBridgeCallbacks[n]&&(this.vkBridgeCallbacks[n](...t.slice(1)),this.vkBridgeCallbacks[n]=null),this.options.type===IFRAME_APP_TYPE&&this.RPC.callMethod("runCallback",t),"onExternalAppClose"===n&&cur.clearVKMiniAppsLayerPopups&&cur.clearVKMiniAppsLayerPopups()}onAppReady(){for(var e in this.onReady)this.onReady.hasOwnProperty(e)&&this.onReady[e]()}setHeight(e){if(e){this.inlineApp&&e>this.options.heightMax&&!this.params.is_vkpay_service&&(e=this.options.heightMax);var t=e+"px";this.frame.style.height=t,this.options.boxed||(this.cont.style.height=t),this.options.layer&&WkView.onResize(),this.options.onResize&&this.options.onResize()}}isVkpayTransferLayer(){return!!this.params.is_vkpay_service&&(this.options.openapi?!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domCA)(this.cont,".vkPayOpenApiBox_transfer"):!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domCA)(this.cont,".vkpay_transfer"))}setWidth(e,t){var r=this.options.vkApp?600:100,n=165;e&&!this.inlineApp&&cur.app&&(e=Math.min(Math.max(e,r),1e3),this.options.layout_width&&(n=this.options.layout_width-e),this.isVkpayTransferLayer()&&t&&(this.cont.style.maxWidth="none",this.cont.style.minWidth="none"),this.options.layer?window.WkView.onResize():window.handlePageView&&window.handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,625)+n}),this.frame.style.width=this.cont.style.width=e+"px")}showProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(this.cont,"loading"),this.loaderEl=Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_15__.showProgress)(this.cont,"","pr_big app_container_progress",!0)}hideProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(this.cont,"loading"),this.loaderEl&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(this.loaderEl)}showDummy(e){if(this.cont&&~["no_flash","no_unity"].indexOf(e)){var t={act:e};"no_flash"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.iphone||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.ipad?"no_unity"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mobile||(t.screen=_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.amigo||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari?"install":"browser"):t.screen="install",ajax.post("al_apps.php",t,{onDone:e=>{cur.app&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(this.cont,"dummy"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(this.cont,e))},showProgress:this.showProgress.bind(this),hideProgress:this.hideProgress.bind(this)})}}balanceUpdated(e){this.runCallback("onBalanceChanged",e)}checkMethod(e,t,r){var n=e.toLowerCase();if("wall.post"===n||"activity.set"===n){var o=t["wall.post"===n?"message":"text"];return o||(o=""),t.attachments=this.getValidPostAttachments(t.attachments||t.attachment),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"wall_post_box",aid:this.options.aid,post_id:t.post_id,owner_id:t.owner_id,lat:t.lat,long:t.long,place_id:t.place_id,from_group:t.from_group,publish_date:t.publish_date,signed:t.signed,attachments:t.attachments,text:o,method:n},{params:{width:"430px",dark:1},onFail:function(e){e=e||"Unknown network error occurred",r&&r({error:{error_code:1,error_message:e}})}}),cur.apiWallPost=(n,o)=>{o?r&&r({error:o}):this.api(e,extend(t,{method_access:n}),r)},!1}return!0}checkMethodResult(e,t,r,n){switch(e){case"photos.saveProfilePhoto":if(!r.error)return cur.profilePhotoBoxCallback=e=>{n(e?{response:{photo_src:r.response.photo_src}}:{error:{error_code:10007,error_msg:"Operation denied by user"}}),window.profilePhotoBoxCallback=!1},this.funcs.showProfilePhotoBox(r.response.photo_hash),!1}return!0}initClientExternalApp(){this.clientRpc=new fastXDM.Client({},{safe:!0}),cur.onExternalAppDone=(e,t)=>{t=!!t,this.clientRpc.callMethod("externalAppDone",e,t)}}onLocChanged(e){e||(e=""),cur.appLoc!==e&&(cur.appLoc=e,this.runCallback("onLocationChanged",e))}api(method,inputParams,callback,captcha){if(2===arguments.length&&(inputParams={}),inputParams||(inputParams={}),captcha||inputParams.method_access||inputParams.method_force||this.checkMethod(method,inputParams,callback)){delete inputParams.callback,delete inputParams.access_token;var params={v:"5.95",api_id:this.params.api_id,method,format:"json",rnd:parseInt(1e4*Math.random())};if(inputParams)for(var i in inputParams)inputParams.hasOwnProperty(i)&&(i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)(i),/^(rnd|format|api[\s.\[_]id|method|callback|access[\s.\[_]token)(\s*\[|$)/.test(i)||(params[i]=inputParams[i]));var lParams=[];for(var _i in params)params.hasOwnProperty(_i)&&lParams.push([_i,params[_i]]);lParams.sort(sName);var sig=this.params.viewer_id;for(var _i2 in lParams)lParams.hasOwnProperty(_i2)&&(sig+=lParams[_i2][0]+"="+lParams[_i2][1]);sig+=this.params.secret,params.sid=this.params.sid,params.sig=blueimp_md5__WEBPACK_IMPORTED_MODULE_16__(sig);var done=text=>{var response=eval("("+text+")");if(response.error&&14===response.error.error_code)cur.appCaptcha=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showCaptchaBox)(response.error.captcha_sid,0,!1,{onSubmit:(e,t)=>{inputParams.captcha_sid=e,inputParams.captcha_key=t,this.api(method,inputParams,callback,!0),cur.appCaptcha.setOptions({onHide:function(){}}).hide()},onHide:()=>{callback(response)},imgSrc:response.error.captcha_img});else{if(captcha&&cur.appCaptcha.setOptions({onHide:function(){}}).hide(),!this.checkMethodResult(method,inputParams,response,callback))return;callback&&callback(response)}},fail=()=>{callback&&callback({error:{error_code:1,error_message:"Unknown network error occurred"}})};ajax.plainpost(this.params.api_script||"/api.php",params,done,fail)}function sName(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}}getValidPostAttachments(e){var t=/(^https?:\/\/)|(^(poll|album|photo|video|doc|audio|page|note)-?\d+_-?\d+)$/,r=[];return e=e||[],isString(e)&&(e=e.split(",")),each(e,(function(){var e=this.trim();t.test(e)&&r.push(e)})),r.join(",")}startHandleWheelEvent(){this._wheelEventListener||stManager.add(["ui_common.js"],()=>{this._wheelEventListener=e=>{var t=_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_17__.default.scrollEventDelta(e);this.runCallback("onWheel",t,document.documentElement.clientHeight)},addEvent(window,_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browserFeatures.wheelEvent,this._wheelEventListener),cur.destroy.push(()=>{this._wheelEventListener&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(window,_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browserFeatures.wheelEvent,this._wheelEventListener)})})}stopHandleWheelEvent(){this._wheelEventListener&&(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(window,"wheel",this._wheelEventListener),this._wheelEventListener=null)}getQueryParts(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n="";void 0!==e[r]&&(n="object"==typeof e[r]?encodeURIComponent(JSON.stringify(e[r])):encodeURIComponent(e[r])),t.push(encodeURIComponent(r)+"="+n)}return t}openAppInLayer(e,t,r,n){cur.openerAppsQueue=cur.openerAppsQueue||[],cur.openerAppsQueue.push(this),n=n||{},showWiki({w:e},null,null,extend(n,{queue:1,onHide:()=>{cur.openerAppsQueue.length>0&&(cur.app=cur.openerAppsQueue.pop()),t&&t(this.params.api_id)},noClickHide:r}))}getOpenerApp(){return cur.openerAppsQueue&&cur.openerAppsQueue[cur.openerAppsQueue.length-1]}close(e){if(this.params.is_vkpay_service&&window.Apps.closeExternalApp(),!window.WkView||this.params.is_mobile)if(window.opener){if(e){window.opener.postMessage({method:"closeApp"},"*")}window.close()}else e&&this.runCallback("onCloseApp"),window.nav.objLoc.back?window.location.href=nav.objLoc.back:window.nav.go("/feed");else window.WkView.hide(!1,!0)}setVkPayMobileHeight(){if(this.params.is_vkpay_service&&this.params.is_mobile){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;(_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari_mobile)&&(e+=window.pageYOffset),e+="px",this.frame.style.minHeight=e,this.frame.style.height=e,this.cont.style.minHeight=e,this.cont.style.height=e}}apiCallback(){}registerVkBridgeCallback(e,t){this.vkBridgeCallbacks[e]=t}_init(e){(!window.parent||window.parent===window||this.options.checking||this.options.openapi||this.options.embed)&&(this.cont=document.getElementById(e),this.cont&&(this._prepareParamsAndOptions(),this._initPublicApi(),this.isOpenInLayer()&&this.onReady.push(this.checkExternalAppResponse.bind(this)),this._initDestroy()))}_prepareParamsAndOptions(){this._makeHashParam(),this.options.inlineApp&&(this.inlineApp=!0),this.options=extend({heightMax:4500},this.options),this.params.widget&&(this.options.type=IFRAME_APP_TYPE,this.options.widget=!0)}_initPublicApi(){if(this.options.type!==IFRAME_APP_TYPE)throw new Error("Invalid application type");this._definePublicApi(),this.options.no_init||(this._initXDMClient(),this.params.widget&&setTimeout((function(){self.inited||show("app_connect_error")}),8e3))}_initXDMClient(){var e=this._getIframeUrl(),t=this.options.vkApp?{}:this.funcs;this.options.layer?this.RPC=new fastXDM.Server(t,e=>Object(_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__.filterPostMessageOrigin)(this.options,e),{layer:1}):this.RPC=new fastXDM.Server(t,e=>Object(_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__.filterPostMessageOrigin)(this.options,e));var r={src:e,width:"100%",overflow:"hidden"};this.options.vkApp?r.vkApp=!0:r.scrolling="no",this.options.widget||(r.height=this.options.height);var n='webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true" allow="geolocation; microphone; camera; autoplay;"';this.options.iframe_background_color&&(n+=` style="background-color: ${this.options.iframe_background_color};"`),this.frame=this.RPC.append(this.cont,r,n)}_definePublicApi(){this.funcs.onInit=()=>(this.options.heightSync&&this.RPC.callMethod("getHeight",e=>{this.setHeight(e)}),this.inited||(this.onInit&&this.onInit(),this.inited=!0,this.inlineApp||this.onAppReady()),this.sessionLogger&&this.sessionLogger.start(),!0),this.funcs.ApiCall=(e,t)=>{var r=e.shift();this.api(r,e[0],t)},this.funcs._getAppInfo=e=>{e([this.params.api_id,window.location.hash])},this.funcs.api=(e,t,r)=>{this.api(t,r,t=>{this.apiCallback(e,t)})},this.funcs.setHeight=e=>{this.setHeight(e)},this.funcs.scrollWindow=(e,t)=>{if(!this.inlineApp){var r=Math.max(e,0);t=Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.intval)(t),this.options.layer?this.params.is_vkpay_service&&window.wkLayerWrap&&animate(window.wkLayerWrap,{scrollTop:r},t):t&&t>0?(animate(htmlNode,{scrollTop:r},t),animate(bodyNode,{scrollTop:r},t)):window.scroll(0,r)}},this.funcs.scrollTop=()=>{var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.appTopOffset||(cur.appTopOffset=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getXY)(this.cont)[1]);var t=0;window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&(t=1),this.runCallback("onScrollTop",parseInt(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.scrollGetY)()),parseInt(e),parseInt(cur.appTopOffset),t)},this.funcs.scrollSubscribe=e=>{var t,r=this.isOpenInLayer();t=r&&ge("wk_layer_wrap")||(_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie6?pageNode:window);var n=()=>{var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,n=r?()=>t.scrollTop:_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.scrollGetY;this.runCallback("onScroll",parseInt(n()),parseInt(e))},o=()=>{addEvent(t,"scroll",n)};o(),e&&n(),cur._back?(cur._back.show.push(o),cur._back.hide.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(t,"scroll",n)})):cur.destroy.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(t,"scroll",n)})},this.funcs.showRequestBox=(e,t,r)=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_request_box",aid:cur.aid,message:t,uid:e,request_key:r},{params:{width:430,dark:1},onFail:e=>(this.runCallback("onRequestFail",e),!0)})},this.funcs.showInstallPushBox=()=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_install_push_box",aid:cur.aid},{params:{width:430,dark:1},onFail:e=>(this.runCallback("onInstallPushFail",e),!0)})},this.funcs.showProfilePhotoBox=e=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_profile_photo_box",hash:e,aid:cur.aid},{params:{dark:1}})},this.funcs.setTitle=e=>{var t=this.options.is_textlive_app;if((!this.options.vkApp||t)&&!this.inlineApp){e=e.replace(/[<>]+/gi,"");var r="",n=" | ";t?n="":r=cur.backLang||Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_vkontakte"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setDocumentTitle)(r+(e?n+e:""))}},this.funcs.resizeWindow=(e,t,r)=>{this.options&&this.options.is_widescreen_mode||(this.setWidth(e,r),this.setHeight(t,r),e=this.frame.clientWidth,t=this.frame.clientHeight,this.runCallback("onWindowResized",e,t))},this.funcs.getLocationProtocol=e=>{e(location.protocol)},this.funcs.setLocation=(e,t)=>{e=e.toString(),cur.appLoc=e,t&&this.runCallback("onLocationChanged",e),window.nav.setLoc(extend(nav.objLoc,{"#":e}))},this.funcs.showInstallBox=()=>{if(!this.options.vkApp)if(cur.appUser)Apps.onAppAdded();else{if(cur.installBoxShown)return;cur.installBoxShown=!0,Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"install_box",aid:this.options.aid},{params:{dark:1}}).setOptions({onHide:()=>{setTimeout(()=>{cur.installBoxShown=!1},3e3)}})}},this.funcs.showSettingsBox=e=>{if(!this.options.vkApp&&!cur.settingsBoxShown){cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=(e,t)=>{cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?this.runCallback("onSettingsChanged",t):this.runCallback("onSettingsCancel"))},cur.settingsBoxShown=!0;var t={act:"settings_box",aid:this.options.aid,mask:e};this.options.gid&&(t.gid=this.options.gid),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",t,{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(()=>{cur.settingsBoxShown=!1},3e3)}})}},this.funcs.showGroupSettingsBox=e=>{this.options.vkApp||(cur.settingsBoxShown||(cur.settingsBoxShown=!0,this.options.gid&&(cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=(e,t,r)=>{cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?this.runCallback("onGroupSettingsChanged",t,r):this.runCallback("onGroupSettingsCancel"))},Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"group_settings_box",aid:this.options.aid,mask:e,gid:this.options.gid},{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(()=>{cur.settingsBoxShown=!1},3e3)}}))))},this.funcs.showAppWidgetPreviewBox=(e,t)=>{if(!this.options.vkApp&&!cur.appWidgetPreviewBox&&this.options.gid){cur.appWidgetPreviewBox=!0;var r=()=>{delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout(()=>{delete cur.appWidgetPreviewBox},3e3)};cur.onAppWidgetPreviewFail=e=>{r(),this.runCallback("onAppWidgetPreviewFail",e)},cur.onAppWidgetPreviewCancel=()=>{r(),this.runCallback("onAppWidgetPreviewCancel")},cur.onAppWidgetPreviewSuccess=()=>{r(),this.runCallback("onAppWidgetPreviewSuccess")};var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"app_widget_preview_box",aid:this.options.aid,gid:this.options.gid,type:e,code:t},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{n.setOptions({onHide:()=>{Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}},this.funcs.showAllowMessagesFromCommunityBox=e=>{if(!this.options.vkApp&&!cur.allowMessagesFromCommunityBox){cur.allowMessagesFromCommunityBox=!0,cur.allowMessagesFromCommunityStatus="",cur.onAllowMessagesFromCommunity=e=>{"ok"===e?this.runCallback("onAllowMessagesFromCommunity"):this.runCallback("onAllowMessagesFromCommunityCancel")};var t={act:"allow_messages_from_community_box",aid:this.options.aid};t.gid=e||this.options.gid,Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",t,{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.onAllowMessagesFromCommunity(cur.allowMessagesFromCommunityStatus),setTimeout(()=>{cur.allowMessagesFromCommunityBox=!1},3e3)}})}},this.funcs.showInviteBox=(e,t)=>{this.options.vkApp||Apps.showInviteBox(this.options.aid,this.options.hash,e,t)},this.funcs.showPaymentBox=e=>{Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_payment_box",votes:e,aid:this.options.aid},{params:{dark:1}})},this.funcs.showLeadsPaymentBox=e=>{Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_payment_box",aid:this.options.aid,offers:isArray(e)?e.join(","):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.intval)(e)||1},{params:{dark:1}})},this.funcs.showOrderBox=e=>{if(!this.options.vkApp){if("object"!=typeof e){var t=Array.prototype.slice.call(arguments);e={},each(t,(function(){var t=this.split("=");2===t.length&&(e[t[0]]=t[1])}))}var r={};for(var n in e)Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(n,["type","votes","offer_id","item","currency"])&&(r[n]=e[n]+"");"offers"===r.type&&isArray(r.offer_id)&&(r.offer_id=r.offer_id.join(",")),r.act="show_order_box",r.aid=this.options.aid,r.hash=this.options.hash,this.params.sales_ref&&(r.sales_ref=this.params.sales_ref),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",r,{params:{dark:1},onFail:e=>(void 0===e&&this.options.embed||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_error")},e),!0)}),cur.onAppOrderCancel=()=>{this.runCallback("onOrderCancel")},cur.onAppOrderSuccess=e=>{this.runCallback("onOrderSuccess",e)},cur.onAppOrderFail=e=>{this.runCallback("onOrderFail",e)}}},this.funcs.showSubscriptionBox=(e,t)=>{if(!this.options.vkApp){if("object"!=typeof t){var r=Array.prototype.slice.call(arguments);t={},each(r,(function(){var e=this.split("=");2===e.length&&(t[e[0]]=e[1])}))}var n={act:"show_subscription_box",aid:this.options.aid,action:e,hash:this.options.hash};"create"===n.action?n.item=t.item:"resume"!==n.action&&"cancel"!==n.action||(n.subscription_id=t.subscription_id),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",n,{onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_error")},e),!0)}),cur.onSubscriptionCancel=()=>{this.runCallback("onSubscriptionCancel")},cur.onSubscriptionSuccess=e=>{this.runCallback("onSubscriptionSuccess",e)},cur.onSubscriptionFail=e=>{this.runCallback("onSubscriptionFail",e)}}},this.funcs.addToMenu=()=>{ajax.post("al_apps.php",{act:"add_left_menu",aid:cur.aid,hash:this.options.hash},{onDone:function(e){Apps.updateLeftNav(e.left_nav),Apps.addToMenuErrorResolve(e),Apps.updateAddToMenuAction()}})},this.funcs.adsPublish=()=>{AdsLight.handleEvent.apply(AdsLight,arguments)},this.funcs.debug=()=>{window.debugLog(1===arguments.length?arguments[0]:arguments)},this.funcs.openExternalApp=(e,t,r)=>{if(e){var n=["pay-to-user","pay-to-service","pay-to-group","transfer-to-user","transfer-to-group","open-service","add-card","recurrent"],o=["pay-to-user","transfer-to-user"],i=["pay-to-group","transfer-to-group"],a=this.options.vkApp;if(t&&~n.indexOf(t.action))if(!~o.indexOf(t.action)||t.user_id)if(!~i.indexOf(t.action)||t.group_id)if("open-service"!==t.action||this.params.is_vkpay){var s="open-service"!==t.action;if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(t.data))try{t.data=JSON.stringify(t.data)}catch(e){t.data=""}var c="",l=[];if(t&&(t.aid=this.options.aid,c=e+"?"+(l=this.getQueryParts(t)).join("&")),c){var p,d=!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mozilla&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msi&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie_edge,u=!1;if("open-service"===t.action){var _=/^app(\d+)(?:_-(\d+))?$/.exec(e),h=this.options.vkpay_not_layer_services||[],f=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.positive)(_[1]);_&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(f,h)&&(u=!0,d&&(p=window.open("","_blank"))),this.params.is_vkpay_service&&this.params.is_mobile&&(u=!0,d&&(p=window.open("","_blank")))}ajax.post("al_apps.php",{act:"open_external_app",url:e,q:l.join("&"),aid:this.options.aid},{onDone:(e,r)=>{if(r){if("open-service"===t.action&&u)return e=decodeURIComponent(e),p?void(p.location.href="/"+e):this.params.is_mobile?void(window.location.href="/"+e):void nav.go("/"+e);this.openAppInLayer(e,()=>{cur.onExternalAppDone&&(cur.onExternalAppResults?this.checkExternalAppResponse():this.runCallback("onExternalAppClose"),cur.onExternalAppDone=null)},s),cur.onExternalAppDone=(e,t)=>{t=!!t,this.isOpenInLayer()||t?cur.onExternalAppResults={api_id:this.params.api_id,result:e}:(cur.onExternalAppResults=null,this.runCallback("onExternalAppDone",e)),t||(cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0))}}},onFail:e=>{try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}return p&&p.close(),a?r(e.error):this.runCallback("onExternalAppFail",e.error),!0}})}}else a?r({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else this.options.vkApp?r({error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else a?r({error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else a?r({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM})}},this.funcs.externalAppDone=(e,t)=>{if(cur.onExternalAppDone?cur.onExternalAppDone(e,t):t||window.WkView&&WkView.hide(!1,!0),this.params.is_mobile||window.opener&&window.opener.vk&&window.opener.vk.platform===_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_13__.PLATFORM_MVK){if(window.opener){var r={method:"externalAppDone",params:e};window.opener.postMessage(r,"*")}this.close(!1)}},this.funcs.externalAppFail=e=>{if(!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(e))try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}var t=this.getOpenerApp();t&&t.isOpenInLayer()?cur.onExternalAppResults={api_id:t.params.api_id,error:e.error}:t&&t.runCallback("onExternalAppFail",e.error),cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0)},this.funcs.closeExternalApp=()=>{Apps.closeExternalApp()},this.funcs.closeApp=()=>{this.params.is_vkpay_service&&this.close(!0)},this.funcs.sendStats=e=>{(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(e)||isArray(e))&&(e=JSON.stringify(e)),ajax.post("al_apps.php",{act:"save_stats",data:e,hash:this.params.stats_hash,app_id:cur.aid},{onDone:()=>{this.runCallback("onSendStatsDone")},onFail:()=>(this.runCallback("onSendStatsFail"),!0)})},this.funcs.showWallPostBox=(e,t,r)=>{if(e.message||e.attachments&&e.attachments.length)this.api("wall.post",e,e=>{e.error?r?r(e.error):this.runCallback("onShowWallPostBoxCancel",e.error):t?t({post_id:e.response.post_id}):this.runCallback("onShowWallPostBoxDone")});else{var n={error_code:100,error_msg:"One of the parameters specified was missing or invalid"};r?r(n):this.runCallback("onShowWallPostBoxCancel",n)}},this.funcs.enableBodyScroll=()=>{this.params.is_vkpay_service&&cur.bodyScrollDisabled&&(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.enableBodyScroll)(),cur.bodyScrollDisabled=!1,this.runCallback("onBodyScrollDisabled"))},this.funcs.disableBodyScroll=()=>{this.params.is_vkpay_service&&!cur.bodyScrollDisabled&&(cur.destroy.push((function(){cur.bodyScrollDisabled&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.enableBodyScroll)()})),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.disableBodyScroll)(),cur.bodyScrollDisabled=!0,this.runCallback("onBodyScrollEnabled"))},this.funcs.startHandleWheelEvent=()=>{this.params.is_vkpay_service&&this.startHandleWheelEvent()},this.funcs.stopHandleWheelEvent=()=>{this.params.is_vkpay_service&&this.stopHandleWheelEvent()},this.funcs.startHandleDeviceOrientation=()=>{this.runCallback("onDeviceOrientationNotSupported")},this.funcs.unIdle=()=>{this.sessionLogger&&this.sessionLogger.unIdle()},this.funcs.idle=()=>{this.sessionLogger&&this.sessionLogger.idle()},this.funcs.checkUnitySupport=()=>{Object(_web_apps_AppsUtils__WEBPACK_IMPORTED_MODULE_20__.detectUnityWebPlayer)(e=>{e?this.runCallback("onCheckUnitySupportSuccess"):(this.showDummy("no_unity"),this.runCallback("onCheckUnitySupportFail"))})},this.funcs.checkFlashSupport=e=>{(e=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.positive)(e))||(e=9),window.browser.flash>=e?this.runCallback("onCheckFlashSupportSuccess"):(this.showDummy("no_flash"),this.runCallback("onCheckFlashSupportFail"))}}_initDestroy(){window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.RPC&&this.RPC.destroy()})}_initSessionLogger(){this.options.log_session&&!this.options.vkApp&&(this.sessionLogger=new _shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_7__.default(window.cur.aid),cur.destroy.unshift(()=>{this.sessionLogger.stop()}))}_getIframeUrl(){var e="";if(this.options.type===IFRAME_APP_TYPE)if(this.options.vkApp){e=this.options.vk_app_url;var t=this.options.hash_as_param,r=this.params.hash?""+this.params.hash:location.hash.substr(1);this.params.hash?r=this.params.hash:location.hash&&(r=location.hash.substr(1)),r&&(t&&(e+="&hash="+r),e+="#"+r)}else{e=this.options.src;var n=[];for(var o in this.params)this.params.hasOwnProperty(o)&&("hash"===o?n.push(o+"="+encodeURIComponent(this.params[o])):n.push(o+"="+this.params[o]));e+=(-1===e.indexOf("?")?"?":"&")+n.join("&")}return e}_makeHashParam(){if(this.params.hash=this.params.hash||"",-1!==this.params.hash.indexOf("#")){var e=this.params.hash.split("#").pop();(e||"").substr(0,1)===window.vk.navPrefix?this.params.hash="":this.params.hash=e}}}},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",(function(){return a}));var n=r("nAFc"),o=r("4+be"),i={};function a(e,t,r){void 0===t&&(t=!1);var a="number"==typeof t,s=t||a,c=e+(s?".raw":"");if(void 0===i[c]){var l=s?Object(o.getLang)(e,"raw"):Object(o.getLang)(e);"string"==typeof l?i[c]=Object(n.decodeHTMLEntities)(l):Array.isArray(l)&&(i[c]=l.map(n.decodeHTMLEntities))}if(a){var p=t;return Object(o.langNumeric)(p,i[c],r)}return i[c]||""}t.default={getLang:a}},"6tUA":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("pIFo");var n=r("EasH"),o=r("4+be"),i=r("RbYe"),a=r("kcIO"),s=r("jE6c"),c=r("RJZa"),l=r("v+DW");class p{static share(e,t,r){Object(c.confirm)(getLang("apps_share_to_story_title"),getLang("apps_share_to_story_message")).then(()=>{var n=Object(a.curBox)();if(n){var o=n.btns.ok[0];Object(l.lockButton)(o)}p.start(e,t,r)}).catch(()=>{Object(a.curBox)().hide()})}static start(e,t,r){ajax.post("/apps",{act:"get_share_to_story_upload_data",hash:r,promo:e,gift_type:t,ref:cur.module},{onDone:p.publishStory,onFail:e=>{Object(n.showFastBox)(getLang("global_error"),e)}})}static publishStory(e){var t=e.upload_image_src,r=e.upload_url;t&&r&&fetch(t).then(e=>e.blob()).then(e=>{var t=new FormData,n=encodeURIComponent(`story_share_${Object(s.irand)(0,99999)}.jpg`);return t.append("file0",e,n),fetch(r,{method:"POST",body:t})}).then(()=>{Object(a.showDoneBox)(getLang("apps_share_to_story_success"));var e=Object(a.curBox)();e&&e.hide()}).catch(()=>{Object(n.showFastBox)(getLang("global_error"),getLang("apps_share_to_story_error"))})}}var d=r("W9Tc");class u{static isEnabled(){return Object(d.partConfigEnabled)("apps_fortune_wheel")}static defineFortuneWheel(){window.cur.FortuneWheel=new u,window.cur.FortuneWheel.init()}constructor(){this.wheelImageEl=null,this.restTextEl=null,this.spinButtonEl=null,this.lastGiftSector=-1,this.restCount=0,this.possibleSpinByOrder=!1,this.lastGiftData=null,this.wheelTimeout=0,this.resetTimeout=0,this.weheelInProgress=!1}init(){this.wheelImageEl=document.querySelector(".FortuneWheelBanner__wheelImage"),this.restTextEl=document.querySelector(".FortuneWheelBanner__spinRestCount"),this.spinButtonEl=document.querySelector(".FortuneWheelBanner__spinButton"),this.wheelImageEl&&this.restTextEl&&this.spinButtonEl&&(this.restCount=+this.restTextEl.dataset.restSpins,this.possibleSpinByOrder=Boolean(+this.restTextEl.dataset.possibleOrder),window.cur=window.cur||{},window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.destroy()}))}destroy(){this.wheelTimeout&&clearTimeout(this.wheelTimeout),this.resetTimeout&&clearTimeout(this.resetTimeout),this.weheelInProgress&&(this.sendNotify(this.lastGiftData),this.updateRestSpinsByGift(this.lastGiftData),this.updateButtonState(),this.wheelImageEl.classList.remove("FortuneWheelBanner__wheelImage--start"+this.lastGiftSector),this.wheelImageEl.classList.remove("FortuneWheelBanner__wheelImage--gift"+this.lastGiftSector),this.weheelInProgress=!1)}spin(e,t){this.lastGiftData=null,ajax.post("/apps",{act:"fortune_spin",hash:t},{onDone:t=>{this.onSpinWheelSuccess(e,t)},onFail:e=>{Object(n.showFastBox)(Object(o.getLang)("global_error"),e)},showProgress:()=>{this.disableButton()}})}disableButton(){this.spinButtonEl.disabled="disabled",this.spinButtonEl.classList.add("FortuneWheelBanner__spinButton--disabled")}enableButton(){this.spinButtonEl.disabled=!1,this.spinButtonEl.classList.remove("FortuneWheelBanner__spinButton--disabled")}onSpinWheelSuccess(e,t){if(this.wheelImageEl){this.wheelImageEl.classList.add("FortuneWheelBanner__wheelImage--gift"+t.wheel_sector),this.lastGiftSector=t.wheel_sector,this.lastGiftData=t,this.weheelInProgress=!0;var r=t.wheel_sector>=0?10600:0;this.updateRestSpins(),this.wheelTimeout=setTimeout(()=>{this.updateRestSpinsByGift(t),this.showGiftBox(t),this.updateButtonState(),this.sendNotify(t),this.weheelInProgress=!1},r)}}sendNotify(e){e&&ajax.post("/apps",{act:"fortune_notification",gift_id:e.gift_id,hash:e.data_hash})}updateRestSpinsByGift(e){"spin"===e.gift_type&&(this.restCount+=2,this.updateRestSpins())}updateRestSpins(){this.restCount--,this.restCount?this.restTextEl.textContent=Object(o.langNumeric)(this.restCount,cur.lang.apps_black_friday_rest_spins).replace("{count}",this.restCount):this.possibleSpinByOrder?this.restTextEl.textContent=Object(o.getLang)("apps_black_friday_rest_spin_by_order"):this.restTextEl.textContent=Object(o.getLang)("apps_black_friday_no_rest_spin"),this.restTextEl.dataset.restSpins=this.restCount}updateButtonState(){this.restCount?this.enableButton():this.disableButton()}showGiftBox(e){switch(e.gift_type){case"game":this.showGameGiftBox(e);break;case"votes_3":case"votes_10":case"votes_100":this.showVotesGiftBox(e);break;case"spin":this.showSpinGiftBox();break;default:Object(n.showFastBox)(Object(o.getLang)("global_error"),Object(o.getLang)("global_error"))}}reInitWheelPosition(){this.wheelImageEl.classList.remove("FortuneWheelBanner__wheelImage--gift"+this.lastGiftSector),this.wheelImageEl.classList.add("FortuneWheelBanner__wheelImage--start"+this.lastGiftSector),this.resetTimeout=setTimeout(()=>{this.wheelImageEl.classList.remove("FortuneWheelBanner__wheelImage--start"+this.lastGiftSector)},1100)}showGameGiftBox(e){var t=Object(o.getLang)("apps_black_friday_gift_popup_game_desc").replace("{app_name}",e.app_name),r=Object(d.partConfigEnabled)("apps_promo_share_story")?`<a class="FortuneWheelGiftPopup__shareLink" onclick="cur.FortuneWheel.share()">${Object(o.getLang)("apps_black_friday_gift_popup_share")}</a>`:"",n=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(o.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${t}</div>\n        <div class="FortuneWheelGiftPopup__appIcon">\n          <img src="${Object(s.escapeAttr)(e.app_icon)}" class="FortuneWheelGiftPopup__appIconImg">\n        </div>\n        <div class="FortuneWheelGiftPopup__appName">${e.app_name}</div>\n        <a class="flat_button FortuneWheelGiftPopup__appHref" href="${Object(s.escapeAttr)(e.app_href)}">\n          ${Object(o.getLang)("apps_black_friday_gift_popup_game_run")}\n        </a>\n        ${r}\n      </div>\n    </div>\n    `;this.showBox(n,"FortuneWheelGiftPopup FortuneWheelGiftPopup--game")}showSpinGiftBox(){var e=Object(o.getLang)("apps_black_friday_gift_popup_spin_desc"),t=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(o.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${e}</div>\n         <a class="flat_button FortuneWheelGiftPopup__spinHref" onclick="curBox().hide(true)">\n           ${Object(o.getLang)("apps_black_friday_gift_popup_spin_button")}\n        </a>\n      </div>\n    </div>\n    `;this.showBox(t,"FortuneWheelGiftPopup FortuneWheelGiftPopup--spin")}showVotesGiftBox(e){var t={votes_100:100,votes_10:10,votes_3:3},r=t[e.gift_type],n=Object(o.langNumeric)(r,cur.lang.apps_black_friday_gift_popup_votes_desc).replace("{count}",r),i=Object(d.partConfigEnabled)("apps_promo_share_story")?`<a class="FortuneWheelGiftPopup__shareLink" onclick="cur.FortuneWheel.share()">${Object(o.getLang)("apps_black_friday_gift_popup_share")}</a>`:"",a=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(o.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${n}</div>\n        <div class="FortuneWheelGiftPopup__codeControls">\n          <div class="FortuneWheelGiftPopup__code">\n            <span class="FortuneWheelGiftPopup__codeText">${e.promo_code}</span>\n            <a class="FortuneWheelGiftPopup__copy" onclick="cur.FortuneWheel.copyCode()"></a>\n          </div>\n          <a class="flat_button FortuneWheelGiftPopup__activateCodeHref" href="/settings?act=payments&w=promocode${Object(s.escapeAttr)(this.lastGiftData.promo_code)}">\n            ${Object(o.getLang)("apps_black_friday_gift_activate_code")}\n          </a>\n        </div>\n        ${i}\n        <div class="FortuneWheelGiftPopup__footer">\n          ${Object(o.getLang)("apps_black_friday_gift_activate_code_help")}\n        </div>\n       </div>\n    </div>\n    `;this.showBox(a,"FortuneWheelGiftPopup FortuneWheelGiftPopup--votes")}showBox(e,t){new n.MessageBox({title:!1,width:400,containerClass:t,noControls:!0,hideOnBGClick:!1,onDestroy:()=>{this.reInitWheelPosition()},onHideAttempt:e=>e}).content(e).show()}copyCode(){this.lastGiftData&&(Object(i.copyToClipboard)(this.lastGiftData.promo_code),Object(a.showDoneBox)(Object(o.getLang)("apps_black_friday_gift_code_copy_success"),{timeout:1e3}))}share(){this.lastGiftData&&p.share("fortune_wheel",this.lastGiftData.gift_type,this.lastGiftData.share_hash)}}},"754W":function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}t.default=e=>{var t=e.children,r=e.className,s=a(e,["children","className"]),c=Object(o.classNames)("LinkButton",r),l=i({},s,{onMouseDown:e=>{e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return n.createElement("button",i({},l,{className:c}),t)}},"9O7i":function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:"string"==typeof e?[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseActions=n,t.isHistory=function(e){return void 0!==e.present&&void 0!==e.future&&void 0!==e.past&&Array.isArray(e.future)&&Array.isArray(e.past)},t.includeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0}},t.excludeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)<0}},t.combineFilters=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}),(function(){return!0}))},t.groupByActionTypes=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0?e.type:null}},t.newHistory=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{past:e,present:t,future:r,group:n,_latestUnfiltered:t,index:e.length,limit:e.length+r.length+1}}},"9kLB":function(e,t,r){"use strict";var n,o;r.r(t),r.d(t,"EVENT_STATES",(function(){return n})),r.d(t,"CONNECT_EVENTS",(function(){return o})),function(e){e.FIRE="",e.FAILURE="Failed",e.SUCCESS="Result"}(n||(n={})),function(e){e.ADD_TO_COMMUNITY="VKWebAppAddToCommunity",e.ADD_TO_COMMUNITY_PRELOAD="VKWebAppAddToCommunityPreload",e.ADD_TO_FAVORITES="VKWebAppAddToFavorites",e.ADD_TO_MENU="VKWebAppAddToMenu",e.ADD_TO_HOME_SCREEN_INFO="VKWebAppAddToHomeScreenInfo",e.ALLOW_MESSAGES_FROM_GROUP="VKWebAppAllowMessagesFromGroup",e.ALLOW_MESSAGES_FROM_GROUP_PRELOAD="VKWebAppAllowMessagesFromGroupPreload",e.ALLOW_NOTIFICATIONS="VKWebAppAllowNotifications",e.ALLOW_NOTIFICATIONS_PRELOAD="VKWebAppAllowNotificationsPreload",e.COPY_TEXT="VKWebAppCopyText",e.CALL_API_METHOD="VKWebAppCallAPIMethod",e.CLOSE="VKWebAppClose",e.DENY_NOTIFICATIONS="VKWebAppDenyNotifications",e.FLASH_GET_INFO="VKWebAppFlashGetInfo",e.FLASH_SET_LEVEL="VKWebAppFlashSetLevel",e.GET_AUTH_TOKEN="VKWebAppGetAuthToken",e.GET_AUTH_TOKEN_PRELOAD="VKWebAppGetAuthTokenPreload",e.GET_CLIENT_VERSION="VKWebAppGetClientVersion",e.GET_COMMUNITY_AUTH_TOKEN="VKWebAppGetCommunityAuthToken",e.GET_COMMUNITY_TOKEN="VKWebAppGetCommunityToken",e.GET_COMMUNITY_AUTH_TOKEN_PRELOAD="VKWebAppGetCommunityAuthTokenPreload",e.GET_EMAIL_PRELOAD="VKWebAppGetEmailPreload",e.GET_EMAIL="VKWebAppGetEmail",e.GET_FRIENDS="VKWebAppGetFriends",e.GET_FLASH_INFO="VKWebAppGetFlashInfo",e.GET_GEODATA="VKWebAppGetGeodata",e.GET_PERSONAL_CARD="VKWebAppGetPersonalCard",e.GET_PHONE_NUMBER_PRELOAD="VKWebAppGetPhoneNumberPreload",e.GET_PHONE_NUMBER="VKWebAppGetPhoneNumber",e.GET_USER_INFO="VKWebAppGetUserInfo",e.INIT="VKWebAppInit",e.JOIN_GROUP="VKWebAppJoinGroup",e.JOIN_GROUP_PRELOAD="VKWebAppJoinGroupPreload",e.LEAVE_GROUP="VKWebAppLeaveGroup",e.LEAVE_GROUP_PRELOAD="VKWebAppLeaveGroupPreload",e.LOCATION_CHANGED="VKWebAppLocationChanged",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_CONTACTS="VKWebAppOpenContacts",e.OPEN_IN_NATIVE_APP="VKWebAppOpenInNativeApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.OPEN="VKWebAppOpenQR",e.REDIRECT="VKWebAppRedirect",e.RESIZE_WINDOW="VKWebAppResizeWindow",e.SCROLL="VKWebAppScroll",e.SEND_PAYLOAD="VKWebAppSendPayload",e.SEND_TO_CLIENT="VKWebAppSendToClient",e.SETTINGS="VKWebAppSettings",e.SET_LOCATION="VKWebAppSetLocation",e.SET_TITLE="VKWebAppSetTitle",e.SET_VIEW_SETTINGS="VKWebAppSetViewSettings",e.SHARE="VKWebAppShare",e.SHOW_NEW_POST_BOX="VKWebAppShowNewPostBox",e.SHOW_IMAGES="VKWebAppShowImages",e.SHOW_INVITE_BOX="VKWebAppShowInviteBox",e.SHOW_STORY_BOX="VKWebAppShowStoryBox",e.SHOW_LEADER_BOARD_BOX="VKWebAppShowLeaderBoardBox",e.SHOW_ORDER_BOX="VKWebAppShowOrderBox",e.SHOW_REQUEST_BOX="VKWebAppShowRequestBox",e.SHOW_WALL_POST_BOX="VKWebAppShowWallPostBox",e.TAPTIC_IMPACT_OCCURRED="VKWebAppTapticImpactOccurred",e.TAPTIC_NOTIFICATION_OCCURRED="VKWebAppTapticNotificationOccurred",e.TAPTIC_SELECTION_CHANGED="VKWebAppTapticSelectionChanged",e.UPDATE_CONFIG="VKWebAppUpdateConfig",e.VIEW_UPDATE_NAVIGATION_STATE="VKWebAppViewUpdateNavigationState",e.OPEN_ARTICLE_EDIT="VKWebAppOpenArticleEditor",e.OPEN_ARTICLE="VKWebAppOpenArticle"}(o||(o={}))},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",(function(){return s})),r.d(t,"combineReducers",(function(){return l})),r.d(t,"bindActionCreators",(function(){return d})),r.d(t,"applyMiddleware",(function(){return f})),r.d(t,"compose",(function(){return h})),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return i}));var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},i={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function a(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,l=t,p=[],d=p,u=!1;function _(){d===p&&(d=p.slice())}function h(){if(u)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return l}function f(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(u)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return _(),d.push(e),function(){if(t){if(u)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,_();var r=d.indexOf(e);d.splice(r,1)}}}function m(e){if(!a(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,l=c(l,e)}finally{u=!1}for(var t=p=d,r=0;r<t.length;r++){(0,t[r])()}return e}function g(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,m({type:i.REPLACE})}function b(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(h())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e}return m({type:i.INIT}),(o={dispatch:m,subscribe:f,getState:h,replaceReducer:g})[n.default]=b,o}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function l(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var a,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:i.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:i.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+i.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var n=!1,o={},i=0;i<s.length;i++){var l=s[i],p=r[l],d=e[l],u=p(d,t);if(void 0===u){var _=c(l,t);throw new Error(_)}o[l]=u,n=n||u!==d}return n?o:e}}function p(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var i=r[o],a=e[i];"function"==typeof a&&(n[i]=p(a,t))}return n}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){u(e,t,r[t])}))}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return _({},r,{dispatch:n=h.apply(void 0,i)(r.dispatch)})}}}},"F+Y4":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"detectUnityWebPlayer",(function(){return detectUnityWebPlayer}));var core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ioFf"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("rGqo"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("HEwt"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Oyvg"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("OG14"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("Btvt"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("FWc3"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("4+be"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("t7n3"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("Egk5"),_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("XzvV"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("gdug"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("7jxN"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("jE6c"),_shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("3f+a"),_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("lMzL"),_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("wZQE"),_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("WPHA"),_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("eiY0"),_web_apps_games_GamesFlashBanner__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("HDq7"),_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("4zn2"),_web_apps_promo_wheel_FortuneWheel__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("6tUA"),_web_apps_games_catalog_tooltip__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("nB7T"),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("kcIO"),_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("hPa7"),_web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("WRIt"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("lXE5"),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("btP0"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("aong");function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var ID_APP_CHECKBACK=6739175;window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":"");var AppsUtils={optionHiddenClass:"apps_hidden",optionLoadingClass:"loading",address:"apps",init:function init(obj,appTpl){if(extend(cur,{module:"apps",preventFastBack:!1,aTabs:ge("apps_top_tabs"),aSubTabs:geByClass1("_apps_top_subtabs"),aSearch:ge("s_search"),aSearchWrap:ge("apps_search"),aWrap:ge("apps_wrap"),aSummary:ge("apps_summary"),aSummaryCounter:ge("apps_summary_counter"),lShowMoreButton:ge("apps_list_show_more"),lPreload:ge("apps_list_preload"),lContent:ge("apps_list_content"),fWrap:ge("apps_feed_wrap"),fShowMoreButton:ge("apps_feed_show_more"),rNotCounter:ge("apps_recent_notifications_counter"),rNotWrap:ge("apps_notifications_wrap"),rNotNoContent:ge("apps_recent_notifications_no_content"),rNotBlackList:ge("apps_recent_notifications_black_list"),rNotShowMoreButton:ge("apps_recent_notifications_show_more"),rAppsWrap:ge("apps_recent_apps_wrap"),rAppsShowMoreButton:ge("apps_recent_more"),rAppsNoContent:ge("apps_recent_apps_no_content"),catalogSearchShown:+!document.querySelector("#apps_search.SearchToggle__hide"),onSilentLoad:{},apps:{},deletedApps:{},appTpl:appTpl||function(){return""}}),extend(cur,obj),cur.defaultCount=cur.shownApps,"notifications"===nav.objLoc.act&&(delete nav.objLoc.act,nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc)),this.setHistoryBackRules(),this.searchLoadFromAddressBar(),cur.aSearch&&(_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.startEvents(cur.aSearch)),setTimeout(function(){this.scrollCheckBinded=this.scrollCheck.bind(this),this.sliderInit(),this.notificationsInit(),cur.scrollToHeader&&(setTimeout(this.scrollToHeader.bind(this),100),delete cur.scrollToHeader),cur.scrollToTop&&(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(),delete cur.scrollToTop),this.startEvents(),cur.destroy.push(function(e){setTimeout((function(){var t;e.feedScrollbar&&cur.fScrollbar!==e.feedScrollbar&&(t=!1,globalHistory.forEach((function(r){r.cur!==e&&r.cur.feedScrollbar===e.feedScrollbar&&(t=!0)})),t||e.feedScrollbar.destroy()),e.rNotScrollbar&&cur.rNotScrollbar!==e.rNotScrollbar&&(t=!1,globalHistory.forEach((function(r){r.cur!==e&&r.cur.rNotScrollbar===e.rNotScrollbar&&(t=!0)})),t||e.rNotScrollbar.destroy())}),0),cur.featuredSlider&&(cur.featuredSlider.destroy(),cur.featuredSlider=null)}.pbind(cur)),cur.destroy.push(this.stopEvents.bind(this)),cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.scrollResize(cur.aSearch)}.bind(this),0),cur.silent_mode){if(cur.silent=!0,cur.preload&&(cur.leavePreloadedHeader||delete cur.preload.header,cur.leavePreloadedBefore||delete cur.preload.before),!cur.isGamesCatalogRedesign){var query={act:"load_apps_silent",gid:cur.gid,oid:cur.oid,header:cur.leavePreloadedHeader?0:1,before:cur.leavePreloadedBefore?0:1,section:cur.section,preload:1,preloaded:[]},prop=null;for(prop in cur.preload=cur.preload||{},cur.preload)cur.preload.hasOwnProperty(prop)&&query.preloaded.push(prop);ajax.post(this.address,query,{cache:1,local:1,onDone:this.withFastBackCheck((json,preload,preloadBefore,preloadHeader)=>{cur.preload=extend(cur.preload||{},preload),cur.preload.before=preloadBefore,cur.preload.header=preloadHeader,json=eval("("+json+")"),cur.curList="all",cur.appsList=json&&json[cur.curList]?json:{all:[]},cur.sectionCount=cur.appsList[cur.curList].length,void 0===cur.searchOffset&&(cur.searchOffset=0),json?this.indexAll(()=>this.onSilentLoad()):this.onSilentLoad()})})}_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_25__.default.defineGamesGifts(),_web_apps_promo_wheel_FortuneWheel__WEBPACK_IMPORTED_MODULE_29__.default.defineFortuneWheel(),obj.has_notify&&this.notifyAction(),cur.isGamesCatalogRedesign&&"list"===obj.section&&window.GamesCatalog._initNav("list")}},notifyAction:()=>{var e=document.querySelector("#l_ap");e&&e.classList.remove("AppLeftMenuWithNotify"),showWiki({w:"play_safe_at_home",ref:"challenge_landing_banner"})},onSilentLoad:function(){if(cur.silent=!1,cur.onSilentLoad)for(var e in cur.onSilentLoad)cur.onSilentLoad.hasOwnProperty(e)&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_21__.isFunction)(cur.onSilentLoad[e])&&cur.onSilentLoad[e]()},withFastBackCheck:function(e){cur.preventFastBack=!0;var t=cur;return function(){cur===t&&(cur.preventFastBack=!1,e.apply(null,Array.prototype.slice.call(arguments)))}},startEvents:function(){addEvent(window,"scroll",this.scrollCheckBinded),addEvent(window,"resize",this.scrollCheckBinded),this.scrollCheck(),this.sliderStart()},stopEvents:function(){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(window,"scroll",this.scrollCheckBinded),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(window,"resize",this.scrollCheckBinded),this.sliderStop()},isSection:function(){for(var e=arguments.length;e--;)if(arguments[e]===cur.section)return!0;return!1},isDelayedOnSilentLoad:function e(t,r){if(cur.silent)return e.count=e.count||0,e.count++,cur.onSilentLoad[t||"key_"+e.count]=r,!0},handlePageCount:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return handlePageCount("ap",e)})),incomingCall:function(e){stManager.add(["notifier.js","notifier.css","apps.css","call.css"],()=>{var t=se('<div><div class="call_apps_wrap clear_fix">'+e+"</div></div>"),r={movable:geByClass1("call_invitation_wrap",t,"div"),startLeft:parseInt((window.innerWidth-224)/2)+"px",startTop:parseInt((window.innerHeight-404)/2)+"px",startWidth:224,startHeight:404,resize:!1,onBeforeHide:function(){},onDragEnd:function(e,t){},onResize:function(e,t){}};this.appCall&&this.appCall.close(),this.appCall=new RBox(t,r)}),window.Notifier&&Notifier.setRecvClbk("apps_call_hide",()=>{this.appCall&&(this.appCall.close(),this.appCall=!1)})},callApprove:function(e){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.appCall&&(this.appCall.close(),this.appCall=!1),nav.go(e)},callReject:function(){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.callOnReject()},callOnReject:function(){this.appCall&&(this.appCall.close(),this.appCall=!1),ajax.post("/al_apps.php",{act:"do_call_reject"},{onDone:function(){}})},editBlacklist:function(){return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"blacklist_box",height:lastWindowHeight},{stat:["privacy.css",jsc("web/indexer.js")]}),!1},blacklistInit:function(e,t,r){r=r||{};var n=geByClass1("apps_blacklist_wrap",e.bodyNode),o=geByClass1("apps_blacklist",e.bodyNode),i=geByClass1("olist_more",e.bodyNode,"a"),a={},s=new vkIndexer(t,(function(e){return e[1]}));e.setOptions({width:560,bodyStyle:"padding: 0px"}),e.removeButtons().addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_close"),(function(){e.hide(200)}),"yes"),o.parentNode.style.height=r.boxHeight+"px";var c=ge("apps_blacklist_filter");r.nofocus||setTimeout(elfocus.pbind(c),100);var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.data)(c,"opts");function p(){if(n.scrollTop>0?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e.bodyNode.parentNode,"olist_topsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e.bodyNode.parentNode,"olist_topsh"),n.scrollTop+(n.offsetHeight||n.clientHeight)<o.scrollHeight?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e.bodyNode.parentNode,"olist_botsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e.bodyNode.parentNode,"olist_botsh"),i&&i.offsetTop&&i.onclick){var t=i.offsetTop;o.scrollTop+(o.offsetHeight||o.clientHeight)+100>=t&&i.onclick()}}function d(n,c){var l,p,u=(c=~~c||0)?60:120;n&&(n=clean(n).replace(/\u2013|\u2014/g,"-")),l=n?s.search(n):t,p=r.tpl;var _=l.length;l=l.slice(c,c+u);var h,f=[];if(n){var m=escapeRE(n),g=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.parseLatin)(n);null!=g&&(m=m+"|"+escapeRE(g)),h=new RegExp("(?![^&;]+;)(?!<[^<>]*)((\\(*)("+m+"))(?![^<>]*>)(?![^&;]+;)","gi")}each(l,(function(){f.push(rs(p,function(e,t,r,n){var o=e[1];if(t){o=-1==t.indexOf(" ")?o.split(" "):[o];var i="";for(var a in o)o.hasOwnProperty(a)&&(i+=(a>0?" ":"")+o[a].replace(n,"$2<em>$3</em>"));o=i}return{id:e[0],name:o,photo:e[2],wrap_class:e[0]&&r[e[0]]?" olist_item_wrap_on":"",link:e[3]||(e[0]>0?"id"+e[0]:"app"+(1e9-e[0]))}}(this,n,a,h)))})),c||f.length||f.push('<div class="no_rows">'+(n?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_search_not_found").replace("{search}",clean(n)):r.lang.apps_blacklist_empty)+"</div>"),re(i),f=f.join(" "),c?o.appendChild(cf(f)):val(o,f),_>c+u&&(o.appendChild(i),i.onclick=function(e){return d(n,c+u),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(e)}),e&&e.scroll&&e.scroll.update(!1,!0)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.data)(c,"opts",extend(l,{onChange:function(e){d(e,0)}})),i&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.isVisible)(i)?i.onclick=function(e){return d("",60),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(e)}:(re(i),show(i))),addEvent(o,"click",(function(r){var n=r.originalTarget||r.target;hasClass(n,"olist_item_wrap")||(n=gpeByClass("olist_item_wrap",n));if(!n||n==bodyNode)return;if(hasClass(n,"olist_item_loading"))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(r);if(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(r))return!0;e.changed=!0;var i=n.id.match(/-?\d+/)[0],s=a[i],l=!1;each(t,(function(){if(this[0]==i)return l=this[4],!1})),ajax.post("/al_apps.php",{act:"a_blacklist_delete",cancel:s?1:0,owner_id:i,hash:l},{onDone:function(){toggleClass(n,"olist_item_wrap_on",!s),a[i]=!s},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(n,"olist_item_loading")},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(n,"olist_item_loading")}}),o.scrollTop<50&&setTimeout((function(){elfocus(c),val(c).length&&c.select()}),100);return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(r)})),addEvent(n,"scroll",p),setTimeout(p,10)},initDescription:function(e){if(!document.querySelector(".DownloadedGamePage")){var t=geByClass1("apps_i_description_content");val(t,e);var r=parseInt(getStyle(t,"line-height"));Math.ceil(getSize(t)[1]/r)>7&&(setStyle(t,"height",5*r),val(t,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass))}},showFullDescription:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass),setStyle(geByClass1("apps_i_description_content"),"height","")},appSsSliderNext:function(e){e?cur.appSsSlider&&cur.appSsSlider.next():cur.wkviewAppsSlider&&cur.wkviewAppsSlider.next()},initAppSsSlider:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||"";var n,o=ge("apps_i_slider_next"+t),i=ge("apps_i_slider_prev"+t),a=ge("apps_i_slider_outer"+t),s=ge("apps_i_slider_thumbs"+t),c=s?domPN(s):null,l=s?s.children:[],p=null,d=null;function u(){if(s){var e=c.offsetWidth,t=s.scrollWidth;if(t<=e||!t||!e)return;null===p&&(p=0);var r=l[p],o=r.offsetLeft,i=(e-r.offsetWidth)/2-o;i=Math.max(-t+e,Math.min(0,i)),d&&d.stop(),d=animate(s,{left:i},{duration:n.options.animationDuration,transition:Fx.Transitions.easeOutCubic})}}function _(e){return e>=n.slides.length-2}function h(){Array.from(l).forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e,"in-view")})}function f(e){if(h(),0===e)for(var t=e;t<=2;t++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(l[t],"in-view");else if(_(e))for(var r=n.slides.length-4,o=n.slides.length-1;o>r;)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(l[o],"in-view"),o--;else for(var i=e-1;i<=e+1;i++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(l[i],"in-view")}function m(t){s&&t!==p&&(null!==p&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(l[p],"selected"),p=t,e&&f(p),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(l[p],"selected"),u())}function g(){m(null!==n.required?n.required:n.current)}function b(){n.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(o,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(o,"apps_i_slider_available"),n.slidePrev?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(i,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(i,"apps_i_slider_available"),hasClass(n.slideCurrent,"apps_promo_video_slide")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(a,"apps_i_slider_video"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(a,"apps_i_slider_video"),n.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(a,"apps_i_slider_run"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(a,"apps_i_slider_run"),hasClass(n.slidePrev,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.pause(),hasClass(n.slideCurrent,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.play()}if(n=new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default({inner:ge("apps_i_slider_inner"+t),outer:a,next:o,prev:i,onChange:b,onRequired:g,infinite:!1,isVkApp:e}),r?cur.appSsSlider=n:cur.wkviewAppsSlider=n,b(),g(),each(l,(function(e,t){var r=new Image;r.onload=u,r.src=geByTag1("img",t).src,addEvent(t,"click",(function(){n&&n.requireIndex(e)}))})),cur.promoVideo){var v=ge("apps_promo_video_thumb"+t);v&&showInlineVideo(cur.promoVideo,"",{autoplay:1,module:"app_promo",addParams:{from_autoplay:1}},null,v)}},initSimilarAppsSlider:function(){var e=document.querySelector(".apps_similarApps");if(e){var t=e.querySelector(".apps_similarApps__listContent");t&&stManager.add(["ui_common.js"],()=>{var e=e=>{window.tooltips&&tooltips.hideAll();var r=Math.abs(e.deltaX||e.wheelDeltaX||0);Math.abs(e.deltaY||e.wheelDeltaY||0)>r&&(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(e),t.scrollLeft+=uiScroll.scrollEventDelta(e))};addEvent(t,browserFeatures.wheelEvent,e),cur.destroy.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(t,browserFeatures.wheelEvent,e)})})}},showWinInstructions:function(e,t,r){setTimeout((function(){new MessageBox({width:800,title:cur.winInstrTitle,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(rs(trim(cur.winInstrTpl),{download_link:t,help_link:r})).show()}),500)},sendInstallRequest:function(e,t,r,n,o,i,a){var s=!!geByClass1("apps_install_header");if(e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.isButtonLocked)(e)&&!hasClass(e,"button_disabled")){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(e);var c=getSize(e),l=window.isAppLanding?"apps":this.address;if(t){var p={act:"send_install_request",aid:r,ref:n,cid:o,hash:i},d=/^\/app(\d+)_?(-\d+)?(#(.*))?$/.exec(location.pathname);d&&d.length>2&&parseInt(d[2],10)<0&&(p.group_id=Math.abs(parseInt(d[2]))),ajax.post(l,p,{onDone:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger").checked=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"button__disabled"))},onFail:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger-fail").checked=!0)},hideProgress:function(){var t=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"button_disabled"),a||setStyle(e,"width",c[0]),!window.isAppLanding&&val(e,t);var r=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(r,"sent"),val(r,t)}})}else cur.ref=n,ajax.post(this.address,{act:"send_install_request_box",aid:r},{onDone:function(t,o,i){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(e),o){cur.lang||(cur.lang={}),extend(cur.lang,t);var a=new MessageBox({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_get_push_w_install_link")});a.removeButtons(),a.content(o),a.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_install_sms_send"),function(t){if(e=ge("apps_i_request_btn")||e,t&&e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.isButtonLocked)(t)){var o=getSize(e);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(t),ajax.post(this.address,{act:"send_install_request",ref:n,aid:r,cid:-3,hash:i},{onFail:function(e){if(e){var r=ge("app_sms_tt_error");val(r,e),show(r),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(t)}},onDone:function(){this.ttDestroyAll(),a.hide();var r=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"button_disabled"),s||setStyle(e,"width",o[0]),val(e,r);var n=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(n,"sent"),val(n,r)}.bind(this)})}}.bind(this),"yes"),a.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_cancel"),a.hide,"no"),a.show()}else Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)("activation.php",{act:"change_phone_box",hash:i})}.bind(this)})}},deletingApp:!1,showInviteBox:function(e,t,r,n){e||(e=cur.app.options.aid,t=cur.app.options.hash),showTabbedBox("al_friends.php",{act:"select_friends_box",checked:"",invite:1,aid:e,from:"apps"},{stat:[jsc("web/privacy.js"),"ui_controls.js","ui_controls.css"],cache:1,params:{dark:1,onFail:()=>{n&&n()},onHideAttempt:e=>(!e&&n&&n({reason:"User denied",code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_28__.ERROR_CODES.USER_DENIED}),!0)}}),cur.onFlistSave=function(o){ajax.post("apps",{act:"invite_friends",aid:e,friends:o.join(","),hash:t},{onDone:function(e,t,n,o){setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:e},t).hide,2e3),r&&r({success:!0,notSentIds:o})},onFail:function(e){return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_error")},e).hide,2e3),n&&n(),!0}})}},showAppFriends:function(e,t,r){var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"show_app_friends_box",aid:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px"},onDone:function(){new uiScroll("apps_friendslist")}},t);return n.setControlsText('<a href="" onclick="Apps.showInviteBox('+e+", '"+r+"'); return false;\">"+Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_invite_friends")+"</a>"),n},showMiniAppFriends:function(e,t,r){var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"show_mini_app_friends_box",app_id:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px",containerClass:"apps_catalog_popup_box_container"},onDone:function(){new uiScroll("apps_friendslist")}},t);return n.setControlsText(`<button class="flat_button secondary button_light" onclick="Apps.showInviteBox(${e}, '${r}'); return false;">${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_invite_friends")}</button>`),n},recountAddVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("add_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("votes_flex",t)),t>0&&ge("app_pay_withdraw")&&(ge("app_pay_withdraw").value=0,this.recountWithdrawVotes(ge("app_pay_withdraw")))},recountWithdrawVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("withdraw_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("votes_flex",t)),t>0&&(ge("app_pay_add").value=0,this.recountAddVotes(ge("app_pay_add")))},initAppView:function(e,t){var r,n;t.layer||cur.nav.push((function(e,r,n,o){if(void 0===e[0]&&!e.join&&!o.pass){if(e["#"])return cur.app.onLocChanged(e["#"]),o.back?3!=vk.al&&nav.setLoc(n):nav.setLoc(n),!1;if(!t.not_block_nav)return nav.setLoc(n),!1}})),cur.app.params.is_vkpay_service&&(r=()=>{t.layer||cur.app.runCallback("onWindowBlur")},n=()=>{var e=window.innerWidth||document.documentElement.clientWidth||bodyNode.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.app.runCallback("onTopWindowResized",e,t),cur.app.setVkPayMobileHeight()},cur.app.setVkPayMobileHeight());var o=function(e){cur.app._lastFocusState!==e.type&&("block"==e.type?cur.app.runCallback("onWindowBlur"):cur.app.runCallback("onWindowFocus")),cur.app._lastFocusState=e.type};cur.app.onReady.push((function(){cur.app&&(cur.app.onLocChanged(e.hash),addEvent(document,"block unblock",o,!0),r&&addEvent(window,"mousedown",r),n&&addEvent(window,"resize",n),cur.destroy.push((function(){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(document,"block unblock",o),r&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(window,"mousedown",r),n&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.removeEvent)(window,"resize",n)})))})),t.icon&&(setFavIcon(t.icon),cur.destroy.push((function(){setFavIcon("/images/favicon"+(vk.intnat?"_vk":"new")+window._iconAdd+".ico")}))),t.is_widescreen_mode&&("loading"===document.readyState?_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_26__.default.deferredInit():_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_26__.default.init()),t.show_flash_banner&&_web_apps_games_GamesFlashBanner__WEBPACK_IMPORTED_MODULE_27__.default.init(cur.app.cont,document.getElementById("apps")),this.initSimilarAppsSlider(),this.changeCheckBackUrl(),window.GamesCatalog&&window.GamesCatalog.initOnNavToCatalog()},initVkConnect:function(e,t,r,n,o){Object(_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_23__.default)(e,t,r,n,o),window.hasOwnProperty("wkcur")&&wkcur._hide.push(cur.clearVKMiniAppsLayerPopups)},loadSettings:function(e){ajax.post(this.address,{act:"show_settings",aid:cur.aid},extend({cache:1},e))},showSettings:function(){this.ttHideAll(),cur.settShown?(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(200),cur.settShown=!1,delete ajaxCache["/apps#act=show_settings&aid="+cur.aid]):Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"show_settings",aid:cur.aid},{params:{dark:1}})},saveSettings:function(e,t,r,n){if(!cur.savingSettings){r||(n&&n.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(n.btn),show("apps_settings_progress"));var o=curBox(),i=ge("app_pay_add"),a=ge("app_pay_withdraw"),s={act:"save_settings",aid:e,hash:t,from:"appview",app_settings_1:isChecked("app_settings_1"),app_settings_256:isChecked("app_settings_256"),add:i?i.value:0,withdraw:a?a.value:0,only_checkboxes:r?1:0,cur_aid:cur.aid};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.isVisible)("app_settings_2097152")&&(s.app_settings_2097152=isChecked("app_settings_2097152")),ajax.post("apps",s,extend({onDone:e=>{n&&n.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(n.btn),e.left_nav&&this.updateLeftNav(e.left_nav),!r&&cur.app&&cur.app.runCallback("onSettingsChanged",e.settings),cur.settingsOnLoad=!1,void 0!==e.coins&&cur.app&&cur.app.balanceUpdated(e.coins),void 0!==e.balance&&Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__.updateMoney)(e.balance),o&&!r&&o.hide(),this.addToMenuErrorResolve(e,(function(e){r&&checkbox("app_settings_256",256&e.settings)})),this.updateAddToMenuAction()},onFail:function(e){e&&val("apps_settings_error",e),show("apps_settings_error"),hide("apps_settings_progress"),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(200)},showProgress:function(){cur.savingSettings=!0,o&&o.showProgress()},hideProgress:function(){cur.savingSettings=!1,o&&o.hideProgress()}},n||{}))}},updateAddToMenuAction:function(){var e=ge("app_add_to_menu_action");if(e&&cur.aid&&cur.app&&cur.app.options){var t={add:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_vk_app_add_to_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_add_to_left_menu"),remove:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_vk_app_remove_from_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_remove_from_left_menu")};this.isAppInLeftMenu(r=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.actionsMenuItemLocked)(e)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockActionsMenuItem)(e),e.setAttribute("onclick","return Apps.addToMenu("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!r)+", this);"),val(e,r?t.remove:t.add)})}},isAppInLeftMenu(e,t){ajax.post("al_apps.php",{act:"is_in_left_menu",aid:cur.aid,hash:cur.app.options.hash},{onDone:t=>{var r=t.result;e&&e(r)},onFail:t})},addToMenu:function(e,t,r,n){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.actionsMenuItemLocked)(n)||this.addToMenuApi(e,t,r,n)},addToMenuApi:function(e,t,r,n,o,i){ajax.post("al_apps.php",{act:"a_left_menu",aid:e,hash:t,show:r},{onDone:e=>{this.updateLeftNav(e.left_nav),this.updateAddToMenuAction(),this.addToMenuErrorResolve(e),o&&o(e)},onFail:i,showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockActionsMenuItem.pbind(n),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockActionsMenuItem.pbind(n)})},vkAppNotifications:function(e,t,r,n){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.actionsMenuItemLocked)(n)||ajax.post("al_apps.php",{act:"vk_app_notifications",aid:e,hash:t,allow:r},{onDone:e=>{this.updateNotificationsAction(e)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockActionsMenuItem.pbind(n),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockActionsMenuItem.pbind(n)})},updateNotificationsAction:function(e){var t=ge("app_notifications_action");if(t&&cur.aid&&cur.app&&cur.app.options){var r=e,n={add:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_vk_app_notifications_action_enable"),remove:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_vk_app_notifications_action_disable")};Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.actionsMenuItemLocked)(t)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockActionsMenuItem)(t),t.setAttribute("onclick","return Apps.vkAppNotifications("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!r)+", this);"),val(t,r?n.remove:n.add)}},addToMenuErrorResolve:function(e,t){e.left_nav_error?window.menuSettings&&cur.app?(cur.settingsBoxSetLeftMenuAppCallback=function(r){delete cur.settingsBoxSetLeftMenuAppCallback,!r||256&e.settings||(e.settings+=256),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_21__.isFunction)(t)&&t(e)},showTabbedBox("al_settings.php",{act:"menu_box",type:2,aid:cur.aid})):(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_error")},e.left_nav_error),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_21__.isFunction)(t)&&t(e)):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_21__.isFunction)(t)&&t(e)},showAppSettings:function(e,t){this.ttHideAll(),t?Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"settings_box_info",aid:e},{params:{dark:1}}):Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)(this.address,{act:"settings_box",aid:e,mask:0,main:1},{params:{dark:1}})},updateOnline:function(){ajax.post(this.address,{act:"update_online",aid:cur.aid,hash:cur.app.options.hash},{ads:1})},updateOffline:function(e){ajax.post(this.address,{act:"update_offline",aid:(e||cur).aid,hash:(e||cur).app.options.hash})},deleteApp:function(e,t,r,n){if(!this.deletingApp){this.deletingApp=!0;var o=cur.app.options.vkApp,i=o?"/services":"/apps?act=popular";cur.app&&cur.app.options&&o&&this.deleteVkApp();var a=function(r,n,o,i){ajax.post(this.address,{act:"quit",id:e,hash:t||cur.app.options.hash,from:"app"},{onDone:this.withFastBackCheck(function(e){this.deletingApp=!1,window.appsListChanged=!0,this.notificationsSetCounters(e.count_all),e.left_nav&&this.updateLeftNav(e.left_nav),cur._back=!1,r.apply(null,[].slice.call(arguments))}.bind(this)),onFail:this.withFastBackCheck(function(){this.deletingApp=!1,n.apply(null,[].slice.call(arguments))}.bind(this)),showProgress:o,hideProgress:i})}.bind(this);switch(n){case"appactions":a((function(){nav.go(i,!1)}),(function(e){e&&Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_error")},e),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockActionsMenuItem)(r)}),_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockActionsMenuItem.pbind(r));break;default:var s=curBox();a((function(){nav.go(i,!1)}),(function(e){if(e){var t=ge("apps_settings_error");val(t,e),show(t),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)()}s&&s.hideProgress()}),(function(){s&&s.showProgress()}))}}},reportApp:function(e,t){Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)("al_reports.php",{act:"report_app_box",app_id:e},{params:{dark:1},stat:["ui_controls.js","ui_controls.css"]})},cancelInstall:function(){nav.go("/apps",!1)},deleteVkApp:function(){var e=cur.app.options.aid,t=cur.app.options.layer&&ge(`app_${e}_container_layer`)?`app_${e}_container_layer`:`app_${e}_container`;cur.vkAppQueue[t]&&cur.vkAppQueue[t].destroyView(),delete cur.vkAppQueue[t]},approveInstall:function(e,t,r){r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.actionsMenuItemLocked)(r)||(r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockActionsMenuItem)(r),window.appsListChanged=1,cur.app&&cur.app.options&&cur.app.options.vkApp&&this.deleteVkApp(),nav.go(extend(nav.objLoc,{join:1,hash:e,sett:t,notify:isChecked("apps_notifications_checkbox")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.isVisible)("apps_notifications_checkbox")?1:void 0}),!1,{pass:!0}))},installApp:function(e,t,r){ajax.post(this.address,{act:"do_install",aid:e,hash:t},{onDone:e=>{e==cur&&(this.onAppAdded(),r&&r())}})},onAppAdded:function(){window.appsListChanged=!0,cur.preload&&delete cur.preload.before,cur.app&&(cur.app.runCallback("onApplicationAdded"),cur.appUser=!0,hide("apps_install_btn"),show("apps_show_settings"))},rateOver:function(e){var t=!!geByClass1("apps_install_header"),r=!!geByClass1("WideScreenAppPage"),n=!0,o=!1;cur.rated||hasClass(e,"not_installed")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"over");var i="",a=[],s=0,c=[cur.installPage?-70:-66,0,-36],l="left",p=15,d=0,u=cur.appUser?cur.userRate?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_you_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_you_not_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_rating_title"),_=rs(cur.rateStatsLabelTpl,{label:u});for(var h in cur.rateStats=cur.rateStats||{},cur.rateStats)cur.rateStats.hasOwnProperty(h)&&(s+=intval(cur.rateStats[h]));val("app_rate_label",u);for(var f=1;f<=5;f++){i+='<span class="app_rate stats fl_r"></span>';var m=intval(cur.rateStats[f]),g=s?intval(100*m/s):0,b=langNumeric(m,"%s",!0),v=cur.userRate!=10*f&&cur.userRate?"":"my";a.push(rs(cur.rateStatsRowTpl,{id:"apps_rate_row"+f,stars:i,count:b,percent:g,classname:v}));var E=ge("apps_rate_row"+f);E&&(setStyle(geByClass1("app_rate_bg",E),{width:g+"%"}),val(geByClass1("app_rate_percent",E),g+"%"),val(geByClass1("app_rate_cnt",E),b),geByClass1("app_rate_stars",E).className="app_rate_stars fl_l "+v)}_+=a.reverse().join(""),t&&(l="top",c=[210,0,10],p=0,d=15),r&&(l="top",c=[3,10,100],p=0,d=15,n=!1,o=!0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__.showTooltip)(e,{text:_,slideX:p,slide:d,className:"app_rate_tt",shift:c,appendEl:window.bodyNode,forcetodown:n,forcetoup:o,dir:l,hasover:1})},rateOut:function(e){this.showRate(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e,"over")},rateApp:function(e){if(cur.rated)return!1;var t=ge("apps_ratings");cur.appRate=cur.userRate=e,this.rateOut(t),cur.rated=!0,ajax.post("/al_apps.php",{act:"rate_app",aid:cur.aid,rate:e,hash:cur.rate_hash},{onDone:e=>{cur.rateStats=e,this.rateOver(t)}})},showRate:function(e){if(cur.rated)return!1;var t=intval(cur.appRate||0),r=geByClass("app_rate",ge("apps_ratings")),n=Math.floor((t+2)/10),o=Math.floor((t+2)/5)-n;for(var i in r)if(r.hasOwnProperty(i)){var a="app_rate fl_l "+(i<n?"full":i<o?"half":"empty");r[i].className=a}if(e){var s=Math.floor(e/10);for(var c in r)if(r.hasOwnProperty(c)){if(c>=s)break;r[c].className+=" over"}}},recentTabsUpdate:function recentTabsUpdate(needApps,needNotifications){if(cur.rAppsWrap&&cur.rNotWrap){if(needApps=window.appsListChanged||needApps,needNotifications=window.notificationsListChanged||needNotifications,delete window.appsListChanged,delete window.notificationsListChanged,!needApps&&!needNotifications)return;ajax.post(this.address,{act:"update_recent",notifications:needNotifications,apps:needApps,hash:cur.recentUpdateHash},{onDone:this.withFastBackCheck(function(apps,notifications){if(apps&&(each(geByClass("apps_recent_row",cur.rAppsWrap),(function(e,t){re(t)})),apps[0]?(show(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.rAppsNoContent,"hidden_no_content"),domInsertBefore(cf(apps[0]),cur.rAppsShowMoreButton)):(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rAppsNoContent,"hidden_no_content")),cur.recentOffset=apps[1],apps[2]))for(var i in apps[2]=eval("("+apps[2]+")"),apps[2])apps[2].hasOwnProperty(i)&&(cur.apps[apps[2][i][0]]=apps[2][i]);if(notifications){each(geByClass("apps_notification_row",cur.rNotWrap),(function(e,t){re(t)}));var tab=ge("apps-recent-notifications-tab");notifications[0]?((notifications[2]?hide:show)(cur.rNotShowMoreButton),show(tab),hide(cur.rNotNoContent),domInsertBefore(cf(notifications[0]),cur.rNotShowMoreButton)):(hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),"notifications"!=nav.objLoc.tab&&hide(tab)),cur.notificationsOffset=notifications[1],cur.notificationsNewest=notifications[4],this.notificationsSetCounters(notifications[3]),this.notificationsInit()}this.ttDestroyAll()}.bind(this)),showProgress:()=>{needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(domPN(cur.rNotWrap),this.optionLoadingClass)},hideProgress:this.withFastBackCheck(function(){needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(domPN(cur.rNotWrap),this.optionLoadingClass)}.bind(this))})}},optionNotificationsReadTimeout:1e3,notificationsReadTimeout:null,notificationsRemovedCount:0,notificationTabSelect:function(){nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rNotBlackList,this.optionHiddenClass),cur.rNotScrollbar&&cur.rNotScrollbar.update(),this.notificationsReadContent()},notificationsInit:function(){cur.rNotWrap&&cur.notificationsOffset&&!cur.rNotScrollbar?(this.notificationsRemovedCount=0,cur.rNotScrollbar=new uiScroll(cur.rNotWrap,{autoresize:!1,global:!0,onmore:this.notificationsLoadContent.bind(this),onscroll:this.notificationsReadContent.bind(this)}),this.notificationsReadContent()):cur.rNotWrap&&cur.rNotScrollbar&&(cur.rNotScrollbar.update(),this.notificationsReadContent())},notificationsMarkReaded:function(e){e.removeAttribute("data-read"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e,"apps_notification_row_new")},notificationsReadContent:function(){"notifications"===nav.objLoc.tab&&(this.notificationsReadTimeout&&clearTimeout(this.notificationsReadTimeout),this.notificationsReadTimeout=setTimeout(function(){var e=[],t=[];each(cur.rNotWrap.querySelectorAll('div[data-read="1"]'),(function(r,n){n.offsetTop+n.offsetHeight/2<=cur.rNotScrollbar.data.scrollTop+cur.rNotScrollbar.data.viewportHeight&&(e.push(n.getAttribute("data-id")),t.push(n))})),e.length&&ajax.post(this.address,{act:"a_mark",newest:cur.notificationsNewest,notif_ids:e.join(","),hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e){this.notificationsSetCounters(e),each(t,function(e,t){this.notificationsMarkReaded(t)}.bind(this))}.bind(this))})}.bind(this),this.optionNotificationsReadTimeout))},notificationsLoadContent:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.isVisible)(cur.rNotShowMoreButton)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.isButtonLocked)(cur.rNotShowMoreButton)&&(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(cur.rNotShowMoreButton),ajax.post(this.address,{act:"more_notifications",offset:cur.notificationsOffset,hash:cur.notificationsHash},{onDone:this.withFastBackCheck((function(e,t,r){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(cur.rNotShowMoreButton),cur.notificationsOffset=t,e&&cur.rNotShowMoreButton&&cur.rNotShowMoreButton.parentNode.insertBefore(cf(e),cur.rNotShowMoreButton),r&&hide(cur.rNotShowMoreButton),cur.rNotScrollbar&&cur.rNotScrollbar.update()})),onFail:this.withFastBackCheck((function(){hide(cur.rNotShowMoreButton)}))}))},notificationsRemoveAll:function(e,t,r,n,o){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.linkLocked)(e)&&!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(o)){var i=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:t},r,Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_delete"),function(t){ajax.post(this.address,{act:"remove_all_notifications_and_requests",newest:cur.notificationsNewest,hash:n},{onDone:this.withFastBackCheck(function(){each(geByClass("apps_notification_row",cur.rNotWrap),(function(e,t){re(t)})),hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),this.notificationsSetCounters(0),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this)),showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockLink)(e)},hideProgress:this.withFastBackCheck((function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockLink)(e),i.hide()}))})}.bind(this),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_cancel"));return!1}},notificationsSetCounters:function(e){if(void 0!==e&&(cur.notificationsNew=e,this.handlePageCount(e),cur.rNotCounter)){var t=e<1e3?e+"":".."+(e+"").substr(-3);e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rNotCounter,this.optionHiddenClass),e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rNotCounter,"ui_tab_count_hidden"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.rNotCounter,"ui_tab_count_hidden"),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__.animateCount)(cur.rNotCounter,t,{str:t,onDone:e?void 0:_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass.pbind(cur.rNotCounter,this.optionHiddenClass)})}},rejectRequest:function(e,t,r,n){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.isButtonLocked)(e)){var o=ge("apps_notification_"+t);this.notificationsMarkReaded(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.data)(o,"html",o.innerHTML),setStyle(o,{minHeight:getSize(o)[1]}),ajax.post(this.address,{act:"reject_"+n,newest:cur.notificationsNewest,rid:t,hash:r},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this,o)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton.pbind(e))}),cur.rNotScrollbar&&cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},requestsRestore:function(e,t,r){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.linkLocked)(e)){var n=ge("apps_notification_"+t);ajax.post(this.address,{act:"request_restore",newest:cur.notificationsNewest,rid:t,hash:r},{onDone:this.withFastBackCheck(function(e,t){this.notificationsRemovedCount--,val(e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.data)(e,"html")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(e,"apps_notification_service"),setStyle(e,{minHeight:""}),this.notificationsSetCounters(t),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this,n)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockLink.pbind(e))}),cur.rNotScrollbar&&cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},deleteNotification:function(e,t,r,n){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.isButtonLocked)(e)){var o=ge("apps_notification_"+t);setStyle(o,{minHeight:getSize(o)[1]}),ajax.post(this.address,{act:"delete_notification",newest:cur.notificationsNewest,nid:t,aid:r,hash:n},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r)}.bind(this,o)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton.pbind(e))})}},denyNotifications:function(e,t,r,n){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.linkLocked)(e)){var o=ge("apps_notification_"+t);setStyle(o,{minHeight:getSize(o)[1]}),ajax.post(this.address,{act:"deny_notifications",aid:r,hash:n},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(o)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockLink.pbind(e))})}},requestsBanUser:function(e,t,r,n){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.linkLocked)(e)){var o=ge("apps_notification_"+t);setStyle(o,{minHeight:getSize(o)[1]}),ajax.post(this.address,{act:"request_ban_user",mid:r,hash:n},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(o)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockLink.pbind(e))})}},removingApp:!1,restoringApp:!1,feedTabSelect:function(){delete nav.objLoc.tab,nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.rNotBlackList,this.optionHiddenClass),cur.fScrollbar&&cur.fScrollbar.update()},updateLeftNav:function(e){e&&val(geByTag1("ol",ge("side_bar")),e)},restoreApp:function(e,t,r){if(this.restoringApp)return!1;var n=ge("app"+e);return cur.deletedApps[e]&&"al_apps"==cur.deletedApps[e].from&&val(geByClass1("app_deleted_layer",n,"div"),cur.progressTpl),ajax.post(this.address,{act:"join",gid:cur.gid,gidhash:r,id:e,hash:t,restore:1,from:"al_apps",section:cur.section},{onDone:this.withFastBackCheck(function(t){cur.deletedApps[e]&&(val(n,cur.deletedApps[e].html),t.left_nav&&this.updateLeftNav(t.left_nav),delete cur.deletedApps[e]),cur.apps[e]&&(delete cur.apps[e].deleted,cur.appsIndex&&cur.appsIndex.add(cur.apps[e])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(n,"deleted")}.bind(this)),showProgress:function(){this.restoringApp=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(n,this.optionLoadingClass)}.bind(this),hideProgress:this.withFastBackCheck(function(){this.restoringApp=!1,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(n,this.optionLoadingClass)}.bind(this))}),!1},removeApp:function(e,t,r,n,o){if(n&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(n),this.removingApp)return!1;if(this.isDelayedOnSilentLoad("removeApp"+e,this.removeApp.bind(this,e,t,r)))return!1;this.ttDestroyAll();var i=r?ge("recent"+e):ge("app"+e),a=i&&cur.lContent&&cur.lContent.contains(i)&&this.isSection("settings")?"settings":r?"recent":"al_apps";if(cur.isGamesCatalogRedesign)window.GamesCatalog.removeApp(e);else{var s=function(){var r;"al_apps"==a&&(r=i&&geByClass1("app_deleted_layer",i,"div"),val(r,cur.progressTpl)),ajax.post(this.address,{act:"quit",gid:cur.gid,id:e,hash:t,offset:cur.recentOffset,from:a},{onDone:this.withFastBackCheck(function(t){"apps"==cur.module&&(delete cur.preload,cur.rNotWrap&&this.isSection("catalog","list")?this.recentTabsUpdate(!1,!0):(window.notificationsListChanged=!0,t.count_all&&this.notificationsSetCounters(t.count_all)),window.appsListChanged=!0,cur.apps[e]&&(cur.appsIndex&&cur.appsIndex.remove(cur.apps[e]),cur.apps[e].deleted=!0),t.left_nav&&this.updateLeftNav(t.left_nav),"settings"==a?(cur.deletedApps[e]={from:a,html:i.innerHTML},i&&i.appendChild(cf(t.html))):"recent"==a?(hide(i),geByClass1("apps_recent_row",cur.rAppsWrap)?cur.recentOffset+=t.offset:(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.rAppsNoContent,"hidden_no_content"),cur.recentOffset=0)):(cur.deletedApps[e]={from:a,html:i.innerHTML},t.html&&val(r,t.html)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(i,"deleted"))}.bind(this)),showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(i,this.optionLoadingClass),this.removingApp=!0}.bind(this),hideProgress:this.withFastBackCheck(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(i,this.optionLoadingClass),this.removingApp=!1}.bind(this))})}.bind(this);if("recent"==a)var c=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_quit_app_box_title")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)(o?"apps_game_quit_confirm":"apps_quit_confirm"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_remove"),(function(){s(),c.hide()}),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_cancel"));else if(cur.adminApps&&cur.adminApps[e])var l=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_deletingapp")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_admin_quit"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_delete"),(function(){s(),l.hide()}),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("global_cancel"));else s()}},runApp:function(e,t,r,n,o,i,a,s){if(!vk.id)return Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(cur.pleaseSignInLang),!1;Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(e);var c=clone(nav.objLoc);delete c.w,nav.setLoc(c),window.appsListChanged=1;var l="/"+t+"?join=1&hash="+r+"&sett="+n;if(a&&(l="/"+t+"?act=embed&join=1&join_hash="+r+"&sett="+n+"&hash="+s),cur.fromInstallBox&&(l+="&from_install="+(1==cur.fromInstallBox?1:2)),o)if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_16__.isObject)(o))for(var p in o)"w"!=p&&(l+="&"+p+"="+o[p]);else""!=o&&(l+="&ref="+o);i&&(l+="&mid="+i),nav.objLoc["#"]&&(l+="#"+nav.objLoc["#"]),a&&(location.href=l),cur.isGamesCatalogRedesign&&window.GamesCatalog&&window.GamesCatalog.nav&&(window.GamesCatalog.nav.clear(_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__.SECTION_INSTALLED),window.GamesCatalog.nav.clear(_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__.SECTION_PROFILE)),nav.go(l)},myAppOver:function(e,t,r,n){if(hasClass(t,"deleted")||!vk.id)return!1;if(window.cur.isGamesCatalogRedesign)return n=n||t.dataset.ref,void _web_apps_games_catalog_tooltip__WEBPACK_IMPORTED_MODULE_30__.default.show(t,e,n,+t.dataset.genreId,+t.dataset.collectionId);var o=!!t.dataset.forcetoup,i=!!t.dataset.forcetodown;Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__.showTooltip)(t,{url:this.address,params:{act:"show_app_friends_tt",aid:e,no_size:r?1:0},typeClass:"tt_black",slide:15,center:1,forcetoup:o,forcetodown:i,shift:[0,8,8],ajaxdt:200,showdt:300,hidedt:200,dir:"auto"})},ttScore:function(e,t,r){var n=void 0;return cur.ttScoreShown&&window.tooltips&&(tooltips.hideAll(),n=0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__.showTooltip)(e,{center:1,black:1,shift:[0,8,8],showsp:n,text:'<div class="apps_score_tt_cont"><b>'.concat(t,"</b>",r?'<div class="apps_score_tt">'+r+"</div>":"","</div>")})},ttCommon:function(e,t,r){return 0===(r=extend({parent:void 0,center:void 0,event:0,appendEl:void 0,shift:void 0},r)).event&&(r.event=window.event),r.event&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(r.event),r.appendEl&&(r.appendEl=ge(r.appendEl)),r.center?Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__.showTooltip)(e,{center:r.center,shift:r.shift||[0,8,8],black:1,appendEl:r.appendEl,text:t}):showTitle(e,t,r.shift,r)},ttHideAll:function(){window.tooltips&&tooltips.hideAll()},ttDestroyAll:function(){window.tooltips&&tooltips.destroyAll()},scrollToHeader:function(){var e=ge("apps_header_block"),t=scrollNode.scrollTop,r=getSize("page_header_cont")[1];if(e){var n=Math.max(0,getXY(e)[1]-parseInt(getStyle(e,"marginTop"),10));t+(vk.staticheader?Math.max(0,r-t):r)>n&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY)(n,200)}},scrollToSearch:function(){var e=scrollNode.scrollTop,t=getSize("page_header_cont")[1];if(cur.aSearchWrap){var r=getXY(domPN(cur.aSearchWrap))[1];e+(vk.staticheader?Math.max(0,t-e):t)>r&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY)(r,200)}},scrollCheck:function(){!cur.isGamesCatalogRedesign&&this.isDelayedOnSilentLoad("scrollCheck",this.scrollCheck.bind(this))||!_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__.browser.mobile&&!cur.isAppsLoading&&!cur.disableAutoMore&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.isVisible)(cur.lShowMoreButton)&&(window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight)+scrollGetY()+400>=cur.lShowMoreButton.offsetTop&&this.searchLoadContent()},searchFocusedClass:"apps_search_focused",backupListContent:function(e){if(cur.backupList||e){if(cur.backupList&&!cur.backupList.contentCopied&&e){for(cur.backupList.content=document.createDocumentFragment();cur.lContent.firstChild;)cur.backupList.content.appendChild(cur.lContent.firstChild);for(cur.backupList.preload=document.createDocumentFragment();cur.lPreload.firstChild;)cur.backupList.content.appendChild(cur.lPreload.firstChild);cur.backupList.contentCopied=!0}}else cur.backupList={cur:{loadMore:cur.loadMore,shownApps:cur.shownApps,sectionCount:cur.sectionCount,searchOffset:cur.searchOffset},content:null,preload:null,contentCopied:!1}},restoreListContent:function(){return cur.backupList?(this.searchProgress(!1),val(cur.lContent,""),val(cur.lPreload,""),extend(cur,cur.backupList.cur),cur.lContent.appendChild(cur.backupList.content),cur.lPreload.appendChild(cur.backupList.preload),delete cur.backupList,!0):(delete cur.backupList,!1)},indexAll:function(e){cur.appsIndex=new vkIndexer(cur.appsList.all,(function(e){try{return cur.apps[parseInt(e[0])]=e,e[3]}catch(e){return""}}),e)},searchUpdate:function(e){if(!this.isDelayedOnSilentLoad("searchUpdate",this.searchUpdate.bind(this,e))){((e=e||"").length<2||cur.previewTagsStr)&&(e="");var t=cur.previewTagsStr||Object.keys(cur.searchTags||{}).join(",");if(cur.ignoreEqual||cur.searchStr!==e||t!==cur.searchTagsStr){this.isSection("list")&&e&&this.backupListContent(),cur.searchStr=e||"",cur.searchTagsStr=t;var r=this.isSection("apps","settings","manage","admin_requests","reports","ads")?"all":"search";if(e&&this.isSection("apps","settings","manage","admin_requests","reports","ads")){var n=cur.appsIndex.search(clean(e));cur.curList=r+"_search_"+e+"_"+cur.searchTagsStr,cur.appsList[cur.curList]=n,e+=" "+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.parseLatin)(e)||""),e=trim(escapeRE(e).split("&").join("&amp;")),cur.selection={re:new RegExp("("+e.replace(cur.appsIndex.delimiter,"|")+")","gi"),val:"<span>$1</span>"}}else cur.curList=r,cur.selection=!1;this.ttHideAll(),this.searchProgress(!0),this.scrollToSearch(),hide(cur.lShowMoreButton),this.isSection("catalog","list")&&this.searchWriteToAddressBar(),cur.loadMore=1,cur.shownApps=cur.searchOffset=0,this.showRows()}delete cur.ignoreEqual}},showRows:function(){if(!this.isDelayedOnSilentLoad("showRows",this.showRows.bind(this))){if(cur.searchStr||cur.searchTagsStr)this.isSection("list","catalog")&&this.searchLoadContent();else{if(this.isSection("list"))return this.restoreListContent()||(extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),this.searchCatalog(cur.searchStr,cur.searchOffset)),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1;if(this.isSection("catalog"))return extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),val(cur.lContent,""),val(cur.lPreload,""),this.switchLayout("catalog"),this.searchProgress(!1),this.sliderStart(),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}if(this.isSection("settings","manage","admin_requests","apps","reports","ads")){if(cur.defaultCount&&cur.shownApps<cur.sectionCount){var e=clean(cur.searchStr),t=this.isSection("manage","admin_requests"),r="",n=cur.appsList[cur.curList]||[],o=n.length;if((n=this.filter(n.slice(cur.shownApps)).slice(0,cur.defaultCount)).length&&cur.appTpl){var i=[];each(n,(function(e,r){r=clone(r),cur.selection&&(r[3]=r[3].replace(cur.selection.re,cur.selection.val)),i.push(cur.appTpl(r,e==n.length-1,t))})),r=i.join("")}if(cur.shownApps?r&&cur.lContent.appendChild(cf(r)):r?(val(cur.lContent,r),val(cur.aSummaryCounter,o)):(val(cur.lContent,cur.aSummary.innerHTML.replace("{query}","<b>"+e+"</b>")),val(cur.aSummaryCounter,"")),cur.shownApps+=cur.defaultCount,cur.shownApps>=cur.sectionCount?hide(cur.lShowMoreButton):(show(cur.lShowMoreButton),this.scrollCheck()),cur.searchStr&&!cur.searchOffset&&this.isSection("apps","manage")){var a=this.isSection("apps")?_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceAppsList:_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceManage;Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.saveSearchAttemptStats)(a,0,n.length,e)}this.searchProgress(!1)}return!1}return!0}},searchLoadContent:function(){if(this.isSection("catalog","list")){if(cur.searchStr||(cur.searchStr=""),cur.lPreload.innerHTML){for(var e=document.createDocumentFragment();cur.lPreload.firstChild;)e.appendChild(cur.lPreload.firstChild);cur.lContent.appendChild(e)}return cur.loadMore?this.searchCatalog(cur.searchStr,cur.searchOffset):(cur.loadMore=!0,hide(cur.lShowMoreButton)),!1}return!this.isSection("apps","manage","admin_requests","settings","reports","ads")||this.showRows()},searchCatalog:function(e,t){e=e||"";var r=cur.searchTagsStr,n=+new Date;ajax.post(this.address,{act:e||r||!this.isSection("list")?"search":cur.list,q:e,offset:t,oid:cur.oid,from:cur.section,catalog_search:1,id:cur.listId||void 0,tags:r},{cache:e||cur.searchTagsStr?0:1,onDone:this.withFastBackCheck(function(o,i,a){if(e==cur.searchStr&&r==cur.searchTagsStr&&(this.isSection("catalog","list")&&((cur.searchStr||r)&&this.sliderStop(),this.switchLayout(cur.searchStr||r?"list":cur.section),this.searchWriteToAddressBar()),this.backupListContent(!0),o&&val(cur.lContent,o),val(cur.lPreload,i||""),cur.loadMore=!!i,extend(cur,a),cur.loadMore&&show(cur.lShowMoreButton),this.scrollCheck(),e&&!t)){var s=this.isSection("catalog","list")?_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceApps:"manage"===cur.section?_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceAppsManage:_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceAppsList;Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.saveSearchAttemptStats)(s,n,a.count,e)}}.bind(this)),showProgress:function(){cur.isAppsLoading=!0,Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(cur.lShowMoreButton)},hideProgress:this.withFastBackCheck(function(){cur.isAppsLoading=!1,this.searchProgress(!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.unlockButton)(cur.lShowMoreButton)}.bind(this))})},filter:function(e){for(var t=e.length,r=[],n=0;n<t;n++){var o=e[n];cur.apps&&cur.apps[o[0]]&&!cur.apps[o[0]].deleted&&r.push(o)}return r},searchLoadFromAddressBar:function(){setTimeout(()=>{cur.searchStr=nav.objLoc.q||"",cur.searchStr&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.saveSearchAttemptStats)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.serviceApps,0,cur.shownApps,cur.searchStr)},0)},searchWriteToAddressBar:function(e){nav.setLoc(extend(nav.objLoc,{q:cur.searchStr||null,tags:cur.searchTagsStr||null}))},searchProgress:function(e){cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default[e?"showProgress":"hideProgress"](cur.aSearch)},searchFocused:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.aWrap,this.searchFocusedClass)},searchBlured:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,this.searchFocusedClass)},searchReset:function(){cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.reset(cur.aSearch),cur.searchStr=""},switchLayout:function(e){cur.aWrap&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_catalog_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_list_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_manage_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_admin_requests_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_settings_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_apps_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.removeClass)(cur.aWrap,"apps_page_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(cur.aWrap,"apps_"+e+"_layout"))},geTabBySection:function(e,t){var r=ge("apps_tab_"+e+(t?"_"+t:""));return!(!r||!(r=geByTag1("a",r)))&&r},setHistoryBackRules:function(){this.isSection("manage","admin_requests")||(cur._back={show:[function(){if(cur._back.swap&&each(cur._back.swap,(function(e,t){t.dummy.parentNode.replaceChild(t.content,t.dummy)})),cur.fScrollbar&&cur.fScrollbar.scrollTop(cur.fScrollbar.data.scrollTop),cur.rNotScrollbar&&cur.rNotScrollbar.scrollTop(cur.rNotScrollbar.data.scrollTop),delete cur._back.swap,setTimeout(function(){cur.aSearch&&(_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.startEvents(cur.aSearch),cur.aSearch.value=cur.searchStr||"",_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.scrollResize(cur.aSearch)),this.searchWriteToAddressBar(cur.searchStr)}.bind(this),0),this.ttHideAll(),this.recentTabsUpdate(),this.startEvents(),cur.aTabs){var e=this.geTabBySection(this.isSection("list")?cur.list+(cur.listId||""):cur.section);e&&uiTabs.switchTab(e),uiTabs.hideProgress(cur.aTabs)}if(cur.aSubTabs){var t=this.geTabBySection(cur.section,cur.subsection);t&&uiTabs.switchTab(t),uiTabs.hideProgress(cur.aSubTabs)}}.bind(this)],hide:[this.stopEvents.bind(this),this.ttHideAll.bind(this)],text:cur.backLang})},switchTab:function(){},sliderInit:function(){"catalog"!=cur.section||cur.featuredSlider||(cur.featuredSlider=new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default({inner:"apps_featured_slides",outer:"apps_featured_slider",next:"apps_featured_next",prev:"apps_featured_prev",onSlide:function(){window.AdsLight&&AdsLight.applyAds()}}))},sliderStart:function(){cur.featuredSlider&&(cur.featuredSlider.slideshowStart(),cur.featuredSlider.addHandler())},sliderStop:function(){cur.featuredSlider&&(cur.featuredSlider.removeHandler(),cur.featuredSlider.slideshowStop())},addToMineGroups:function(e,t,r,n){var o={act:"add_to_mine_group_box",aid:e,hash:t,height:lastWindowHeight,from_gid:n};r&&(o.source=r),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)("apps",o,{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"}})},makeAppSlider:function(e){return new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default(e)},closeExternalApp:function(){cur.app.clientRpc&&cur.app.clientRpc.callMethod("closeExternalApp")},adminRequestRow:function(e){var t="",r=_slicedToArray(e,6),n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=r[5];if(s=intval(s),o=`<img src="${o}"/>`,i)if("away.php"==i.substr(0,8)){var l=i.replace(/&/g,"&amp;");a=`<a href="${i}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${a}</a>`,o=`<a href="${i}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${o}</a>`}else a=`<a href="${i}">${a}</a>`,o=`<a href="${i}">${o}</a>`;return cur.adminRequest&&void 0!==cur.adminRequest[n]?null!==cur.adminRequest&&(t=cur.adminRequest[n]?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_admin_request_accepted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_admin_request_declined")):t=`<a onclick='Apps.adminRequestAccept(this, ${n}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_admin_request_accept")}</a> | <a onclick='Apps.adminRequestDecline(this, ${n}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_admin_request_decline")}</a>`,rs(cur.rowTpl,{id:n,name:a,img:o,info:`<div class="apps_settings_size">${s?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_X_participants",s,!0):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_15__.getLang)("apps_noparticipants")}</div>`,actions:t})},adminRequestAccept:function(e,t,r){var n=gpeByClass("_app_settings_actions",e);n&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_accept_admin_request",aid:t,hash:r},{onDone:function(e,r,o){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=o,val(n,e),r&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},adminRequestDecline:function(e,t,r){var n=gpeByClass("_app_settings_actions",e);n&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_decline_admin_request",aid:t,hash:r},{onDone:function(e,r,o){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=o,val(n,e),r&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},share:function(e,t){Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)("like.php",{act:"publish_box",object:"app"+e+"_"+t})},qrCodeModal:function(){cur.qrModal||(cur.qrModal=new _shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_22__.default),cur.qrModal.init(),cur.qrModal.toggle()},unverifiedGoBack:function(){return window.history.back(),!1},initUnverifiedRunScreen:function(){if(window.globalHistory&&window.globalHistory.length){var e=geByClass1("apps_unverifiedAppWarning__btn_back");e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.addClass)(e,"apps_unverifiedAppWarning__btn_active")}},runUnverified:function(e,t){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_12__.lockButton)(e),nav.setLoc(extend(nav.objLoc,{run_hash:t})),nav.reload()},addAppQrCode:function(e){var t=geByClass1("apps_install_header__qr"),r=`${location.origin}/app${e}${location.hash}`,n=_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_24__.createQR(r,120,"",{isShowLogo:!0});t&&(t.innerHTML=n)},showHint:function(e,t,r){return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(t),r=r||{},r=extend({dir:"bottom",shift:[12,8],appendEl:document.body,width:200},r),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_14__.showHint)(e,r)},hideVkPayPromoBanner:function(e){window.tooltips&&window.tooltips.hideAll(),re(document.querySelector(".apps_vkPayPromo")),ajax.post("/apps",{act:"hide_vkpay_banner",hash:e})},openVkPayGamesMarket:e=>(Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_18__.statlogsValueEvent)("apps_catalog_vkpay_games_store_button",1),!0),changeCheckBackUrl:()=>{if(window.nav.objLoc&&cur.aid===ID_APP_CHECKBACK){var e=window.nav.objLoc[0];"check"!==e&&e!=="app"+ID_APP_CHECKBACK||(nav.objLoc[0]="checkback",window.nav.setLoc(nav.objLoc))}},showPaymentsBox:e=>{if(!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(e))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.cancelEvent)(e),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_13__.showBox)("al_gifts.php",{act:"get_money"},{}),!1},searchToggle:()=>{var e=document.querySelector("#apps_search"),t=document.querySelector("#s_search");e&&window.cur&&(cur.catalogSearchShown=+!e.classList.toggle("SearchToggle__hide")),t&&t.focus()},openPlayAtHomeLanding:e=>{if("A"!==e.target.tagName)return showWiki({w:"play_safe_at_home",ref:"challenge_landing_banner"})},addIcon(){window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":"")},scrollToY:_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY};function detectUnityWebPlayer(e,t){var r,n=function(e,t){var r=0,n=0,o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_11__.ce)("object",{type:"application/vnd.unity"},{visibility:"hidden"});window.bodyNode.appendChild(o),function i(){if(void 0===o.GetPluginVersion)n++<10?setTimeout(i,10):(window.bodyNode.removeChild(o),e(null));else{var a={};if(t)for(r=0;r<t.length;++r)a[t[r]]=o.GetUnityVersion(t[r]);a.plugin=o.GetPluginVersion(),window.bodyNode.removeChild(o),e(a)}}()},o=function(e){var t,r,n,o,i,a=0;if(e){var s=e.toLowerCase().match(/^(\d+)(?:\.(\d+)(?:\.(\d+)([dabfr])?(\d+)?)?)?$/);s&&s[1]&&(t=s[1],r=s[2]?s[2]:0,n=s[3]?s[3]:0,o=s[4]?s[4]:"r",i=s[5]?s[5]:0,a|=t/10%10<<28,a|=t%10<<24,a|=r%10<<20,a|=n%10<<16,a|={d:8192,a:16384,b:24576,f:32768,r:32768}[o],a|=i/100%10<<8,a|=i/10%10<<4,a|=i%10)}return a},i=!1;if(navigator.plugins.refresh(),void 0!==navigator.plugins&&navigator.plugins["Unity Player"]&&void 0!==navigator.mimeTypes&&navigator.mimeTypes["application/vnd.unity"]&&navigator.mimeTypes["application/vnd.unity"].enabledPlugin){if(i=!0,_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__.browser.safari&&/Mac OS X 10_6/.test(navigator.appVersion))return void n((function(t){t&&t.plugin||(i=!1),e(i,t)}),t);if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__.browser.chrome)return void n((function(t){t&&o(t.plugin)<=o("2.6.1f3")&&(i=!1),e(i,t)}),t);if(t)return void n((function(t){e(i,t)}),t)}else if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_19__.browser.msie){var a=!1;try{null!=ActiveXObject.prototype&&(a=!0)}catch(e){}if(a&&(!/win64/i.test(navigator.userAgent)||!/x64/i.test(navigator.userAgent)))try{var s=new ActiveXObject("UnityWebPlayer.UnityWebPlayer.1"),c=s.GetPluginVersion();if(t){r={};for(var l=0;l<t.length;++l)r[t[l]]=s.GetUnityVersion(t[l]);r.plugin=c}if(i=!0,"2.5.0f5"==c){var p=/Windows NT \d+\.\d+/.exec(navigator.userAgent);if(p&&p.length>0)parseFloat(p[0].split(" ")[2])>=6&&(i=!1)}}catch(e){}}e(i,r)}__webpack_exports__.default=AppsUtils},FEd1:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.set(t.debug);var r,n=l({limit:void 0,filter:function(){return!0},groupBy:function(){return null},undoType:i.ActionTypes.UNDO,redoType:i.ActionTypes.REDO,jumpToPastType:i.ActionTypes.JUMP_TO_PAST,jumpToFutureType:i.ActionTypes.JUMP_TO_FUTURE,jumpType:i.ActionTypes.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1},t,{initTypes:(0,a.parseActions)(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:(0,a.parseActions)(t.clearHistoryType,[i.ActionTypes.CLEAR_HISTORY])}),s=n.neverSkipReducer?function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return l({},t,{present:e.apply(void 0,[t.present,r].concat(o))})}:function(e){return e};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.start(i,t);for(var c,l=t,p=arguments.length,d=new Array(p>2?p-2:0),b=2;b<p;b++)d[b-2]=arguments[b];if(!r){if(o.log("history is uninitialized"),void 0===t){var v={type:"@@redux-undo/CREATE_HISTORY"},E=e.apply(void 0,[t,v].concat(d));return l=u(E,n.ignoreInitialState),o.log("do not set initialState on probe actions"),o.end(l),l}(0,a.isHistory)(t)?(l=r=n.ignoreInitialState?t:(0,a.newHistory)(t.past,t.present,t.future),o.log("initialHistory initialized: initialState is a history",r)):(l=r=u(t,n.ignoreInitialState),o.log("initialHistory initialized: initialState is not a history",r))}switch(i.type){case void 0:return l;case n.undoType:return c=m(l,-1),o.log("perform undo"),o.end(c),s.apply(void 0,[c,i].concat(d));case n.redoType:return c=m(l,1),o.log("perform redo"),o.end(c),s.apply(void 0,[c,i].concat(d));case n.jumpToPastType:return c=f(l,i.index),o.log("perform jumpToPast to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(d));case n.jumpToFutureType:return c=h(l,i.index),o.log("perform jumpToFuture to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(d));case n.jumpType:return c=m(l,i.index),o.log("perform jump to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(d));case g(i.type,n.clearHistoryType):return c=u(l.present,n.ignoreInitialState),o.log("perform clearHistory"),o.end(c),s.apply(void 0,[c,i].concat(d));default:if(c=e.apply(void 0,[l.present,i].concat(d)),n.initTypes.some((function(e){return e===i.type})))return o.log("reset history due to init action"),o.end(r),r;if(l._latestUnfiltered===c)return l;var w="function"==typeof n.filter&&!n.filter(i,c,l);if(w){var O=(0,a.newHistory)(l.past,c,l.future,l.group);return n.syncFilter||(O._latestUnfiltered=l._latestUnfiltered),o.log("filter ignored action, not storing it in past"),o.end(O),O}var y=n.groupBy(i,c,l);if(null!=y&&y===l.group){var C=(0,a.newHistory)(l.past,c,l.future,l.group);return o.log("groupBy grouped the action with the previous action"),o.end(C),C}return l=_(l,c,n.limit,y),o.log("inserted new state into history"),o.end(l),l}}};var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}r.default=e,t&&t.set(e,r);return r}(r("Hh3O")),i=r("1VNw"),a=r("9O7i");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){var r=(0,a.newHistory)([],e,[]);return t&&(r._latestUnfiltered=null),r}function _(e,t,r,n){var i=e.past.length+1;o.log("inserting",t),o.log("new free: ",r-i);var s=e.past,c=e._latestUnfiltered,l=r&&r<=i,p=s.slice(l?1:0),u=null!=c?[].concat(d(p),[c]):p;return(0,a.newHistory)(u,t,[],n)}function h(e,t){if(t<0||t>=e.future.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=[].concat(d(r),[o],d(n.slice(0,t))),s=n[t],c=n.slice(t+1);return(0,a.newHistory)(i,s,c)}function f(e,t){if(t<0||t>=e.past.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=r.slice(0,t),s=[].concat(d(r.slice(t+1)),[o],d(n)),c=r[t];return(0,a.newHistory)(i,c,s)}function m(e,t){return t>0?h(e,t-1):t<0?f(e,e.past.length+t):e}function g(e,t){return t.indexOf(e)>-1?e:!e}},HDq7:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var n=["GamesFlashBanner--step1","GamesFlashBanner--step2","GamesFlashBanner--step3"];class o{static init(e,t){if(!window.browser.flash){var r=window.document.getElementById("GamesFlashBanner");r.classList.add("GamesFlashBanner--visible"),e&&e.classList.add("apps_hidden"),t&&t.classList.add("GamesFlashBanner__pageWrap"),r.addEventListener("click",e=>{if(e.target&&e.target.classList.contains("GamesFlashBanner__flashInstallBtn")&&!e.metaKey&&!e.ctrlKey){n.forEach(e=>{r.classList.remove(e)});var t=e.target.dataset.gotostep;r.classList.add(n[t-1])}})}}}},Hh3O:function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){o=e},t.start=function(e,t){void(i={header:[],prev:[],action:[],next:[],msgs:[]}),o&&(console.group?(i.header=["%credux-undo","font-style: italic","action",e.type],i.action=l("action",s,e),i.prev=l("prev history",a,t)):(i.header=["redux-undo action",e.type],i.action=["action",e],i.prev=["prev history",t]))},t.end=function(e){o&&(console.group?i.next=l("next history",c,e):i.next=["next history",e],function(){var e=i,t=e.header,r=e.prev,o=e.next,a=e.action,s=e.msgs;if(console.group){var c,l,p,d,u;(c=console).groupCollapsed.apply(c,n(t)),(l=console).log.apply(l,n(r)),(p=console).log.apply(p,n(a)),(d=console).log.apply(d,n(o)),(u=console).log.apply(u,n(s)),console.groupEnd()}else{var _,h,f,m,g;(_=console).log.apply(_,n(t)),(h=console).log.apply(h,n(r)),(f=console).log.apply(f,n(a)),(m=console).log.apply(m,n(o)),(g=console).log.apply(g,n(s))}}())},t.log=function(){if(o){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.msgs=i.msgs.concat([].concat(t,["\n"]))}};var a="#9E9E9E",s="#03A9F4",c="#4CAF50";function l(e,t,r){return["%c".concat(e),"color: ".concat(t,"; font-weight: bold"),r]}},JX7q:function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,"default",(function(){return n}))},PU8N:function(e,t,r){"use strict";r.r(t),r.d(t,"isMvk",(function(){return o})),r.d(t,"getVideoDuration",(function(){return i})),r.d(t,"getMediaBlob",(function(){return a})),r.d(t,"getBlobType",(function(){return s})),r.d(t,"noop",(function(){return c})),r.d(t,"getAverageRGB",(function(){return l})),r.d(t,"loadImage",(function(){return p})),r.d(t,"loadImages",(function(){return d})),r.d(t,"loadFontFace",(function(){return u})),r.d(t,"loadFontFacePromise",(function(){return _})),r.d(t,"getCroppedImage",(function(){return h}));var n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(){return!!window.isMVK}function i(e){return void 0===e&&(e=""),new Promise((function(t,r){var n=document.createElement("video");n.addEventListener("loadedmetadata",(function(){return t(n.duration)}),{once:!0}),n.addEventListener("error",r,{once:!0}),n.crossOrigin="anonymous",n.preload="metadata",n.src=e}))}function a(e){return new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(404===n.response.status)return r();t(n.response)},n.onerror=r,n.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var c=function(){};function l(e){var t,r={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,o=0;(n+=20)<t.data.length;)++o,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/o),r.g=~~(r.g/o),r.b=~~(r.b/o),r}function p(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin=e.startsWith("data:")?null:"Anonymous",n.onerror=function(){return r(new Error("Failed to load image's URL: "+e))},n.onload=function(){return t(n)},n.src=e}))}var d=function(e){return new Promise((function(t){var r=e.map((function(e){return p(e)}));Promise.all(r).then((function(e){return t(e)})).catch((function(){}))}))};function u(e,t){var r,n,o,i,a,s,c,l,p={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},u={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function _(e){var t=[];return each(e,(function(e,r){t.push(e+":"+r)})),t.join(";")}function h(e,t,r){return Math.abs(e.width-t.offsetWidth)>r||Math.abs(e.height-t.offsetHeight)>r}function f(){i||(utilsNode.appendChild(a),i=!0,o={sansSerif:{width:c.offsetWidth,height:c.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(c.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(c,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),i&&o&&(h(o.sansSerif,c,t.tolerance)||h(o.serif,s,t.tolerance))?(re(a),t.success()):(new Date).getTime()-n.getTime()>t.timeout?(re(a),t.error()):!i&&"requestAnimationFrame"in window?window.requestAnimationFrame(f):window.setTimeout(f,t.delay)}for(var m in d)t.hasOwnProperty(m)||(t[m]=d[m]);u["font-weight"]=t.weight,u["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(r=setTimeout((function(){t.error()}),t.timeout)),function(r){each(null===document||void 0===document?void 0:document.fonts,(function(n){n.family.toLowerCase()===e.toLowerCase()&&(p[n.weight]||n.weight)===""+t.weight&&n.style===t.style&&n.load().then((function(){t.success(),clearTimeout(r)}))}))}(r)):(l="AxmTYklsjo190QW"+t.glyphs,n=new Date,a=ce("div"),c=ce("div",{innerHTML:l}),s=ce("div",{innerHTML:l}),c.setAttribute("style",_(extend({"font-family":"sans-serif"},u))),s.setAttribute("style",_(extend({"font-family":"serif"},u))),a.appendChild(c),a.appendChild(s),f())}function _(e,t){return new Promise((function(r,o){u(e,n(n({},t),{glyphs:"",success:function(){var e=function(){r(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){o(),(null==t?void 0:t.error)&&t.error()}}))}))}function h(e,t,r,n,o){return new Promise((function(i,a){("string"==typeof e?p(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var c=s.getContext("2d");if(c){c.drawImage(e,0,0);var l=c.getImageData(t,r,n,o),d=document.createElement("canvas");d.width=n,d.height=o;var u=d.getContext("2d");if(u)return u.putImageData(l,0,0),p(d.toDataURL("image/jpeg",1)).then(i).catch(a);i(e)}else i(e)})).catch(a)}))}},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));r("rGqo"),r("a1Th"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));class i extends n.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,i=e.size,a=e.duration,s=e.strokeWidth,c=e.className,l=this.id,p=this.offset,d=this.animation,u=Object(o.classNames)("Spinner",c);return n.createElement("div",{className:u,style:t},n.createElement("svg",{className:"Spinner__svg",width:i,height:i,viewBox:`0 0 ${i} ${i}`,xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{style:{width:i,height:i,transformOrigin:.5*i+"px "+.5*i+"px"}},n.createElement("style",{dangerouslySetInnerHTML:{__html:d}}),n.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:p,strokeDashoffset:p,strokeWidth:s,style:{animationName:"dash"+l,animationTimingFunction:"ease-in-out",animationDuration:a+"s",animationIterationCount:"infinite"},cx:.5*i,cy:.5*i,r:.5*i-.5*s}))))}}i.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,i,a,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,o,i,a,s],p=0;(c=new Error(t.replace(/%s/g,(function(){return l[p++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},RJZa:function(e,t,r){"use strict";r.r(t),r.d(t,"confirm",(function(){return s})),r.d(t,"cls",(function(){return c})),r.d(t,"lockBoxButton",(function(){return l})),r.d(t,"hideBox",(function(){return p})),r.d(t,"showErrorBox",(function(){return d})),r.d(t,"ajax",(function(){return u})),r.d(t,"getValues",(function(){return _})),r.d(t,"deepClone",(function(){return h})),r.d(t,"photoObjToSrc",(function(){return f}));r("VRzm"),r("Btvt");var n=r("EasH"),o=r("ZxpX"),i=r("6krn"),a=r("t7n3");function s(e,t){return new Promise((r,o)=>{var a={title:e,onHide:o};return new n.MessageBox(a).content(t).setButtons(Object(i.getLang)("global_yes"),r,Object(i.getLang)("global_cancel"),o).show()})}function c(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return t=t||"",n=n.map(t=>isString(t)&&"_"===t.slice(0,1)?e+t:t),Object(o.classNames)(e+t,...n)}function l(){var e=curBox();if(e){var t=e.btns.ok[0];t&&window.lockButton(t)}}function p(){var e=curBox();e&&e.hide()}function d(e){p(),Object(n.showFastBox)(Object(i.getLang)("global_error"),e)}function u(e,t){return new Promise((r,n)=>{window.ajax.post(e,t,{onDone:function(){r(...arguments)},onFail:function(){return n(...arguments),!0}})})}function _(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function h(e){return Object(a.clone)(e,!0)}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"a",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"b";r=window.isRetina()?n:r;var o="";if(!e.sizes2&&!e.sizes)return o;var i=e.sizes2?e.sizes2:e.sizes,a=e.urls2?e.urls2:e.urls;if(!i||!i.length)return o;for(var s=0;s<i.length;s++){var c=i[s];if(c[0]===r)return t+a[s]}return o}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",(function(){return n}))},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=e=>{var t=e.className,r=e.children,s=a(e,["className","children"]),c=Object(o.classNames)("Radio",t,{"Radio--disabled":e.disabled});return n.createElement("label",{className:c},n.createElement("input",i({className:"Radio__input Radio__visuallyHidden",type:"radio"},s)),n.createElement("span",{className:"Radio__control"}),Boolean(r)&&n.createElement("span",{className:"Radio__text"},r))};s.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=s},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},TfWv:function(e,t,r){"use strict";r.r(t);var n,o=r("q1tI"),i=r("i8i4"),a=r("clTp"),s=r("qihR"),c=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(){return(l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p=function(e){var t=e.position,r=e.align,n=e.text,o=e.rect,i=e.marginTop,a=e.marginLeft,s=e.maxWidth,c=e.appearance,l=e.className,p=o.left,d=o.top;switch(t){case"t":p+=.5*o.width;break;case"r":p+=o.width,d+=.5*o.height;break;case"b":p+=.5*o.width,d+=o.height;break;case"l":d+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:p=Math.round(p+(a||0)),y:d=Math.round(d+(i||0)),maxWidth:s,appearance:c,className:l}}},d=function(e){function t(t){var r=e.call(this,t)||this;return r.tooltipRef=o.createRef(),r.onMouseEnter=function(){if(r.state.el){var e=r.props,t=e.text,n=e.position,o=e.align,i=e.marginTop,s=e.marginLeft,c=e.maxWidth,l=e.appearance,p=e.className,d=Object(a.default)(r.state.el);r.update({text:t,position:n,align:o,rect:d,marginTop:i,marginLeft:s,maxWidth:c,appearance:l,className:p})}},r.onMouseLeave=function(e){var t=e.relatedTarget,n=r.tooltipRef.current;!(Boolean(t)&&Boolean(n)&&(n===t||(null==n?void 0:n.contains(t))))&&r.update()},r.onTransitionEnd=function(e){"visibility"===e.propertyName&&r.state.tooltip&&r.setState({tooltip:void 0})},r.onTooltipMouseEnter=function(){return r.onMouseEnter()},r.onTooltipMouseLeave=function(){return r.update()},r.state={el:null},r}return c(t,e),t.prototype.componentDidMount=function(){var e=i.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?p(l(l({},e),{rect:Object(a.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(p(e))},t.prototype.render=function(){var e=this.state.tooltip;return e&&"undefined"!=typeof window?o.createElement(o.Fragment,null,this.props.children,o.createElement(s.default,l({},e,{tooltipRef:this.tooltipRef,onMouseEnter:this.onTooltipMouseEnter,onMouseLeave:this.onTooltipMouseLeave,onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(o.Component);t.default=d},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function i(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,r&&(i.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},WPHA:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return O}));r("rGqo"),r("rE2o"),r("ioFf"),r("a1Th"),r("Btvt"),r("HEwt");var n=r("D1OX"),o=r("EasH"),i=r("4+be"),a=r("zxIV"),s=r("kcIO"),c=r("FWc3"),l=r("v+DW"),p=r("t7n3"),d=r("qJhe"),u=r("bKAG");var _=r("59zB"),h=r("k487"),f=r("Egk5"),m=r("BJj/"),g=r("jE6c"),b=Object(a.clientHeight)();class v{constructor(){this.scrollEl=null,this.offset=0,this.contentEl=null,this.allLoaded=!1,this.loading=!1,this.scrollHandler=null}init(){this.offset=20,this.allLoaded=!1,this.scrollEl=window.wkLayerWrap,this.contentEl=document.querySelector(".wk_wiki_content"),this.scrollHandler=()=>{this._onScroll()},addEvent(this.scrollEl,"scroll",this.scrollHandler),this.initDestroy()}initDestroy(){window.cur=window.cur||{},window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.destroy()});var e=window.wkcur.onHide;window.wkcur.onHide=()=>{Object(g.isFunction)(e)&&e(),this.destroy()}}destroy(){removeEvent(this.scrollEl,"scroll",this.scrollHandler)}_loadMore(){if(!this.allLoaded&&!this.loading){this.loading=!0;var e=Object(a.ce)("div",{className:"GamesGiftsLoader",id:"gifts_loader"});Object(l.showProgress)(e),this.contentEl.appendChild(e),ajax.post("/apps",{act:"gifts_friends_wish_list_more",offset:this.offset},{onDone:(t,r)=>{this.loading=!1,Object(a.re)(e),t?(this.offset=r,this.contentEl.insertAdjacentHTML("beforeend",t),window.cur.GameGifts&&window.cur.GameGifts.initGallery()):(this.allLoaded=!0,removeEvent(this.scrollEl,"scroll",this.scrollHandler))}})}}_onScroll(){return Object(m.debounce)(()=>{b>=this.scrollEl.scrollHeight-this.scrollEl.scrollTop-Object(a.clientHeight)()&&this._loadMore()},20)()}}function E(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class O{static isEnabled(){return!0}static defineGamesGifts(){O.isEnabled()&&(window.cur=window.cur||{},window.cur.GameGifts=new O,window.cur.GiftsFriendsWishListLoader=new v)}constructor(){this.receiverId=0,this.boxWrap=null,this.giftBox=null,this.tooltipHash=""}initGallery(){var e,t=E(document.querySelectorAll(".ui_gallery"));try{for(t.s();!(e=t.n()).done;){var r=e.value;new n.UIGallery(r,{scrollY:!1,markOutside:!0})}}catch(e){t.e(e)}finally{t.f()}}init(e,t){this.initGallery(),e&&(this.tooltipHash=t,this.showFeatureToolTip())}showTooltip(e){var t=e.dataset.title;Object(c.showTitle)(e,t,[0,8],{center:1,appendEl:document.body})}showSendGiftBox(e,t,r,n){return"button"===e.tagName.toLowerCase()&&this.disableBtn(e),Object(o.showBox)("/apps",{act:"game_gifts_show_send_box",recipient_id:t,gift_id:r,hash:n},{params:{width:450,onHide:()=>{"button"===e.tagName.toLowerCase()&&this.enableBtn(e)}}}),!1}disableBtn(e){e.classList.add("GameGifts__giftItem--BtnDisabled"),e.disabled=!0}enableBtn(e){e.disabled=!1,e.classList.remove("GameGifts__giftItem--BtnDisabled")}showFriendsDropBox(e,t){var r=document.querySelector(".GameGifts__giftBox--dropBox");new Dropdown(r,e,{big:1,multiselect:!1,width:400,autocomplete:!0,selectedItems:t||void 0,noResult:Object(i.getLang)("apps_game_gifts_box_friends_not_found"),introText:Object(i.getLang)("apps_game_gifts_box_friends_placeholder"),placeholder:Object(i.getLang)("apps_game_gifts_box_friends_placeholder"),withIcons:!0,onChange:e=>{this.giftBox&&(e?this.enableBtn(this.giftBox.btns.ok[0]):this.disableBtn(this.giftBox.btns.ok[0])),this.receiverId=e}})}sendGift(e,t,r,n,a){var s=Object(l.isChecked)("GameGifts__giftBox--nonameInput");Object(o.showBox)("/apps",{act:"show_order_box",aid:t,hash:r,receiver_id:this.receiverId,item:n,type:"item",gift_hash:a,is_gift:1,is_anonymous_gift:Object(p.intval)(s),gift_id:e},{params:{dark:1,onDestroy:()=>{this.hideSendGiftBox()}},onFail:e=>(Object(o.showFastBox)({title:Object(i.getLang)("global_error")},e),!0)})}removeItemFromWishList(e){var t=Array.from(document.querySelectorAll(".GameGifts__giftItem")).length,r=Object(a.domCA)(e,".GameGifts__giftItem"),n=Object(a.domCA)(e,".GameGifts__gameItem");if(r&&(t--,Object(a.re)(r),n.querySelector(".GameGifts__giftItem")||Object(a.re)(n),!t)){var o=document.querySelector(".wk_wiki_content");Object(a.re)(document.querySelector(".GameGifts__gameItem")),o.insertAdjacentHTML("beforeend",`\n              <div class="GameGiftsLayer__empty">\n                <div class="GameGiftsLayer__emptyMessage">${Object(i.getLang)("apps_game_gifts_empty_wish_list")}</div>\n              </div>\n            `)}}toggleWishList(e,t,r,n,o){Object(f.cancelEvent)(t),this.featureToooltip&&this.hideFeatureTooltip(),window.tooltips&&window.tooltips.hideAll(),e.classList.toggle("GameGifts__giftItemFavorite--isFavorite"),e.classList.contains("GameGifts__giftItemFavorite--isFavorite")?(Object(s.showDoneBox)(Object(i.getLang)("apps_game_gifts_added_to_wish_list"),{timeout:2e3}),e.dataset.title=Object(i.getLang)("apps_game_gifts_favorite_delete")):(e.dataset.title=Object(i.getLang)("apps_game_gifts_favorite_add"),Object(s.showDoneBox)(Object(i.getLang)("apps_game_gifts_removed_from_wish_list"),{timeout:2e3}),o&&this.removeItemFromWishList(e)),ajax.post("/apps",{act:"gifts_toggle_wish_list",hash:n,gift_id:r})}initSendGiftBox(e,t,r,n,o,a,s){this.boxWrap=document.querySelector(".GameGifts__giftBox--wrap"),this.showFriendsDropBox(a,s),this.giftBox=curBox(),this.giftBox.removeButtons(),this.giftBox.removeButtons(),this.receiverId=s,this.giftBox.addButton(Object(i.getLang)("apps_game_gifts_box_send"),()=>{this.receiverId?this.sendGift(e,t,r,n,o):Object(l.notaBene)(this.boxWrap.querySelector(".selector_input"))}),this.giftBox.addButton(Object(i.getLang)("global_cancel"),null,"no"),this.receiverId||this.disableBtn(this.giftBox.btns.ok[0])}share(e,t,r,n){return class{static share(e,t,r,n){ajax.post("/apps",{act:"gifts_get_story_share_data",gift_id:t,sender_id:+n,hash:r,share_type:e},{onDone:e=>{d.StoryPublisher.init({entrypoint:u.StoryEntryPoint.MINI_APP,photoUrl:e.image_url,attachment:{type:"url",text:"learn_more",url:e.link},stickers:[{sticker_type:"native",sticker:{action_type:"text",action:{text:e.message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.9,translation_x:0,translation_y:.01}}},{sticker_type:"native",sticker:{action_type:"text",action:{text:e.additional_message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.5,translation_x:0,translation_y:.3}}}]})},onFail:()=>(Object(o.showFastBox)(getLang("global_error"),getLang("global_error")),!0)})}}.share(e,t,r,n),!1}hideSendGiftBox(){setTimeout(()=>{this.giftBox&&this.giftBox.hide()},0)}loadMoreUsersWithGift(e,t,r){if(t.data.scrollBottom-200<=0&&!t.loading&&t.hasMore){var n=document.querySelector("#users-with-gift-list");if(!n)return;var o=n.querySelector(".ui_scroll_content");if(!o)return;t.loading=!0,ajax.post("/apps",{act:"gifts_users_with_gift_more",gift_id:e,offset:t.dataOffset,only_friends:Object(p.intval)(r)},{onDone:(e,r,n)=>{t.loading=!1,e&&o.insertAdjacentHTML("beforeend",e),t.dataOffset=n,t.hasMore=r},onFail:()=>{t.loading=!1}})}}hideFeatureTooltip(e){Object(f.cancelEvent)(e),this.featureToooltip&&(this.featureToooltip.hide(),ajax.post("/al_index.php",{act:"hide_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash}))}showFeatureToolTip(){var e=document.querySelector(".GameGifts__giftItemFavorite ");this.featureToooltip&&this.featureToooltip.destroy(),this.featureToooltip=new h.default(e,{autoShow:!1,content:'<div class="feature_intro_tt_hide" onclick="cur.GameGifts.hideFeatureTooltip(event);"></div>'+Object(i.getLang)("apps_game_gifts_feature_tt"),appendToParent:!0,cls:"feature_intro_tt GamesGiftsFeatureTooltip",offset:[1,-4],onHide:()=>{e.classList.remove("GameGifts__giftItemFavorite--focused"),this.featureToooltip&&this.featureToooltip.destroy()},onShow:()=>{e.classList.add("GameGifts__giftItemFavorite--focused"),ajax.post("/al_index.php",{act:"show_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash})}}),setTimeout(()=>{this.featureToooltip.show()},500)}showUsersWithGiftBox(e,t){return!Object(o.showBox)("/apps",{act:"gifts_users_with_gift_box",gift_id:e,only_friends:Object(p.intval)(t)},{params:{width:500},containerClass:"GamesFriendsWithGiftBox",cache:1,onDone:(r,n)=>{var o={};n.has_more&&(o.onupdate=r=>{this.loadMoreUsersWithGift(e,r,t)});var i=new _.default("users-with-gift-list",o);i.dataOffset=n.new_offset,i.hasMore=n.has_more}})}}},WRIt:function(e,t,r){"use strict";r.r(t);var n=r("jE6c"),o=function(e){if(this.options=extend({inner:null,outer:null,next:null,prev:null,infinite:!0,slideshowDuration:4e3,animationDuration:500,isVkApp:!1},e||{}),this.required=null,this.current=null,this.slideNext=null,this.slidePrev=null,this.slideCurrent=null,this.hasVideoSlides=!1,this.videoPlayer=null,this._handlerInst=null,this._arrowNextHandler=null,this._arrowPrevtHandler=null,this.options.outer&&this.options.inner&&(this.outer=ge(this.options.outer),this.inner=ge(this.options.inner),this.outer&&this.inner)){if(this.slideshow=!1,this.animation={stop:function(){}},this.slideshowTimeout=null,this.interacted=!1,this.slides=domChildren(this.inner),this.options.infinite){if(!this.slides.length)return void re(this.outer);if(this.slides.length<3)for(var t=null,r=0;this.slides.length<4;)t=this.slides[r++].cloneNode(!0),this.slides.push(t),this.inner.appendChild(t)}(this.arrowNext=ge(this.options.next))&&(this._arrowNextHandler=this.next.bind(this),addEvent(this.arrowNext,"mousedown",this._arrowNextHandler)),(this.arrowPrev=ge(this.options.prev))&&(this._arrowPrevtHandler=this.prev.bind(this),addEvent(this.arrowPrev,"mousedown",this._arrowPrevtHandler)),this.inited=!1,this.init()}};o.prototype={init:function(){if(void 0!==this.inited)return!!this.inited||(0!==this.outer.offsetWidth&&0!==this.slides[0].offsetWidth?(this.widthOuter=this.outer.offsetWidth,this.widthInner=this.inner.offsetWidth,this.widthSlide=this.widthInner/this.slides.length,this.offsetInner=this.inner.offsetLeft,this.widthSide=(this.widthOuter-this.widthSlide)/2,this.indexNext=this.slides.length-1,this.indexPrev=0,this.indexMargin=(this.slides.length-1)/2|0,this.indexRequired=this.indexCurrent=this.getIndex(),this.highlight(),this.rearrange(),this._initVideoSlides(),this.slideshow&&!this.slideshowTimeout&&this.slideshowStart(),this.inited=!0):void 0)},highlight:function(){this.slideHighlighted&&(removeClass(this.slideHighlighted,"selected"),this.slideHighlighted=null,this.indexHighlighted=null),this.indexHighlighted!==this.indexCurrent&&(this.indexHighlighted=this.indexCurrent,this.slideHighlighted=this.slides[this.getIndex(this.indexCurrent)],addClass(this.slideHighlighted,"selected"))},handler:function(e){var t=e.target&&(e.target===this.outer||this.outer.contains(e.target));this.interacted!=t&&(this.interacted=t,t?(this.slideshowInterrupted=this.slideshow,this.slideshowStop()):(this.slideshow=this.slideshowInterrupted,this.slideshow&&this.slideshowStart()))},slideshowStart:function(){this.slideshow=!0,this.interacted||this._videosIsPlay||(this.slideshowStop(),this.slideshow=!0,this.slideshowTimeout=setTimeout(function(){this.slideshowTimeout=null,vk.rtl?this.indexRequired--:this.indexRequired++,this.serve()}.bind(this),this.options.slideshowDuration))},slideshowStop:function(){this.slideshow=!1,this.slideshowTimeout&&(clearTimeout(this.slideshowTimeout),this.slideshowTimeout=null)},addHandler:function(){this.init()&&(this.removeHandler(),this._handlerInst=this.handler.bind(this),addEvent(document,"mousemove",this._handlerInst))},removeHandler:function(){this._handlerInst&&removeEvent(document,"mousemove",this._handlerInst)},removeAllHandlers:function(){this.removeHandler(),this._arrowNextHandler&&removeEvent(this.arrowNext,"mousemove",this._arrowNextHandler),this._arrowPrevtHandler&&removeEvent(this.arrowPrev,"mousemove",this._arrowPrevtHandler)},requireIndex:function(e){this.indexRequired=this.getIndex(e||0),this.serve()},next:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired>=this.slides.length-1)return;this.indexRequired++,this.serve()}},last:function(){this.indexRequired=this.slides.length-1,this.serve()},prev:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired<1)return;this.indexRequired--,this.serve()}},getIndex:function(e,t){return void 0!==e?(e=e%this.slides.length+(e<0?this.slides.length:0))===this.slides.length?0:e:(e=(this.offsetInner-this.widthSide)/-this.widthSlide,t?e:Math.round(e))},serve:function(){if(this.init()){var e=this.getIndex(this.indexRequired),t=this.required!=e,r=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2);this.required=e,t&&Object(n.isFunction)(this.options.onRequired)&&this.options.onRequired(),this.options.infinite||(this.indexRequired=this.required),this.animation.stop(),this.animation=new Fx.Base({style:{}},{duration:this.options.animationDuration,transition:Fx.Transitions.easeOutCubic,onComplete:this.served.bind(this),onStep:function(e){this.offsetInner=e.left,setStyle(this.inner,"left",this.offsetInner);var t=this.indexCurrent;this.indexCurrent=this.getIndex(),t!==this.indexCurrent&&(this.indexCurrent===this.indexRequired&&this.highlight(),this.rearrange(),Object(n.isFunction)(this.options.onChange)&&this.options.onChange())}.bind(this)}),this.animation.start({left:this.offsetInner},{left:r})}},served:function(){var e=this.indexCurrent-this.getIndex(this.indexCurrent);e>30&&(this.indexPrev=0,this.indexNext=this.slides.length-1,this.indexCurrent-=e,this.indexRequired-=e,this.offsetInner=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2),this.inner.style.left=this.offsetInner+"px",each(this.slides,(function(e,t){t.style.left=0}))),this.hasVideoSlides&&this._serveVideoSlide(),this.rearrange(),Object(n.isFunction)(this.options.onSlide)&&this.options.onSlide(),this.slideshow&&this.slideshowStart()},rearrange:function(){if(this.options.infinite){for(;this.indexCurrent>=this.indexNext-this.indexMargin;){var e=this.getIndex(this.indexNext);this.slides[e].style.left=(this.indexNext-e)*this.widthSlide+"px",this.indexNext++,this.indexPrev++}for(;this.indexCurrent<=this.indexPrev+this.indexMargin;){var t=this.getIndex(this.indexPrev);this.slides[t].style.left=(this.indexPrev-t)*this.widthSlide+"px",this.indexPrev--,this.indexNext--}}this.current=this.getIndex(this.indexCurrent),this.slideNext=this.slides[this.options.infinite?this.getIndex(this.indexCurrent+1):this.indexCurrent+1]||null,this.slidePrev=this.slides[this.options.infinite?this.getIndex(this.indexCurrent-1):this.indexCurrent-1]||null,this.slideCurrent=this.slides[this.current]},update:function(){this.inited=!1,this.slides=domChildren(this.inner),this.init()},destroy:function(){this.slideshowStop(),this.removeAllHandlers(),this.hasVideoSlides=!1},getCurrentSlide:function(){return this.slides[this.current]},_initVideoSlides:function(){var e=this;each(this.slides,(function(){if(domData(this,"video"))return e.hasVideoSlides=!0,!1})),e.hasVideoSlides&&(this._preloadVideos(),this._serveVideoSlide())},_isPreloadedVideo:function(e){var t=!1;return each(ajaxCache,(function(r,n){if(0==r.indexOf("/al_video.php?act=show_inline")&&r.indexOf("&video="+e)>0)return t=!0,!1})),t},_onVideoPreloaded:function(e,t){if(e&&t[3]&&t[3].player){var r=t[3].player.params[0];VideoPlayer.preload(r)}},_preloadVideos:function(){var e=this;each(this.slides,(function(){if(domData(this,"video")){var t=e._getVideoParams(this);e._isPreloadedVideo(t.video)||loadInlineVideo(t,e._onVideoPreloaded,!0)}}))},_onVideoStop:function(){this._videosIsPlay=!1,this.interacted=!1,this.slideshowStart()},_onVideoStart:function(){this._videosIsPlay=!0,this.interacted=!0,this.slideshowStop()},_onVideoLoaded:function(e,t){this.videoPlayer=t,t.on("media.playing",function(){this.getCurrentSlide()===e?this._onVideoStart():(t.seekTo(0),t.pause())}.bind(this)),t.on("media.ended",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.error",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.pause",this._onVideoStop.bind(this)),t.on("_destroy",this._onVideoStop.bind(this))},_getVideoParams:function(e){return{video:domData(e,"video"),list:domData(e,"hash"),autoplay:1,from_autoplay:1,module:"apps_slider",addParams:{from_autoplay:1},no_progress:1,cache:1}},_serveVideoSlide:function(){var e,t,r,n,o=this.getCurrentSlide();domData(o,"video")?(e=geByTag1("img",o),t=domData(e,"loading"),r=domData(e,"playing"),t||r?this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.play():((n=this._getVideoParams(o)).onLoaded=this._onVideoLoaded.bind(this,o),this._canUseVideo()&&showInlineVideo(n.video,n.list,n,!1,e))):this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.pause()},_canUseVideo:function(){var e=window.wkcur&&window.wkcur.shown&&window.wkLayerWrap&&isVisible(window.wkLayerWrap)||window.Videoview.isLayerShown();if(e)return!1;var t=cur.videoInlinePlayer?cur.videoInlinePlayer.getState():"unknown",r=~["paused","ended"].indexOf(t);return!cur.videoInlinePlayer||cur.videoInlinePlayer===this.videoPlayer||r&&!e}},t.default=o},aJgW:function(e,t,r){"use strict";r.r(t),r.d(t,"ColorSchemeMode",(function(){return n})),r.d(t,"ColorSchemeName",(function(){return o})),r.d(t,"ColorScheme",(function(){return s})),r.d(t,"colorScheme",(function(){return a}));var n,o,i=r("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(n||(n={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(o||(o={}));var a,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var r=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){r.currentMode===n.Auto&&r.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?o.Dark:o.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(i.setCookie)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var r=!1;switch(t){case n.Light:r=!1;break;case n.Dark:r=!0;break;case n.Auto:if(e.isSchemesAutoSwitchingSupported())r=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(r),this.isModeSavingAllowed&&Object(i.setCookie)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var r,n=(null===(r=this.schemesMap)||void 0===r?void 0:r[t])||t;e.setAttribute("scheme",n)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();a=window.colorScheme?window.colorScheme:new s,window.colorScheme=a,window.isSchemesSupported=s.isSchemesSupported.bind(null)},"aYW+":function(e,t,r){"use strict";r.r(t);var n=r("WPHA"),o=r("5Hok"),i=r("Egk5"),a=r("v+DW"),s=r("EasH"),c=r("kcIO"),l=r("4+be");class p{static downloadDistributive(e,t,r,n){var o=n.currentTarget;Object(i.cancelEvent)(n),Object(a.isButtonLocked)(o)||(Object(a.lockButton)(o),ajax.post("/al_apps.php",{act:"download_distributive",ref_id:t,hash:r,app_id:e},{onDone:e=>{Object(a.unlockButton)(o),o&&o.classList.add("button_disabled"),e.url&&(location.href=e.url),e.callback_message_box&&new MessageBox({width:800,title:e.callback_message_box.title,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(e.callback_message_box.content).show()},onFail:e=>{Object(c.showDoneBox)(e),Object(a.unlockButton)(o)}}))}static showAllPaidGames(e){Object(a.isButtonLocked)(e)||(Object(a.lockButton)(e),ajax.post("/al_apps.php",{act:"paid_downloaded_games"},{onDone:t=>{var r=document.querySelector(".DownloadedGamesList--paidGames .DownloadedGamesList__content");e&&e.remove(),r&&r.insertAdjacentHTML("beforeend",t)},onFail:()=>{Object(a.unlockButton)(e)}}))}static buyDownloadedGame(e,t,r){var n=e.currentTarget;if(!n)return!1;Object(i.cancelEvent)(e),Object(a.isButtonLocked)(n)||(Object(a.lockButton)(n),Object(s.showBox)("al_payments.php",{act:"card_payment_box",type:"game_purchase",game_id:t},{onDone:e=>{e.onSuccessCompleteOrder=()=>{p.updateDownloadedGameButton(t,n,r)},Object(a.unlockButton)(n)},onFail:()=>{Object(a.unlockButton)(n),Object(c.showDoneBox)(Object(l.getLang)("apps_fail_pay_downloaded_game"))}}))}static updateDownloadedGameButton(e,t,r){Object(a.isButtonLocked)(t)||(Object(a.lockButton)(t),ajax.post("/al_apps.php",{act:"downloaded_game_button",ref_id:r,app_id:e},{onDone:r=>{r.res?(t.outerHTML=r.html||"",window.showApp&&r.need_show_box_game&&window.showApp(event,e,1),Object(a.unlockButton)(t)):Object(a.unlockButton)(t)},onFail:()=>{Object(a.unlockButton)(t)}}))}static tryShowTooltip(e,t){if(t)return window.Apps&&window.Apps.ttCommon(e,t)}}var d=r("F+Y4");window.vkApp=o.default,window.DownloadedGames=p,window.Apps=window.Apps||d.default,window.Apps.addIcon&&window.Apps.addIcon(),n.default.defineGamesGifts();try{window.stManager.done(window.jsc("web/apps.js"))}catch(e){}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,i=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var a=Object(i.default)(o);t.default=a}.call(this,r("yLpj"),r("3UD+")(e))},bKAG:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return l})),r.d(t,"StoryType",(function(){return n})),r.d(t,"StoryEntryPoint",(function(){return o})),r.d(t,"StorySource",(function(){return i})),r.d(t,"getStoryUploadUrl",(function(){return p})),r.d(t,"uploadStoryBlobToServer",(function(){return d})),r.d(t,"saveStoryOnServer",(function(){return u}));var n,o,i,a=r("jE6c"),s=r("PU8N"),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=16;function p(e){return new Promise((function(t,r){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",c({act:"get_upload_url"},e),{onDone:t,onError:r,onFail:r})}))}function d(e,t){var r=new FormData,n=encodeURIComponent("edited_"+Object(a.irand)(0,99999)+".jpg");return r.append("file0",e,n),fetch(t,{method:"POST",body:r}).then((function(e){return e.json()}))}function u(e,t){return new Promise((function(r,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:r,onError:n,onFail:n})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(n||(n={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(o||(o={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(i||(i={}))},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,i=window.pageXOffset||n.scrollLeft||r.scrollLeft,a=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+o-a),left:Math.round(t.left+i-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",(function(){return n}))},d4g6:function(e,t,r){"use strict";r.r(t),r.d(t,"objectToQuerystring",(function(){return o})),r.d(t,"getHostName",(function(){return i})),r.d(t,"destroyOpenedApp",(function(){return a})),r.d(t,"isVKPayApp",(function(){return s})),r.d(t,"filterPostMessageOrigin",(function(){return c})),r.d(t,"isAllowedPostMessageOriginHost",(function(){return l}));r("Oyvg"),r("SRfc"),r("rGqo"),r("Btvt");var n=r("4zn2"),o=e=>Object.keys(e).reduce((t,r,n)=>[t,0===n?"?":"&",encodeURIComponent(r),"=",encodeURIComponent(e[r])].join(""),""),i=e=>{var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},a=e=>{if(cur.vkAppQueue){var t=Object.keys(cur.vkAppQueue).filter(t=>~t.indexOf(e));if(t.length>0){var r=t[0];cur.vkAppQueue[r].destroyView(),delete cur.vkAppQueue[r]}}},s=e=>n.VKPAY_APPS.includes(e);function c(e,t){var r=i(t),n=e.vkApp?e.vk_app_url:e.src,o=i(n);if(r!==o&&!l(e,r))throw Error(`Insecure method call from ${r}. Call must be from ${o}`);return!0}function l(e,t){return!!e.allowed_origin_regexp&&new RegExp(e.allowed_origin_regexp).test(t)}},dI71:function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t),r.d(t,"default",(function(){return n}))},dImZ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActionTypes",{enumerable:!0,get:function(){return o.ActionTypes}}),Object.defineProperty(t,"ActionCreators",{enumerable:!0,get:function(){return o.ActionCreators}}),Object.defineProperty(t,"parseActions",{enumerable:!0,get:function(){return i.parseActions}}),Object.defineProperty(t,"isHistory",{enumerable:!0,get:function(){return i.isHistory}}),Object.defineProperty(t,"includeAction",{enumerable:!0,get:function(){return i.includeAction}}),Object.defineProperty(t,"excludeAction",{enumerable:!0,get:function(){return i.excludeAction}}),Object.defineProperty(t,"combineFilters",{enumerable:!0,get:function(){return i.combineFilters}}),Object.defineProperty(t,"groupByActionTypes",{enumerable:!0,get:function(){return i.groupByActionTypes}}),Object.defineProperty(t,"newHistory",{enumerable:!0,get:function(){return i.newHistory}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var n,o=r("1VNw"),i=r("9O7i"),a=(n=r("FEd1"))&&n.__esModule?n:{default:n}},"dt/K":function(e,t,r){"use strict";r.r(t);var n,o=r("q1tI"),i=r("i8i4"),a=r("ZxpX"),s=r("clTp"),c=r("qihR"),l=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},d=function(e){var t=e.position,r=e.align,n=e.text,o=e.rect,i=e.marginTop,a=e.marginLeft,s=e.maxWidth,c=e.appearance,l=e.className,p=o.left,d=o.top;switch(t){case"t":p+=.5*o.width;break;case"r":p+=o.width,d+=.5*o.height;break;case"b":p+=.5*o.width,d+=o.height;break;case"l":d+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:p=Math.round(p+(a||0)),y:d=Math.round(d+(i||0)),maxWidth:s,appearance:c,className:l}}},u=function(e){function t(t){var r=e.call(this,t)||this;return r.onMouseEnter=function(){if(r.state.el){var e=r.props,t=e.text,n=e.position,o=e.align,i=e.marginTop,a=e.marginLeft,c=e.maxWidth,l=e.appearance,p=e.className,d=Object(s.default)(r.state.el);r.update({text:t,position:n,align:o,rect:d,marginTop:i,marginLeft:a,maxWidth:c,appearance:l,className:p})}},r.onMouseLeave=function(){return r.update()},r.onTransitionEnd=function(e){"visibility"===e.propertyName&&r.state.tooltip&&r.setState({tooltip:void 0})},r.state={el:null},r}return l(t,e),t.prototype.componentDidMount=function(){var e=i.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?d(p(p({},e),{rect:Object(s.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(d(e))},t.prototype.render=function(){var e=this.state.tooltip?Object(a.classNames)(this.state.tooltip.className,"Tooltip--noPointerEvents"):"",t=this.state.tooltip?p(p({},this.state.tooltip),{className:e}):null;return t&&"undefined"!=typeof window?o.createElement(o.Fragment,null,this.props.children,o.createElement(c.default,p({},t,{onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(o.Component);t.default=u},eiY0:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=r("UlUB"),o=r("59zB"),i=null,a=e=>{var t,r=window.document.querySelector("#apps"),n=window.document.querySelector(".head_nav_item"),o=n?n.getBoundingClientRect().left:0;r&&(r.style.height=window.innerHeight-98+"px"),t=o<0?n.offsetLeft:o,t+=45,e&&(e.style.left=t+"px"),i&&i.update()};class s{static init(){var e=window.document.querySelector(".WideScreenAppBack"),t=window.document.querySelector("#page_body"),r=window.document.querySelector(".apps_similarApps__list"),s=1030;if(r&&(i=new o.default(r,{stopScrollPropagation:!1,onscroll:()=>{window.tooltips&&tooltips.hideAll()},onscrollstop:e=>{var t=r.querySelectorAll(".apps_cat_row");t&&t.forEach((t,r)=>{t.removeAttribute("data-forcetodown"),t.removeAttribute("data-forcetotop");var n=(++r/2).toFixed(0);184+e.data.scrollTop>184*n&&t.setAttribute("data-forcetodown",!0)})}})),window.document.body&&t&&t.style&&t.style.width){var c=parseInt(t.style.width)+195;c>s&&(s=c),document.body.style.minWidth=s+"px"}var l=Object(n.throttle)(()=>{a(e)},100);window.addEventListener("resize",l),a(e),e.classList.remove("hidden"),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{window.removeEventListener("resize",l)})}static deferredInit(){document.addEventListener("DOMContentLoaded",s.init),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{document.removeEventListener("DOMContentLoaded",s.init)})}}},gF8j:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a})),r.d(t,"getVisibilityState",(function(){return l})),r.d(t,"getVisiblityEvent",(function(){return p}));var n=r("uQjJ"),o=r("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function a(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,r){Object(o.isMvk)()?window.addEvent(e,t,r,{passive:!0}):window.addEvent(e,t,r)}function c(e,t,r){Object(o.isMvk)()?window.removeEvent(e,t,r,{passive:!0}):window.removeEvent(e,t,r)}function l(){return document.visibilityState||document.webkitVisibilityState}function p(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(a.prototype,n.default.prototype),extend(a.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(o.isMvk)()&&this._isTopLevel()&&p()&&c(document,p(),this.onVisiblityChange),Object(o.isMvk)()&&i||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(o.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(o.isMvk)()&&this._isTopLevel()&&p()&&s(document,p(),this.onVisiblityChange),Object(o.isMvk)()&&i||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===l()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=l();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},hPa7:function(e,t,r){"use strict";r.r(t),r.d(t,"GAMES_CATALOG_MODULE",(function(){return c})),r.d(t,"SECTION_CATALOG",(function(){return l})),r.d(t,"SECTION_PROFILE",(function(){return p})),r.d(t,"SECTION_SEARCH",(function(){return d})),r.d(t,"SECTION_INSTALLED",(function(){return u})),r.d(t,"SECTION_LIST",(function(){return _})),r.d(t,"SECTION_GENRE",(function(){return h})),r.d(t,"SECTION_DOWNLOADED_GAME",(function(){return f})),r.d(t,"SECTION_ACHIEVEMENTS",(function(){return m})),r.d(t,"default",(function(){return v}));r("OG14"),r("VRzm"),r("9AAn"),r("rGqo"),r("Btvt"),r("T39b");var n=r("lXE5"),o=r("zxIV"),i=r("kHqu"),a=r("t7n3"),s=r("4+be"),c="apps",l="catalog",p="profile",d="search_page",u="apps",_="list",h="genre",f="downloaded_games",m="achievements",g=new Set([l,p,d,u,f]),b=new Set([d,p,_,m]);class v{constructor(){this.preloaded=Object.create(null),this.currentSection=null,this.headerContentEl=null,this.promoContentEl=null,this.mainContentEl=null,this.navEl=null,this.breadCrumbsEl=null,this.breadCrumbsCurrentEl=null,this.currentSection=null,this.catalogLayoutEl=null,this.inProgessPreloaded=new Map,this.preloadBlocksObserver=null,this.history=[]}init(e){this.headerContentEl=document.getElementById("games_catalog_header_content"),this.mainContentEl=document.getElementById("games_catalog_main_content"),this.navEl=document.querySelector(".GamesCatalogNav"),this.breadCrumbsEl=document.getElementById("games-catalog-bread-crumbs"),this.breadCrumbsCurrentEl=document.getElementById("games-catalog-bread-current"),this.catalogLayoutEl=document.getElementById("games_catalog"),this.promoContentEl=document.getElementById("games_catalog_promo_content"),b.has(e)||(this.preloaded[e]={header:this.headerContentEl.innerHTML,content:this.mainContentEl.innerHTML,promo:this.promoContentEl.innerHTML,title:this.breadCrumbsCurrentEl.textContent||null}),this.currentSection=e,this._initBack(),this._initNavChanged()}goToPreload(e,t,r,n){return e===this.currentSection?Promise.reject():(window.tooltips&&window.tooltips.hideAll(),new Promise((o,i)=>{this.inProgessPreloaded.has(e)?this.inProgessPreloaded.get(e).then(()=>{this._processPreload(e,o,i,t,r,n)}).catch(()=>{this._processPreload(e,o,i,t,r,n)}):this._processPreload(e,o,i,t,r,n)}))}preload(e){if(window.vk.id&&(e=(e=[...new Set(e)]).filter(e=>!this.preloaded[e]&&!this.inProgessPreloaded.has(e))).length){var t=new Promise((t,r)=>{ajax.post("/apps",{act:"preload",sections:e},{onDone:e=>{e=e||{},Object.keys(e).forEach(t=>{this.preloaded[t]=e[t],this.inProgessPreloaded.delete(t)}),t()},onFail:()=>{r()}})});e.forEach(e=>{this.inProgessPreloaded.set(e,t)})}}clear(e){this.preloaded[e]=null}destroy(){this.preloaded=Object.create(null),this.stopObserveBlocks(),this.inProgessPreloaded=new Map,this.preloadBlocksObserver=null,cur._back={},this.headerContentEl=null,this.mainContentEl=null,this.navEl=null,this.breadCrumbsEl=null,this.breadCrumbsCurrentEl=null,this.catalogLayoutEl=null,this.promoContentEl=null}startObserveBlocks(e){var t=[];this.preloadBlocksObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){var r=e.target;r.dataset.preloaded||(t.push(r.dataset.blockId),r.dataset.preloaded="1")}}),setTimeout(()=>{this.preload(t),t=[]},100)},{threshold:.01}),e.forEach(e=>{document.querySelectorAll(e).forEach(e=>{this.preloadBlocksObserver.observe(e)})})}stopObserveBlocks(){this.preloadBlocksObserver&&(this.preloadBlocksObserver.disconnect(),this.preloadBlocksObserver=null)}isPreloaded(e){return!!this.preloaded[e]}_initBack(){cur._back={onBack:e=>{var t=window.location.pathname+window.location.search+window.location.hash;if("/apps"===window.location.pathname){var r=this.history.pop()||{},n=r.section,o=r.scroll,s=r.landing;if(o=Object(a.positive)(o),!n){var c=nav.fromStr(e);(n=c.act||l)===l&&c.w&&(s=c.w)}n?window.GamesCatalog.go(n,null,!0,o,s):window.nav.go(t),this.history.length||Object(i.showBackLink)()}else window.nav.go(t)}}}_initNavChanged(){window.cur=window.cur||{},window.cur.module=c,window.cur.nav.push(e=>{e[0]!==c&&Object(i.showBackLink)(window.nav.strLoc,Object(s.getLang)("global_back"),1)})}_selectNavTab(e){var t=document.getElementById("games_tab_"+e);(t=t&&t.querySelector("a"))&&window.uiTabs.switchTab(t)}_processPreload(e,t,r,a,c,l){if(this.navEl&&document.body.contains(this.navEl))if(this.preloaded[e]){var p=Object(n.scrollGetY)();g.has(e)?(Object(o.show)(this.navEl),Object(o.hide)(this.breadCrumbsEl),this._selectNavTab(e)):(Object(o.hide)(this.navEl),Object(o.show)(this.breadCrumbsEl)),this.preloaded[e].title&&(Object(o.hide)(this.navEl),Object(o.show)(this.breadCrumbsEl),this.breadCrumbsCurrentEl.innerHTML=this.preloaded[e].title||""),this.headerContentEl.innerHTML=this.preloaded[e].header||"",this.mainContentEl.innerHTML=this.preloaded[e].content||"",this.promoContentEl.innerHTML=this.preloaded[e].promo||"",this.catalogLayoutEl.classList.remove("GamesCatalog--"+this.currentSection),this.catalogLayoutEl.classList.add("GamesCatalog--"+e),Object(n.scrollToTop)(300),Object(i.showBackLink)(nav.strLoc,Object(s.getLang)("global_back"),1),this._updateLocation(e),t([this.currentSection,e,this.preloaded[e]]),a?Object(n.scrollToY)(c,300):this.history.push({section:this.currentSection,scroll:p,landing:l}),this.currentSection=e}else r(),window.nav.go("apps?act="+e);else{r();var d=l?"&w="+l:"";window.nav.go("apps?act="+e+d)}}_updateLocation(e){window.nav.objLoc.act=e,window.nav.setLoc(nav.objLoc)}}},jYEY:function(e,t,r){var n;!function(o){"use strict";function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e,t,r,n,o,a){return i((s=i(i(t,e),i(n,a)))<<(c=o)|s>>>32-c,r);var s,c}function s(e,t,r,n,o,i,s){return a(t&r|~t&n,e,t,o,i,s)}function c(e,t,r,n,o,i,s){return a(t&n|r&~n,e,t,o,i,s)}function l(e,t,r,n,o,i,s){return a(t^r^n,e,t,o,i,s)}function p(e,t,r,n,o,i,s){return a(r^(t|~n),e,t,o,i,s)}function d(e,t){var r,n,o,a,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var u=1732584193,_=-271733879,h=-1732584194,f=271733878;for(r=0;r<e.length;r+=16)n=u,o=_,a=h,d=f,u=s(u,_,h,f,e[r],7,-680876936),f=s(f,u,_,h,e[r+1],12,-389564586),h=s(h,f,u,_,e[r+2],17,606105819),_=s(_,h,f,u,e[r+3],22,-1044525330),u=s(u,_,h,f,e[r+4],7,-176418897),f=s(f,u,_,h,e[r+5],12,1200080426),h=s(h,f,u,_,e[r+6],17,-1473231341),_=s(_,h,f,u,e[r+7],22,-45705983),u=s(u,_,h,f,e[r+8],7,1770035416),f=s(f,u,_,h,e[r+9],12,-1958414417),h=s(h,f,u,_,e[r+10],17,-42063),_=s(_,h,f,u,e[r+11],22,-1990404162),u=s(u,_,h,f,e[r+12],7,1804603682),f=s(f,u,_,h,e[r+13],12,-40341101),h=s(h,f,u,_,e[r+14],17,-1502002290),u=c(u,_=s(_,h,f,u,e[r+15],22,1236535329),h,f,e[r+1],5,-165796510),f=c(f,u,_,h,e[r+6],9,-1069501632),h=c(h,f,u,_,e[r+11],14,643717713),_=c(_,h,f,u,e[r],20,-373897302),u=c(u,_,h,f,e[r+5],5,-701558691),f=c(f,u,_,h,e[r+10],9,38016083),h=c(h,f,u,_,e[r+15],14,-660478335),_=c(_,h,f,u,e[r+4],20,-405537848),u=c(u,_,h,f,e[r+9],5,568446438),f=c(f,u,_,h,e[r+14],9,-1019803690),h=c(h,f,u,_,e[r+3],14,-187363961),_=c(_,h,f,u,e[r+8],20,1163531501),u=c(u,_,h,f,e[r+13],5,-1444681467),f=c(f,u,_,h,e[r+2],9,-51403784),h=c(h,f,u,_,e[r+7],14,1735328473),u=l(u,_=c(_,h,f,u,e[r+12],20,-1926607734),h,f,e[r+5],4,-378558),f=l(f,u,_,h,e[r+8],11,-2022574463),h=l(h,f,u,_,e[r+11],16,1839030562),_=l(_,h,f,u,e[r+14],23,-35309556),u=l(u,_,h,f,e[r+1],4,-1530992060),f=l(f,u,_,h,e[r+4],11,1272893353),h=l(h,f,u,_,e[r+7],16,-155497632),_=l(_,h,f,u,e[r+10],23,-1094730640),u=l(u,_,h,f,e[r+13],4,681279174),f=l(f,u,_,h,e[r],11,-358537222),h=l(h,f,u,_,e[r+3],16,-722521979),_=l(_,h,f,u,e[r+6],23,76029189),u=l(u,_,h,f,e[r+9],4,-640364487),f=l(f,u,_,h,e[r+12],11,-421815835),h=l(h,f,u,_,e[r+15],16,530742520),u=p(u,_=l(_,h,f,u,e[r+2],23,-995338651),h,f,e[r],6,-198630844),f=p(f,u,_,h,e[r+7],10,1126891415),h=p(h,f,u,_,e[r+14],15,-1416354905),_=p(_,h,f,u,e[r+5],21,-57434055),u=p(u,_,h,f,e[r+12],6,1700485571),f=p(f,u,_,h,e[r+3],10,-1894986606),h=p(h,f,u,_,e[r+10],15,-1051523),_=p(_,h,f,u,e[r+1],21,-2054922799),u=p(u,_,h,f,e[r+8],6,1873313359),f=p(f,u,_,h,e[r+15],10,-30611744),h=p(h,f,u,_,e[r+6],15,-1560198380),_=p(_,h,f,u,e[r+13],21,1309151649),u=p(u,_,h,f,e[r+4],6,-145523070),f=p(f,u,_,h,e[r+11],10,-1120210379),h=p(h,f,u,_,e[r+2],15,718787259),_=p(_,h,f,u,e[r+9],21,-343485551),u=i(u,n),_=i(_,o),h=i(h,a),f=i(f,d);return[u,_,h,f]}function u(e){var t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function _(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function h(e){var t,r,n="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function f(e){return unescape(encodeURIComponent(e))}function m(e){return function(e){return u(d(_(e),8*e.length))}(f(e))}function g(e,t){return function(e,t){var r,n,o=_(e),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=d(o,8*e.length)),r=0;r<16;r+=1)i[r]=909522486^o[r],a[r]=1549556828^o[r];return n=d(i.concat(_(t)),512+8*t.length),u(d(a.concat(n),640))}(f(e),f(t))}function b(e,t,r){return t?r?g(t,e):h(g(t,e)):r?m(e):h(m(e))}void 0===(n=function(){return b}.call(t,r,t,e))||(e.exports=n)}()},lMzL:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("91GP"),r("rGqo"),r("Btvt"),r("pIFo"),r("OG14");var n=r("d4g6"),o=r("lNyc"),i=r("4zn2"),a=r("9kLB"),s=r("xo6n"),c=r("PU8N"),l=r("aJgW");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d=class{constructor(e,t,r,n,i){this.sendIframeMessage=(e,t)=>{var r=document.getElementById(this.containerId);r&&Object(o.sendMessage)({type:e,data:p({},t)},r)},this.appId=t.aid,this.src=t.src,this.pic=n,this.params=p({},r),this.containerId=e,this.vkApp=i,this.apiHost=t.vk_app_api_host,this.isDirectGame=t.is_direct_game,this.isVKPayApp=t.is_vkpay_app,this.isTextliveApp=t.is_textlive_app,this.isMiniAppWidget=t.is_mini_app_widget,this.handler=this.handler.bind(this),this.onResize=this.onResize.bind(this),this.i=0,this.eventQueue=[]}init(){this.sessionLogger=new s.default(this.appId),cur.destroy.unshift(()=>{this.destroyView()}),window.addEventListener("visibilitychange",()=>{document.hidden?this.sessionLogger&&this.sessionLogger.idle():this.sessionLogger&&this.sessionLogger.unIdle()}),window.addEventListener("message",this.handler),window.addEventListener("beforeunload",()=>{this.destroyView()}),this.getWindowSize(),cur.VKApp=cur.VKApp||{},cur.VKApp.vkMiniAppsHistoryLength=window.history.length,Object(c.isMvk)()?(l.colorScheme.subscribe(()=>{var e=l.colorScheme.isDarkScheme()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.BRIGHT_LIGHT;this.sendUpdateEvent(e)}),this.onResize(),window.addEventListener("resize",this.onResize),this.checkDevice()):(window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&this.sendUpdateEvent(i.CLIENT_SCHEME.SPACE_GRAY)),window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&this.sendUpdateEvent(i.CLIENT_SCHEME.BRIGHT_LIGHT)))}initOpenExternalApp(){var e=new URLSearchParams(location.search);if(cur.zNavInfo&&cur.zNavInfo.info.w&&e.has("w")){var t=/app[0-9]+/.exec(cur.zNavInfo.info.w);if(t){var r=parseInt(t[0].replace("app",""),10);Object(o.chooseAction)({eventData:{app_id:r},params:{app_id:r,request_id:"vkopenexternalapp"},handler:a.CONNECT_EVENTS.OPEN_APP},this)}}}destroyView(){window.removeEventListener("message",this.handler),this.sessionLogger&&this.sessionLogger.stop()}sendUpdateEvent(e){Object(o.chooseAction)({handler:a.CONNECT_EVENTS.UPDATE_CONFIG,params:{viewport_width:this.currentWidth,viewport_height:this.currentHeight,scheme:e||this.getColorScheme(),api_host:this.apiHost}},this)}onResize(){if(!this.isDirectGame&&!(Object(c.isMvk)()&&cur.share||this.currentHeight===window.innerHeight)){this.getWindowSize();var e=document.querySelector(".app_container"),t=e&&e.childNodes[0];t&&(t.style.height=this.currentHeight+"px",t.style.minHeight=this.currentHeight+"px",this.sendUpdateEvent())}}getWindowSize(){this.currentHeight=window.innerHeight,this.currentWidth=window.innerWidth}getColorScheme(){if(Object(c.isMvk)())return l.colorScheme.isDarkScheme()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.BRIGHT_LIGHT;var e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=window.matchMedia("(prefers-color-scheme: light)").matches,r=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!e&&!t&&!r;return e&&Object(c.isMvk)()?i.CLIENT_SCHEME.SPACE_GRAY:t||r||n?i.CLIENT_SCHEME.BRIGHT_LIGHT:void 0}handler(e){var t=Object(n.getHostName)(e.origin)===Object(n.getHostName)(this.src)||Object(n.isAllowedPostMessageOriginHost)(this.vkApp.options,Object(n.getHostName)(e.origin));if(e.data&&"vk-connect"===e.data.type&&t){var r=this;if(e.data.handler===a.CONNECT_EVENTS.INIT&&(this.sessionLogger&&this.sessionLogger.start(),r&&r.sendUpdateEvent(),!Object(c.isMvk)())){var i=document.getElementById(this.containerId);i&&Object(o.sendMessage)({type:a.CONNECT_EVENTS.SETTINGS,frameId:this.containerId},i)}if(cur.vkAppQueue&&Object.keys(cur.vkAppQueue).length>1){var s=e.data.frameId||e.data.webFrameId||this.containerId;if(!s)throw new Error("There is no specified id for container");s===this.containerId&&(r=cur.vkAppQueue[s],Object(o.chooseAction)(p({},e.data,{pic:this.pic}),r))}else Object(c.isMvk)()?cur.app.hideVkAppPreload():this.initOpenExternalApp(),Object(o.chooseAction)(p({},e.data,{pic:this.pic}),r)}else if(e.data&&e.data.type===a.CONNECT_EVENTS.CLOSE&&Object(c.isMvk)()){var l=ge(this.containerId);l&&Object(o.sendMessage)({type:e.data.name,data:e.data.eventData},l)}}checkDevice(){this.isIOS()&&this.checkIOSXDevice()&&document.body.classList.add("vk_ios_x_device")}isIOS(){return document.body.classList.contains("vk_ios_yes")}checkIOSXDevice(){var e=window.screen.height;return e>=812&&e<900}actualizeEventQueue(){var e=Date.now()-3e4,t=this.eventQueue.findIndex(t=>t.timeInMs>=e);-1===t?this.eventQueue=[]:this.eventQueue.splice(0,t)}isRequestsLimitReached(){return this.actualizeEventQueue(),15===this.eventQueue.length}};function u(e,t,r,n,o){if(cur.vkAppQueue||(cur.vkAppQueue={}),!cur.vkAppQueue[e]){var i=new d(e,t,r,n,o);i.init(),cur.vkAppQueue[e]=i}}},lNyc:function(e,t,r){"use strict";r.r(t),r.d(t,"sendMessage",(function(){return $e})),r.d(t,"chooseAction",(function(){return Ze}));r("91GP"),r("pIFo"),r("KKXr");var n=new class{constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}push(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter(e=>!~e.appNode.id.indexOf("container_layer")))}pop(e){var t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}},o=r("4zn2");var i=class{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.ERROR_TYPES.CLIENT;this.data=t||{},this.method=e,this.type=r}_errorStrucuture(e,t){var r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===o.ERROR_TYPES.API?r.data.error_data.error_msg=t:r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(o.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(o.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error");switch(this.data.code){case o.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(o.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case o.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(o.ERROR_CODES.CONNECTION_LOST,this.data.reason||"Connection lost");case o.ERROR_CODES.USER_DENIED:return this._errorStrucuture(o.ERROR_CODES.USER_DENIED,this.data.reason||"User denied");case o.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(o.ERROR_CODES.INVALID_PARAMS,this.data.reason||"Invalid params");case o.ERROR_CODES.CUSTOM:return this._errorStrucuture(o.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case o.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(o.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");default:return this._errorStrucuture(this.data.code?this.data.code:o.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error")}}},a=r("PU8N");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=class{constructor(e,t){this.props=s({},e),t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.renderModal(),this._destroyed=!1}init(){this.appNode&&this.appNode.appendChild(this.modal)}show(){Object(a.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout(()=>this.modal.classList.add("show"),300),this.initMvkCloseActions()}initMvkCloseActions(){if(Object(a.isMvk)()){if(!window.DirectGames||!cur.app.isDirectGame)return;window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)})}}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){this._destroyed||(Object(a.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}onAction(e){e(),this.destroy()}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add("vk_app_modal_btn--"+e.type),e.disabled&&(t.disabled=e.disabled),t.innerText=e.title,t.addEventListener("click",()=>this.onAction(e.action)),t}_renderBtns(e){var t=e.getElementsByClassName("vk_app_modal_btns")[0];t&&(this.props.buttons.map(e=>{t.appendChild(this._renderBtn(e))}),1===this.props.buttons.length&&t.classList.add("vk_app_modal_btns--single-btn"))}_renderCloseBtn(e){var t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),t.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',t.addEventListener("click",()=>this.onAction(this.props.cancelAction)),e.children[0].appendChild(t)}_renderOuter(){var e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>0===t?getLang("vkapps_scope_"+e):getLang("vkapps_scope_"+e).toLowerCase()).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){var e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}renderModal(){var e=this.props.picClass?this.props.picClass:"",t=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.props.svgIcon?this.props.svgIcon:`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this.props.text?`<p class="vk_app_modal_container__text">${this.props.text}</p>`:""}\n      `;this.props.scopes&&(t+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),t+='\n          </div>\n          <div class="vk_app_modal_btns"></div>\n      </div>',this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal)}},l=r("jE6c");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.params=p({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}get successDescriptor(){return this.params.handlerName+"Result"}get errorDescriptor(){return this.params.handlerName+"Failed"}getEventHash(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[o.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]+"_hash"]}getEventHashes(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[o.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]+"_hashes"]}getEventName(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return o.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}checkParams(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.param,a=n.type,s=n.isRequired,c=n.extraChecks;if(!e.hasOwnProperty(i)&&s)return this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${i}"`}),!1;if(e.hasOwnProperty(i)&&typeof e[i]!==a)return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:`Param "${i}" should be ${a}`},this.callback),!1;if(e.hasOwnProperty(i)&&c&&c.length>0)for(var l=0;l<c.length;l++)if(!c[l].check(e[i]))return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:c[l].error(i)},this.callback),!1}return!0}actionHandler(e){return this.callApi?ajax.post("apps.php",p({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:o.ERROR_CODES.USER_DENIED},null),n.pop(this.modal)}allowUIAction(e){this.actionHandler(e),n.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new c(p({},this.params.modal,{},e)),n.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach((e,t)=>{"deny"===e.type?this.params.modal.buttons[t].action=this.params.modal.cancelAction:this.params.modal.buttons[t].action=this.params.modal.allowAction})}setData(e,t){e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t}handleResponse(e,t,r,n){try{var o=JSON.parse(e);o.hasOwnProperty("error")?this.errorHandler(o.error):r(o,t)}catch(e){n?n(e):this.errorHandler(e)}}handler(e,t,r){this.setData(e,t),this.callback=r,this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}successHandler(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&t(),Object(l.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),Object(a.isMvk)()&&cur.app.frame.focus()}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);var n=new i(this.errorDescriptor,e,r);t&&t(),this.callback(n.selectErrorType()),Object(a.isMvk)()&&cur.app.frame.focus()}};var u=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppInit"}handler(e,t,r){this.setData(e,t),this.callback=r,this.successHandler({result:!0})}};r("HEwt");function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var h=class{constructor(e,t){this.props=_({},e),t&&(this.callback=t),this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}show(){setTimeout(()=>this.modal.classList.add("show"),300)}destroy(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()}onAction(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()}onCancelAction(e){e&&e(),this.destroy()}onAllow(){var e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map(t=>{var r=parseInt(t.id.replace("scope_",""),10);if(!this.props.scopes[r])throw new Error("There is no such scope");e.push(this.props.scopes[r])}),this.onAction(e.join(","))}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add("vk_app_modal_btn--"+e.type),t.innerText=e.title,"success"===e.type?t.addEventListener("click",()=>this.onAllow()):t.addEventListener("click",()=>this.onCancelAction(e.action)),t}_renderBtns(e){this.props.buttons.map(t=>{e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(this._renderBtn(t))})}_renderCloseBtn(e){var t=document.createElement("div");t.setAttribute("aria-label","Close"),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.classList.add("box_x_button"),t.addEventListener("click",()=>this.onCancelAction(this.props.cancelAction)),e.querySelector(".box_title_wrap").appendChild(t)}_renderOuter(){return document.querySelector(".vk_app_modal_outer")}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>`\n    <div class="scope_row">\n      <input class="blind_label" type="checkbox" id="scope_${t}" checked="">\n      <label for="scope_${t}">${getLang("vkapps_scope_"+e)}</label>\n    </div>\n    `).join("\n")}renderModal(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=`\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">${this.props.title}</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      ${this.props.text?`<p>${this.props.text}</p>`:""}\n      ${this.props.scopes&&`<div class="vk_app_modal_scopes">${this._renderScopes(this.props.scopes)}</div>`}\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n`,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)}};function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var m=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new c(f({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new h(f({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),n.push(this.modal)}takeAction(e){ajax.post("apps.php",f({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>(this.errorHandler(e),!0)})}checkToken(e){e.access_token?this.successHandler(f({},e)):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=f({},e),ajax.post("apps.php",f({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),n.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=`${this.params.modal.title} ${e.group.name}`),this.launchUI(f({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"!=typeof e.app_id||e.app_id<0)this.errorHandler({code:2,reason:'Param "app_id" should be a positive number'},r);else if(e.app_id===parseInt(this.app.appId,10))if(e.group_id)if("number"!=typeof e.group_id||e.group_id<0)this.errorHandler({code:2,reason:'Param "group_id" should be a positive number'},r);else{var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:2,reason:'Missing required param "group_id"'},r);else this.errorHandler({code:2,reason:'Wrong param "app_id"'},r);else this.errorHandler({code:2,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:2,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:2,reason:'Missing required param "scope"'},r)}actionHandler(e){this.loadIntroData(e)}};function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var b=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new c(g({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new h(g({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),n.push(this.modal)}takeAction(e){ajax.post("apps.php",g({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>{this.errorHandler(e)}})}checkToken(e){e.access_token?this.successHandler(g({},e)):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=g({},e),ajax.post("apps.php",g({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),n.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=`${this.params.modal.title} ${e.group.name}`),this.launchUI(g({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR},r)}}actionHandler(e){this.loadIntroData(e)}};function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var E=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppAddToCommunity",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community"),text:getLang("apps_connect_modal_messages_request_add_to_community_text")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.addToCommunitySuccessHandler=this.addToCommunitySuccessHandler.bind(this),this.addToCommunityErrorHandler=this.addToCommunityErrorHandler.bind(this),this.unsetCurHandlers=this.unsetCurHandlers.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.checkAppAdd=this.checkAppAdd.bind(this)}takeAction(){ajax.post("apps.php",v({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{this.handleResponse(e,{},this.checkAppAdd)},onFail:e=>(this.errorHandler(e),!0)})}checkAppAdd(e){parseInt(e,10)&&this.successHandler({result:!0})}loadIntroData(e){this.request=v({},e);var t=Object(a.isMvk)()?v({act:"vkapps_add_to_community_box",hash:cur.app.options.hash,app_id:this.app.appId},this.request):v({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request);Object(a.isMvk)()?window.ajax.post("apps.php",t,{onDone:(e,t)=>{cur.app.showAppsBox(e,t)},onFail:e=>(this.errorHandler(e),!0)}):ajax.post("apps.php",t,{onDone:e=>{this.handleResponse(e,{},this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.loadIntroData(e),n.pop(this.modal)}checkIntroData(e){e.items.length>0?showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}}):0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),()=>{this.noCommunitiesBox.hide()}).show())}unsetCurHandlers(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,Object(a.isMvk)()&&VKApps.cancelSettings()}addToCommunitySuccessHandler(e){this.successHandler(e),this.unsetCurHandlers()}addToCommunityErrorHandler(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()}handler(e,t,r){this.setData(e,t),this.callback=r,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,this.launchUI(e)}actionHandler(e){this.loadIntroData(e)}};var w=r("c8JK");var O=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetUserInfo",this.callApi=!0,this.useUI=!1}},y=(r("OG14"),r("9kLB"));var C=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppSetLocation"}actionHandler(e){e.hasOwnProperty("location")?"string"==typeof e.location?(Object(a.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):cur.app.funcs.setLocation(e.location),Ze({handler:y.CONNECT_EVENTS.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({result:!0})):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})}};var S=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetClientVersion"}actionHandler(e){var t=o.PLATFORM.WEB;Object(a.isMvk)()&&(t=o.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},this.callback)}};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var P=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetPhoneNumber",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=A({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}};function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var R=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetEmail",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=T({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}};var D=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetGeodata",this.callApi=!0,this.useUI=!1,this.timeoutFails=0,this.geodataSuccess=this.geodataSuccess.bind(this),this.geodataFail=this.geodataFail.bind(this)}get successDescriptor(){return"VKWebAppGeodataResult"}get errorDescriptor(){return"VKWebAppGeodataFailed"}geodataSuccess(e){var t=e.coords.longitude,r=e.coords.latitude;this.successHandler({available:!0,lat:r,long:t},this.callback)}geodataFail(e){switch(e.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail):this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Geolocation timeout error"},this.callback);break;case 2:this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User didn't allowed"},this.callback)}}actionHandler(e){if(!this.callApi)return{};navigator.geolocation.getCurrentPosition(e=>this.geodataSuccess(e),e=>this.geodataFail(e),{maximumAge:15e5,timeout:2e3})}};var k=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenQR"}actionHandler(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}};r("VRzm"),r("Btvt");var M=class extends d{constructor(e){super(e);var t=getLang("apps_connect_modal_messages_send_install_push");this.params.handlerName="VKWebAppSendToClient",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.useUI=!0,this.callApi=!0}actionHandler(e){return new Promise((e,t)=>{ajax.post("apps.php",{act:"send_install_request",al:1,hash:window.cur.app.options.hash,aid:this.app.appId,cid:0,ref:0},{onDone:t=>{e(t)},onFail:e=>{t(e)}})}).then(()=>{this.successHandler({result:!0})}).catch(()=>{this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR})})}};var I=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppSetViewSettings"}actionHandler(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}};var L=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppSetTitle"}handler(e,t,r){this.setData(e,t),this.callback=r,this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)}};function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var N=class extends d{constructor(e){super(e);var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");this.params.handlerName="VKWebAppGetAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0,this.onEditClick=this.onEditClick.bind(this)}get successDescriptor(){return"VKWebAppAccessTokenReceived"}get errorDescriptor(){return"VKWebAppAccessTokenFailed"}scopeList(e){var t=this.app.params.whitelist_scopes?e.filter(e=>~this.app.params.whitelist_scopes.indexOf(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new c(x({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick}));var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new h(x({},this.params.modal,{},e,{text:t,scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),n.push(this.modal)}actionHandler(e){return this.callApi?ajax.post("apps.php",x({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:e=>{if(e.hasOwnProperty("error"))this.errorHandler(e.error);else try{var t=JSON.parse(e);t.access_token?this.successHandler(x({},t)):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):{}}loadIntroData(e){this.request=x({},e),this.app.appId==e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,scope:e.scope},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){console.log(e),this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Wrong app id"})}checkIntroData(e,t){if(e.status){var r={};e.access_token&&(r.access_token=e.access_token),r.scope=this.params.scope.join(","),this.successHandler(r)}else this.launchUI(t)}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"==typeof e.app_id){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},r);else this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},r)}},B=(r("rGqo"),r("d4g6")),j=r("W9Tc");function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var H=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppCallAPIMethod",this.params.v="5.85",this.params.method=null,this.resolveResponse=this.resolveResponse.bind(this)}actionHandler(e){var t=U({},e.params);e.request_id&&(t.request_id=e.request_id),function(e,t,r,n,i){if(r||(r={}),delete r.callback,t)if(r.hasOwnProperty("access_token")){Object.keys(r).forEach(e=>{"object"==typeof r[e]&&(r[e]=JSON.stringify(r[e]))});var a=W({api_id:e.appId,method:t,format:"json",v:o.API_VERSION},r),s=Object(B.objectToQuerystring)(a),c=new XMLHttpRequest,l=Object(j.partConfigEnabled)("mini_apps_web_call_api_form_data")&&6911063!==parseInt(e.appId,10);l?(c.open("POST",`https://${e.apiHost}/method/${t}`),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):c.open("POST",`https://${e.apiHost}/method/${t}${s}`),c.onload=()=>{if(200==c.status)try{var e=JSON.parse(c.response);r.request_id&&(e.request_id=r.request_id),e.hasOwnProperty("error")?i({reason:e.error}):n(e)}catch(e){i({code:1,reason:e.message})}else i({reason:c.statusText})},c.onerror=()=>{i({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.NETWORK_ERROR})},l?c.send(s):c.send()}else i({code:o.ERROR_CODES.MISSING_PARAM,reason:"Missing required param access_token"});else i({code:o.ERROR_CODES.MISSING_PARAM,reason:"Missing required param method"})}({appId:this.app.appId,apiHost:this.app.apiHost},e.method,t,this.successHandler,this.errorHandler)}resolveResponse(e){e&&(e.hasOwnProperty("error")?this.errorHandler(e.error):this.successHandler(e))}handler(e,t,r){this.callback=r,this.setData(e,t),e.params?e.params.v||e.params.version?isNaN(parseInt(e.params.v,10))&&isNaN(parseInt(e.params.version,10))?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "v" should be a number'},r):(e.params.hasOwnProperty("v")?this.params.v=e.params.v:e.params.hasOwnProperty("version")&&(this.params.v=e.params.version),this.actionHandler(e)):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "v"'},r):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:"Missing required params"},r)}};function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var F=class extends d{constructor(e){super(e),this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this)}takeAction(){ajax.post("apps.php",K({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{e.hasOwnProperty("error")?this.errorHandler(e.error):parseInt(e,10)?this.successHandler({result:!0}):this.errorHandler()},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=K({},e),ajax.post("apps.php",K({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t),n=r.group.is_closed;this.checkIntroData(K({isGroupMember:r.is_group_member,canJoin:n!==o.GROUP_STATUS.PRIVATE,can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),n.pop(this.modal)}checkIntroData(e,t){this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.title=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions()}handler(e,t,r){this.setData(e,t),this.callback=r,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)}actionHandler(e){this.loadIntroData(e)}};function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var G=class extends F{constructor(e){super(e),this.params.handlerName="VKWebAppJoinGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.canJoin?e.isGroupMember?this.successHandler({result:!0}):(this.modal=new c(V({},this.params.modal)),n.push(this.modal)):this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"User can not join this group"})}};function q(){return(q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var z=class extends F{constructor(e){super(e),this.params.handlerName="VKWebAppLeaveGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_leave"),type:"success"}],text:getLang("apps_connect_modal_messages_leave_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.isGroupMember?(this.modal=new c(q({},this.params.modal)),n.push(this.modal)):this.successHandler({result:!0})}};function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var X=class extends F{constructor(e){super(e),this.params.handlerName="VKWebAppAllowMessagesFromGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")}}checkIntroData(e,t){super.checkIntroData(e,t),e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.text=this.params.modal.text.replace("{group_name}",e.name),this.modal=new c(Y({},this.params.modal)),n.push(this.modal))}};var $=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppDenyNotifications",this.callApi=!0,this.useUI=!1}};function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var J=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenPayForm",this.checkTransaction=this.checkTransaction.bind(this),this.destroyVkPayContainer=this.destroyVkPayContainer.bind(this)}actionHandler(e){this.app.isMiniAppWidget?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):window.cur&&window.cur.app&&window.cur.app.isDirectGame?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):this.launchVkPayContainer(e):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}openPayApp(e){var t=Z({},e.params);t.action=e.action,cur.app.funcs.openExternalApp("vkpay",t,this.errorHandler)}checkTransaction(e){var t=!Object(a.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===o.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler(Z({},e.data.params),this.callback):this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:Z({},e.data.params,{error_msg:"VK Pay payment failed"})}),Object(a.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User denied"})}destroyVkPayContainer(){window.removeEventListener("message",this.checkTransaction)}launchVkPayContainer(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)}};function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var ee=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppAllowNotifications",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},this.callApi=!0,this.useUI=!0}takeAction(){var e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",Q({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:e=>{this.handleResponse(e,{},e=>this.successHandler(e))},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=Q({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(Q({can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),n.pop(this.modal)}checkIntroData(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.picClass="MiniAppModalContainer__pic--small",this.params.modal.app_name=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new c(Q({},this.params.modal)),n.push(this.modal))}handler(e,t,r){this.setData(e,t),this.callback=r,cur.app.isDirectGame?this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:"This method allowed for mini apps only"}):this.loadIntroData(e)}};function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var re=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenApp"}actionHandler(e){if(this.app.appId!==e.app_id||Object(B.isVKPayApp)(parseInt(this.app.appId,10))){var t={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(t.location=e.location),this.openApp=te({},t),ajax.post("apps.php",te({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},t),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("original_url")?(this.successHandler({result:!0}),Object(a.isMvk)()?cur.app.openAppInLayer(r.original_url,!0):(cur.app.openAppInLayer(r.original_url,()=>Object(B.destroyOpenedApp)(e.app_id)),cur.miniAppOpener||(cur.miniAppOpener=this.app))):r.hasOwnProperty("error")&&this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}else this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Same app id as origin"})}handler(e,t,r){this.setData(e,t),this.callback=r,this.app.isMiniAppWidget?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},r):e.app_id?"number"==typeof e.app_id?e.hasOwnProperty("location")&&"string"!=typeof e.location?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'"location" param should be a string'},r):this.actionHandler(e):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "app_id" should be a number'},r):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r)}createUrl(e){return`app${e.app_id}${e.hasOwnProperty("location")?"#"+e.location:""}`}};var ne=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShare",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}actionHandler(e){e.link&&"string"!=typeof e.link?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "link" should be a string'},this.callback):Object(a.isMvk)()?(this.shareEmitters(),e.link?cur.app.funcs.shareBox(e.link,"","","",this.successHandler,this.errorHandler):cur.app.funcs.shareBox("https://vk.com/app"+cur.aid,cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc,this.successHandler,this.errorHandler)):e.link?cur.app.funcs.showWallPostBox({message:e.link,attachments:e.link},this.successHandler,this.errorHandler):(this.shareEmitters(),this.share(this.appId,this.userId))}share(e,t){showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t},{onFail:()=>{this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Unknown error",error_type:"client_error"},this.callback)},params:{onHide:()=>{setTimeout(()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User denied",error_type:"client_error"},this.callback)},1e3)}}})}cleanEmitters(){cur.app.vkMiniAppShareSuccess=null,cur.app.vkMiniAppShareFail=null}shareEmitters(){cur.app.vkMiniAppShareSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},cur.app.vkMiniAppShareFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:o.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}};var oe=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowNewPostBox",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}checkFields(e){return this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"author_id",type:"number",isRequired:!0},{param:"textlive_id",type:"number",isRequired:!1,extraChecks:[{check:()=>o.TEXTLIVE_APPS.includes(cur.app.params.api_id),error:()=>o.ERROR_REASONS.UNKNOWN_ERROR}]}])}actionHandler(e){Object(a.isMvk)()?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM}):this.checkFields(e)&&this.open(e)}open(e){var t=e.textlive_id,r=e.author_id,n=e.owner_id;this.initEmitters(),cur.getWkviewOpts=()=>({textlive_id:t,author_id:r,owner_id:n}),showWiki({w:"postbox"},null,null,{})}cleanEmitters(){cur.app.vkMiniAppNewPostSuccess=null,cur.app.vkMiniAppNewPostFail=null}initEmitters(){window.cur.app.vkMiniAppNewPostSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},window.cur.app.vkMiniAppNewPostFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:o.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}};var ie=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowWallPostBox",this.externalSuccessHandler=this.externalSuccessHandler.bind(this),this.externalErrorHandler=this.externalErrorHandler.bind(this),this.setExternalHandlers()}setExternalHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler}unsetCurHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,Object(a.isMvk)()&&VKApps.cancelSettings()}externalSuccessHandler(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()}externalErrorHandler(){this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()}actionHandler(e){e.hasOwnProperty("message")?e.message&&"string"!=typeof e.message?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback):(e.message=e.message.replace(/(\r)/g,""),cur.app.funcs.showWallPostBox(e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'})}};var ae=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppScroll",this.useUI=!1,this.DEFAULT_SPEED=100,this.onScrollEnd=this.onScrollEnd.bind(this)}onScrollEnd(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})}actionHandler(e){if(Object(a.isMvk)())this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);else if(e.hasOwnProperty("top"))if("number"==typeof e.top)if(e.hasOwnProperty("speed")&&"number"!=typeof e.speed)this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'"speed" param should be a number'});else{var t=e.hasOwnProperty("speed")?e.speed:this.DEFAULT_SPEED;if(this.params.data={top:e.top},~this.app.containerId.indexOf("layer")){var r=ge("wk_layer_wrap");r?r.scrollTop=e.top:this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR})}else this.scroll=new class{constructor(e,t,r){this.desiredOffset=e,this.speed=t,this.onComplete=r}go(){window.Apps.scrollToY(this.desiredOffset,this.speed,void 0,void 0,this.onComplete)}}(e.top,t,this.onScrollEnd.bind(this)),this.scroll.go()}else this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "top" should be a number'});else this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "top"'})}};function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var ce=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppResizeWindow",this.useUI=!1}setWidth(e){var t=165;e&&this.app.vkApp&&(e=Math.min(Math.max(e,607),1e3),this.app.vkApp.options.layout_width&&(t=this.app.vkApp.options.layout_width-e),this.app.vkApp.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,607)+t}),cur.app.frame.style.width=cur.app.cont.style.width=e+"px",this.result.width=e)}setHeight(e){var t=500;if(e){this.app.isTextliveApp&&(t=0),e=Math.min(Math.max(e,t),8050),this.app.vkApp.inlineApp&&e>this.app.vkApp.options.heightMax&&!this.app.vkApp.params.is_vkpay_service&&(e=this.app.vkApp.options.heightMax);var r=e+"px";cur.app.frame.style.height=r,this.app.vkApp.options.boxed||(cur.app.cont.style.height=r),this.app.vkApp.options.layer&&WkView.onResize(),this.app.vkApp.options.onResize&&this.app.vkApp.options.onResize(),this.result.height=e}}actionHandler(e){Object(a.isMvk)()?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):e.hasOwnProperty("width")&&"number"!=typeof e.width?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "width" should be a number'}):e.hasOwnProperty("height")&&"number"!=typeof e.height?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "height" should be a number'}):e.hasOwnProperty("height")||e.hasOwnProperty("width")?(this.result={},e.hasOwnProperty("width")&&this.setWidth(e.width),e.hasOwnProperty("height")&&this.setHeight(e.height),this.successHandler({result:se({},this.result)})):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:"At least one parameter is required"})}};function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var pe=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppSendPayload",this.callApi=!0,this.useUI=!1}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},r);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},r)}this.actionHandler(e)}else this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},r);else this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},r)}actionHandler(e){return ajax.post("apps.php",le({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("error")?this.errorHandler(r.error,this.callback,o.ERROR_TYPES.API):r.status?this.successHandler(le({},r,{scope:e.scope})):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}},de=(r("SRfc"),/^https:\/\/(?:(?:.*)\.)*vk.com(\/@[a-z0-9_-]+)$/im);var ue=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticle",this.callApi=!1,this.useUI=!0}launchUI(e){var t=e.url,r=void 0===t?"":t,n=r.match(de);if(n&&n[1]){var i=n[1];if(Object(a.isMvk)()){var s=window.location.pathname.substr(1);window.nav.go(`${i}?from=${s}`)}else window.show(boxLoader),window.show(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(i,{onEducationCloseBtnClick:e=>this.successReadHandler(e),onFailCallBack:()=>{window.hide(boxLoader),window.hide(boxLayerWrap),this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:"ServerError: Can't open article."})}},()=>{window.hide(boxLoader),window.hide(boxLayerWrap),window.nav.go(i),this.successHandler({result:!0})})}else this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:"Error: incorrect url: "+r})}successReadHandler(e){this.callback({type:"VKWebAppArticleClosed",data:e},this.params.handlerName),Object(a.isMvk)()&&cur.app.frame.focus()}};function _e(){return(_e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var he=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppUpdateConfig"}get successDescriptor(){return""+this.params.handlerName}get errorDescriptor(){return this.params.handlerName+"Failed"}actionHandler(e){var t={api_host:e.api_host,scheme:e.scheme||o.CLIENT_SCHEME.BRIGHT_LIGHT};e.viewport_width?e.viewport_height?Object(a.isMvk)()?this.successHandler(_e({},t),this.callback):this.successHandler(_e({},t,{viewport_width:e.viewport_width,viewport_height:e.viewport_height}),this.callback):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_height"'}):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_width"'})}};function fe(){return(fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var me={error_type:"client_error",code:o.ERROR_CODES.CONNECTION_LOST};var be=class extends d{constructor(e){super(e),this.showConfirm=e=>{this.params.modal.pic=e.photo_url,this.params.modal.title=e.title,this.params.modal.text=e.message,this.modal=new c(fe({},this.params.modal)),n.push(this.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})},this.loadItemData=()=>new Promise((e,t)=>{var r=0;this.interval=setInterval(()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId},{onDone:n=>{switch((n=JSON.parse(n)).hasOwnProperty("error")&&t(n.error),n.status){case"pending":this.orderId=n.order_id,r++>=30&&t({error_type:"client_error",code:o.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case"loaded":this.orderId=n.order_id,this.confirmHash=n.confirm_hash,this.orderHash=n.order_hash,e(n.item_data)}},onFail:()=>{t(me)}})},1e3)}),this.confirmOrder=()=>{this.hideLoader(),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash},{onDone:e=>{"charged"===(e=JSON.parse(e)).status?(this.successHandler(e),n.pop(this.modal)):(n.pop(this.modal),this.errorHandler(e.error))},onFail:()=>{this.onError(me)}})},this.params.handlerName="VKWebAppShowOrderBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:this.confirmOrder,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.item,this.rawData=e}showLoader(){var e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new c(fe({},e)),n.push(this.loader)}hideLoader(){this.loader&&(n.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,r){this.setData(e,t),this.callback=r,Object(a.isMvk)()?(this.showLoader(),this.makeOrder()):(window.cur.app.registerVkBridgeCallback("onOrderCancel",()=>{this.errorHandler({reason:"User denied",code:o.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onOrderSuccess",e=>{this.successHandler({success:!0,order_id:e})}),window.cur.app.registerVkBridgeCallback("onOrderFail",e=>{this.errorHandler({reason:"Payment error",code:e})}),window.cur.app.funcs.showOrderBox(this.rawData))}makeOrder(){this.loadItemData().then(e=>{clearInterval(this.interval),this.hideLoader(),this.showConfirm(e)}).catch(e=>{this.onError(e)})}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}onError(e){clearInterval(this.interval),this.errorHandler(e),n.pop(this.modal),this.hideLoader()}};function ve(){return(ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ee=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowLeaderBoardBox",this.callApi=!0}actionHandler(e){Object(a.isMvk)()?super.actionHandler(e):this.errorHandler({error_type:"client_error",error_code:o.ERROR_CODES.INVALID_PARAMS,reason:"Not supported for this platform"})}handleResponse(e,t){if((e=JSON.parse(e)).hasOwnProperty("error"))this.errorHandler(e.error);else{var r=ve({},t,{},e);window.DirectGames.showLeaderBoard({onClose:()=>{this.successHandler({result:!0})},board:r})}}};var we=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowInviteBox",this.callApi=!0}actionHandler(e){Object(a.isMvk)()?window.DirectGames.showInviteBox({onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler}):cur.app.funcs.showInviteBox(this.successHandler.bind(this),this.errorHandler.bind(this))}};var Oe=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticleEditor",this.callApi=!1,this.useUI=!0,this.launchUI=this.launchUI.bind(this)}launchUI(e){if(cur.app.params.open_article_edit&&!window.isMvk){var t=e.owner_id,r=e.article_id,n=e.course_id,i="number"==typeof t,a="number"==typeof r,s="number"==typeof n;t&&i?r&&!a?this.errorHandler({code:a?o.ERROR_CODES.MISSING_PARAM:o.ERROR_CODES.INVALID_PARAMS,reason:`Param "article_id" is wrong. Expected integer greater than 0, got type ${typeof r} with value ${r}.`}):n&&(!s||n<=0)?this.errorHandler({code:s?o.ERROR_CODES.MISSING_PARAM:o.ERROR_CODES.INVALID_PARAMS,reason:`Param "course_id" is wrong. Expected integer greater than 0, got type ${typeof n} with value ${n}.`}):window.openArticleEditor&&window.openArticleEditor(t,r,null,{course_id:n,is_education:n>0?1:0,app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:i?o.ERROR_CODES.MISSING_PARAM:o.ERROR_CODES.INVALID_PARAMS,reason:`Param "owner_id" is missing or wrong. Expected integer, got type ${typeof t} with value ${t}.`})}else this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})}errorWrapper(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:e})}};function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ce=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowRequestBox",this.callApi=!0}actionHandler(e){Object(a.isMvk)()?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:e.uid},{onDone:t=>{try{(t=JSON.parse(t)).hasOwnProperty("error")?this.errorHandler(t.error):(Object.assign(e,t),window.DirectGames.showRequestBox(ye({},e,{onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler})))}catch(e){this.errorHandler(e)}},onFail:e=>{this.errorHandler(e)}}):(cur.app.registerVkBridgeCallback("onRequestFail",e=>{this.errorHandler(e)}),cur.app.registerVkBridgeCallback("onRequestCancel",()=>{this.errorHandler({reason:"User denied",code:o.ERROR_CODES.USER_DENIED})}),cur.app.registerVkBridgeCallback("onRequestSuccess",()=>{this.successHandler({request_key:e.requestKey,success:!0})}),cur.app.funcs.showRequestBox(e.uid,e.message,e.requestKey))}};function Se(){return(Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ae=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGetKeys",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.hasOwnProperty("count")&&"number"!=typeof e.count?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "count" should be a number'},r):e.hasOwnProperty("offset")&&"number"!=typeof e.offset?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "offset" should be a number'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e))}actionHandler(e){return ajax.post("apps.php",Se({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}};function Pe(){return(Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Te=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppStorageSet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.key?"string"==typeof e.key?e.hasOwnProperty("value")&&"string"!=typeof e.value?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "value" should be a string'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "key" should be a string'},r):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "key"'},r)}actionHandler(e){return ajax.post("apps.php",Pe({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}};function Re(){return(Re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var De=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.keys?"object"==typeof e.keys?e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "keys" should be a string'},r):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "keys"'},r)}actionHandler(e){return ajax.post("apps.php",Re({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}};function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Me=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppAddToFavorites",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=ke({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)}checkResponse(e){Object(a.isMvk)()?this.checkResponseMvk(e):this.checkResponseWeb(e)}checkResponseMvk(e){!0===e.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu()),super.checkResponse(e)}checkResponseWeb(e){e.result&&e.result.left_nav&&(window.Apps.updateLeftNav(e.result.left_nav),window.Apps.updateAddToMenuAction(),e={result:e.result.success}),super.checkResponse(e)}handler(e,t,r){(Object(j.partConfigEnabled)("mini_apps_web_add_to_favorites")||cur.app.isDirectGame)&&(this.setData(e,t),this.callback=r,this.loadIntroData())}};r("ls82");function Ie(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var Le=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppAddToMenu",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_menu"),text:getLang("apps_connect_modal_messages_request_add_to_menu_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}actionHandler(e){var t,r=this;return(t=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.Apps.addToMenuApi(r.app.appId,cur.app.options.hash,1,null,e=>{r.successHandler({result:Boolean(e&&e.left_nav)})},e=>{r.errorHandler(e)});case 2:case"end":return e.stop()}}),e)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(e){Ie(i,n,o,a,s,"next",e)}function s(e){Ie(i,n,o,a,s,"throw",e)}a(void 0)}))})()}handler(e,t,r){if(Object(j.partConfigEnabled)("mini_apps_web_add_to_menu")){if(this.setData(e,t),this.callback=r,Object(a.isMvk)())return void this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);window.Apps.isAppInLeftMenu(t=>{t?this.successHandler({result:!0}):this.launchUI(e)})}}};r("Vd3H");function xe(){return(xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ne=class extends d{constructor(e){super(e),this.onFlistHide=()=>{this.hasSuccess||this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User denied"})},this.params.handlerName="VKWebAppGetFriends",this.callApi=!0}loadIntroData(e){var t=this;this.request=xe({},e),cur.onFlistSave=function(){return t.onFlistSave(...arguments)},cur.onFlistHide=this.onFlistHide,showTabbedBox("apps.php",xe({act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[""+this.params.handlerName]+"_hash"],event:o.VK_CONNECT_EVENTS[""+this.params.handlerName],app_id:this.app.appId},this.request),{stat:["ui_controls.js","ui_controls.css"]})}onFlistSave(e,t){this.hasSuccess=!0;var r={};r.users=t.friends.map(e=>{var t=e[1].split(" ");return{id:e[0],sex:parseInt(e[5],10),last_name:t[1]?t[1]:"",first_name:t[0],photo_200:e[2]}}),this.request.lists&&(r.lists=t.lists.map(e=>e[0]).sort()),this.successHandler(r)}handler(e,t,r){this.setData(e,t),this.callback=r,Object(a.isMvk)()?this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&(e.hasOwnProperty("lists")&&(e.lists=e.lists?1:0),e.hasOwnProperty("multi")&&(e.multi=e.multi?1:0),this.actionHandler(e))}actionHandler(e){this.loadIntroData(e)}};var Be=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowCommunityWidgetPreviewBox"}resetBox(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout((function(){delete cur.appWidgetPreviewBox}),3e3)}actionHandler(e){if(Object(a.isMvk)())this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM});else{if(!this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}]))return;this.showWidgetPreviewBox(e)}}showWidgetPreviewBox(e){if(!cur.appWidgetPreviewBox){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=e=>{this.resetBox(),this.errorHandler(e)},cur.onAppWidgetPreviewCancel=()=>{this.resetBox(),this.errorHandler({code:o.ERROR_CODES.USER_DENIED,reason:"User denied"})},cur.onAppWidgetPreviewSuccess=()=>{this.resetBox(),this.successHandler({result:!0})};var t=showBox("apps",{act:"app_widget_preview_box",aid:this.app.appId,gid:e.group_id,type:e.type,code:e.code},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{t.setOptions({onHide:()=>{Object(l.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(l.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}}};var je=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenInNativeApp",this.useUI=!1}actionHandler(e){var t=window.browser,r=t.ipad,n=t.iphone,i=t.android;if(Object(a.isMvk)()&&(r||n||i)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM})}openInNativeApp(e){if(this._openAppInProgress)return!1;var t="vk://vk.com/"+e,r=browser.mi?1500:300;browser.safari&&(r=browser.ios>=12?2800:300);var n=Date.now(),i=setTimeout(()=>{this._openAppInProgress=!1,Date.now()-n>r+200||!document.hasFocus()?this.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))},r),a=()=>{clearTimeout(i),this._openAppInProgress=!1,window.removeEventListener("blur",a)};if(window.addEventListener("blur",a),browser.ios){var s=()=>{window.removeEventListener("focus",s)};window.addEventListener("focus",s)}return this._openAppInProgress=!0,nav.hard_go(t),!1}};var We=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppLocationChanged"}get successDescriptor(){return""+this.params.handlerName}actionHandler(e){this.successHandler({location:e.location})}};var Ue=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppClose"}closeMiniAppPage(){var e=-1,t=window.history.length;if(cur.VKApp){if(2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength)return void nav.go(Object(a.isMvk)()?"/services":"/feed");cur.VKApp.vkMiniAppsHistoryLength!==t&&(e=cur.VKApp.vkMiniAppsHistoryLength-t-1)}e<=1?nav.go(Object(a.isMvk)()?"/services":"/feed"):window.history.go(e)}actionHandler(e){Object(a.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage():cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),WkView.hide()):this.closeMiniAppPage()}handler(e,t,r){this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"status",type:"string",extraChecks:[{check:e=>o.CLOSE_STATUS.includes(e),error:e=>`Param "${e}" should be "success" or "failed"`}]},{param:"payload",type:"object",isRequired:!1}])&&this.actionHandler(e)}},He=r("bKAG");function Ke(){return(Ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Fe extends d{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowStoryBox",this.callApi=!1,this.useUI=!1}get loadFinishDescriptor(){return this.params.handlerName+"LoadFinish"}loadFinishHandler(e){this.callback({type:this.loadFinishDescriptor,data:e},this.params.handlerName)}static isValidUrl(e){try{return!!new URL(e)}catch(e){return!1}}initStoryPublisher(e){window.StoryPublisher&&window.StoryPublisher.init(e,()=>this.successHandler({result:!0}),(e,t)=>{if(!e){var r={code:o.ERROR_CODES.USER_DENIED};return t&&t.error&&t.error.message&&(r.reason=t.error.message),this.errorHandler(r)}if(t&&t.story){var n=t.story,i=n.owner_id,a=n.id;return this.loadFinishHandler({story_owner_id:i,story_id:a})}})}}class Ve extends Fe{actionHandler(e){if(!Object(j.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.validateParams(e)&&window.stManager.add([window.jsc("web/story_publisher.js")]).then(()=>{this.initStoryPublisher(Ke({entrypoint:He.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),photoUrl:e.url?e.url:e.blob,stickers:e.stickers,attachment:e.attachment},e))}).catch(()=>this.errorHandler({code:o.ERROR_CODES.UNKNOWN}))}validateParams(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&!(e.stickers&&!this.checkAStickers(e.stickers)))}checkFields(e){return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>Fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}checkAttachment(e){var t=["url","photo","video","audio"],r=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","write","open","learn_more","view","go_to","contact","watch","play","install","read"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:e=>r.includes(e),error:e=>`Param "${e}" should be a ${r.join(", ")}`}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be a ${t.join(", ")}`}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:e=>Fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))}checkAStickers(e){return!e.length||e.every(e=>!!this.checkStickerContainer(e)&&!!this.checkSticker(e.sticker_type,e.sticker))}checkStickerContainer(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["native","renderable"].includes(e),error:e=>`Param "${e}" should be a native or renderable`}]},{param:"sticker",type:"object",isRequired:!0}])}checkSticker(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)}checkNativeSticker(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["text","sticker"].includes(e),error:e=>`Param "${e}" should be a text or sticker`}]},{param:"action",type:"object",isRequired:!0},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))}checkAction(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"app"===e?this.checkParams(t,[{param:"app_id",type:"number",isRequired:!0},{param:"app_context",type:"string"}]):(this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1)}checkTransform(e){var t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be ${t.join(", ")}`}]}])}checkRenderableSticker(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>Fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))}checkClickableZones(e){return e.every(t=>!!this.checkClickableZone(t)&&(!!this.checkAction(t.action_type,t.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(this.errorHandler({code:o.ERROR_CODES.UNKNOWN}),!1):e.clickable_area.every(e=>this.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}]))))))}checkClickableZone(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["link","app"].includes(e),error:e=>`Param "${e}" should be a link or app`}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}}class Ge extends Fe{actionHandler(e){if(!Object(j.partConfigEnabled)("bridge_mobile_story_box_enabled"))return this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM});var t=this.getEventHashes(),r=t.storyUploadUrlHash,n=t.storySaveHash;this.validateParams(e).then(()=>{this.initStoryPublisher(Ke({entrypoint:He.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),miniAppName:this.app.vkApp.options.app_name,storyUploadUrlHash:r,storySaveHash:n,maxVideoDuration:He.MAX_STORY_VIDEO_DURATION,closeAfterError:!0},e))}).catch(e=>{e&&this.errorHandler(e)})}validateParams(e){return this.checkFields(e)}checkFields(e){return new Promise((t,r)=>{var n={check:e=>Fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`};return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e||"video"===e,error:e=>`Param "${e}" should be a image or video`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[n]},{param:"blob",type:"string",isRequired:!e.url,extraChecks:[{check:()=>"image"===e.background_type,error:e=>`Param "${e}" available only for image background_type`},n]}])?t():r()})}}function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var ze=class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetGroupInfo",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_group_info"),text:getLang("apps_connect_modal_messages_request_group_info_text")},this.callApi=!0,this.useUI=!0}launchUI(e){var t=e.groupPhoto,r=e.groupName;t&&(this.params.modal.pic=t),r&&(this.params.modal.title=`${this.params.modal.title} ${r}`),this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new c(qe({},this.params.modal)),n.push(this.modal)}handler(e,t,r){this.setData(e,t),this.callback=r,this.validateParams(e)&&this.loadIntroData(e)}validateParams(e){return this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}loadIntroData(e){this.request=qe({},e);var t=e.group_id;ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:o.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,group_id:t},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){if(e.hasOwnProperty("error"))this.errorHandler({code:o.ERROR_CODES.ACCESS_DENIED,reason:o.ERROR_REASONS.USER_NOT_A_PRIVATE_GROUP_MEMBER,error_type:o.ERROR_TYPES.CLIENT});else{if(!e.hasOwnProperty("result"))return this.successHandler(e);var r=e.photo_100,n=e.name;this.launchUI(qe({},t,{groupPhoto:r,groupName:n}))}}};var Ye={VKWebAppInit:u,VKWebAppGetCommunityAuthToken:m,VKWebAppGetCommunityToken:b,VKWebAppGetFriends:Ne,VKWebAppAddToCommunity:E,VKWebAppAddToHomeScreenInfo:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppAddToHomeScreenInfo"}actionHandler(e){this.successHandler({is_feature_supported:!1,is_added_to_home_screen:!1})}},VKWebAppCopyText:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppCopyText"}copyError(){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:"Can’t copy text on this device"},this.callback)}actionHandler(e){e.text?Object(w.copyToClipboard)(e.text).then(()=>{this.successHandler({result:!0})}).catch(()=>{this.copyError()}):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "text"'})}},VKWebAppAddToFavorites:Me,VKWebAppAddToMenu:Le,VKWebAppGetUserInfo:O,VKWebAppSetLocation:C,VKWebAppGetClientVersion:S,VKWebAppGetPhoneNumber:P,VKWebAppGetEmail:R,VKWebAppOpenArticle:ue,VKWebAppGetGeodata:D,VKWebAppOpenQR:k,VKWebAppSetViewSettings:I,VKWebAppSetTitle:L,VKWebAppGetAuthToken:N,VKWebAppCallAPIMethod:H,VKWebAppJoinGroup:G,VKWebAppLeaveGroup:z,VKWebAppAllowMessagesFromGroup:X,VKWebAppDenyNotifications:$,VKWebAppAllowNotifications:ee,VKWebAppOpenPayForm:J,VKWebAppOpenApp:re,VKWebAppShare:ne,VKWebAppShowNewPostBox:oe,VKWebAppShowWallPostBox:ie,VKWebAppSendToClient:M,VKWebAppOpenArticleEditor:Oe,VKWebAppScroll:ae,VKWebAppStorageGet:De,VKWebAppStorageGetKeys:Ae,VKWebAppStorageSet:Te,VKWebAppResizeWindow:ce,VKWebAppSendPayload:pe,VKWebAppUpdateConfig:he,VKWebAppTapticImpactOccurred:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppTapticImpactOccurred"}actionHandler(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppTapticNotificationOccurred:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppTapticNotificationOccurred"}actionHandler(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppTapticSelectionChanged:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppTapticSelectionChanged"}actionHandler(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppShowImages:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppShowImages"}checkUrlString(e){try{return!!new URL(e)}catch(e){return!1}}handler(e,t,r){if(this.setData(e,t),this.callback=r,Object(a.isMvk)()){var n=window.photoview,i=e.start_index,s=e.images;if(this.checkParams(e,[{param:"images",type:"object",isRequired:!0,extraChecks:[{check:e=>e.every(e=>this.checkUrlString(e)),error:e=>`Param "${e}" should be a valid link.`},{check:e=>e.every(e=>e.startsWith("https://")),error:e=>`Param "${e}" should be https link.`}]},{param:"start_index",type:"number",extraChecks:[{check:e=>e>=0,error:e=>`Param "${e}" should be non-negative number.`},{check:e=>void 0!==s[e],error:e=>`Param "${e}" should be a valid index in the pictures array.`}]}])){var c=i||0,l=s.map(e=>({src:e}));n.open(c,l,{showControls:!1}),this.successHandler({result:!0})}}else this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)}},VKWebAppShowOrderBox:be,VKWebAppShowLeaderBoardBox:Ee,VKWebAppShowInviteBox:we,VKWebAppShowRequestBox:Ce,VKWebAppShowCommunityWidgetPreviewBox:Be,VKWebAppOpenInNativeApp:je,VKWebAppLocationChanged:We,VKWebAppClose:Ue,VKWebAppShowStoryBox:class{constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object(a.isMvk)()?new Ge(...t):new Ve(...t)}},VKWebAppSubscribeStoryApp:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppSubscribeStoryApp",this.callApi=!1,this.useUI=!1}actionHandler(e){if(this.validateParams(e)){var t={act:"subscribe_user_to_app",story_owner_id:e.story_owner_id,story_id:e.story_id,access_key:e.access_key,sticker_id:e.sticker_id,hash:this.getEventHash(),app_id:this.app.appId},r=t=>{this.handleResponse(t,e,e=>this.successHandler(e))},n=e=>{this.errorHandler(e)};Object(a.isMvk)()?window.ajax.post("stories.php",t,{onDone:(e,t)=>t?n(t):r(e)}):window.ajax.post("al_stories.php",t,{onDone:r,onFail:n})}}validateParams(e){return this.checkParams(e,[{param:"story_owner_id",type:"number",isRequired:!0},{param:"story_id",type:"number",isRequired:!0},{param:"sticker_id",type:"number",isRequired:!0},{access_key:"string",type:"string",isRequired:!1}])}},VKWebAppGetPersonalCard:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppGetPersonalCard"}actionHandler(){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppOpenContacts:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenContacts"}actionHandler(){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppOpenCodeReader:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppOpenCodeReader"}actionHandler(){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppShowSubscriptionBox:class extends d{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowSubscriptionBox"}actionHandler(e){Object(a.isMvk)()?this.errorHandler({error_type:o.ERROR_TYPES.CLIENT,error_code:o.ERROR_CODES.INVALID_PARAMS,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM}):e.hasOwnProperty("action")?~["create","resume","cancel"].indexOf(e.action)?"create"!==e.action||e.hasOwnProperty("item")?"resume"!==e.action&&"cancel"!==e.action||e.hasOwnProperty("subscription_id")?(window.cur.app.registerVkBridgeCallback("onSubscriptionCancel",()=>{this.errorHandler({reason:"User denied",code:o.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onSubscriptionSuccess",e=>{this.successHandler({success:!0,subscriptionId:e})}),window.cur.app.registerVkBridgeCallback("onSubscriptionFail",e=>{this.errorHandler({reason:"Subscription error",code:e})}),window.cur.app.funcs.showSubscriptionBox(e.action,e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "subscription_id"'}):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "item"'}):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "action" must be one of: create, resume or cancel'}):this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}},VKWebAppShowInstallPushBox:class extends d{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowInstallPushBox"}actionHandler(e){Object(a.isMvk)()?this.errorHandler({error_type:o.ERROR_TYPES.CLIENT,error_code:o.ERROR_CODES.INVALID_PARAMS,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM}):(window.cur.app.registerVkBridgeCallback("onInstallPushSuccess",()=>{this.successHandler({success:!0})}),window.cur.app.registerVkBridgeCallback("onInstallPushCancel",()=>{this.errorHandler({reason:"User denied",code:o.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onInstallPushFail",e=>{this.errorHandler({reason:e})}),window.cur.app.funcs.showInstallPushBox(this.successHandler.bind(this),this.errorHandler.bind(this)))}},VKWebAppGetGroupInfo:ze,VKWebAppFlashGetInfo:class extends d{constructor(e){super(e),this.params.handlerName="VKWebAppFlashGetInfo"}actionHandler(e){this.successHandler({is_available:!1})}}};function Xe(){return(Xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var $e=(e,t)=>{var r;if(e.frameId){var n=ge(e.frameId);n&&(r=n.querySelector("iframe"))}else t&&(r=t.querySelector("iframe"));r&&r.contentWindow.postMessage(Xe({},e),"*")},Ze=(e,t)=>{if(Ye[e.handler]){var r=new Ye[e.handler]({request_id:e.params.request_id}),n=e=>{ge(t.containerId)&&e&&$e(e,ge(t.containerId))};if(Object(j.partConfigEnabled)("mini_apps_web_flood_control")){if(t.isRequestsLimitReached())return r.callback=n,void r.errorHandler({code:o.ERROR_CODES.REQUESTS_LIMIT_REACHED});t.eventQueue.push({eventData:e,timeInMs:Date.now()})}r.handler(Xe({},e.params,{containerId:t.containerId,pic:e.pic}),t,n)}}},ls82:function(e,t,r){(function(t){!function(t){"use strict";var r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=f;var p={},d={};d[i]=function(){return this};var u=Object.getPrototypeOf,_=u&&u(u(A([])));_&&_!==r&&n.call(_,i)&&(d=_);var h=v.prototype=g.prototype=Object.create(d);b.prototype=h.constructor=v,v.constructor=b,v[s]=b.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(h),e},l.awrap=function(e){return{__await:e}},E(w.prototype),w.prototype[a]=function(){return this},l.AsyncIterator=w,l.async=function(e,t,r,n){var o=new w(f(e,t,r,n));return l.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(h),h[s]="Generator",h[i]=function(){return this},h.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}}}function f(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return P()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=O(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=m(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function m(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function g(){}function b(){}function v(){}function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){function r(t,o,i,a){var s=m(e[t],e,o);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):Promise.resolve(l).then((function(e){c.value=e,i(c)}),a)}a(s.arg)}var o;"object"==typeof t.process&&t.process.domain&&(r=t.process.domain.bind(r)),this._invoke=function(e,t){function n(){return new Promise((function(n,o){r(e,t,n,o)}))}return o=o?o.then(n,n):n()}}function O(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=m(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,r("yLpj"))},lyAj:function(e,t,r){"use strict";r.r(t);r("pIFo"),r("a1Th"),r("Btvt");var n=r("PU8N");!function(e){if(!e.fastXDM){var t={},r=[],o={};e.fastXDM={_id:0,helperUrl:"https://vk.com/js/api/xdmHelper.js",Server:function(r,n,o){this.methods=r||{},this.filter=n,this.options=o||{},this.id=e.fastXDM._id++,this.key=function(){for(var e="",t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}(),this.frameName="fXD"+this.key,this.frameId="fXD"+this.key,this.server=!0,this.methods["%init%"]=this.methods.__fxdm_i=function(){e.fastXDM.run(this.id),this.methods.onInit&&this.methods.onInit()},t[this.key]=[p,this]},Client:function(r,n){if(this.methods=r||{},this.options=n||{},this.id=e.fastXDM._id++,this.client=!0,e.fastXDM.run(this.id),0!==window.name.indexOf("fXD"))throw Error("Wrong window.name property.");this.key=window.name.substr(3),this.caller=window.parent,t[this.key]=[p,this],e.fastXDM.on("helper",(function(){e.fastXDM.onClientStart(this)}),this),c((function(e){e.send(this,e.json.stringify(["%init%"]));var t=this.methods;setTimeout((function(){t.onInit&&t.onInit()}),0)}),this)},onMessage:function(r){if(r.origin!==e.location.origin&&cur){var n=cur.app&&cur.app.options&&cur.app.options.src?cur.app.options.src:"";if(!n)return!1;r.origin!==n&&r.origin+"/"!==n.substring(0,r.origin.length+1)&&console.warn&&console.warn("Warning: message from "+r.origin+" will be disable in future")}var o=r.data;if(!o)return!1;if("string"!=typeof o&&!(o instanceof String))return!1;var i=o.substr(0,5);if(t[i]){var a=t[i][1];!a||a.filter&&!a.filter(r.origin)||t[i][0](o.substr(6),a)}},setJSON:function(e){o.json=e},getJSON:function(e){if(!e)return o.json;c((function(t){e(t.json)}))},setEnv:function(e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);l()},_q:{},on:function(e,t,r){this._q[e]||(this._q[e]=[]),-1==this._q[e]?t.apply(r):this._q[e].push([t,r])},run:function(e){for(var t=(this._q[e]||[]).length,r=0;r<t;r++)this._q[e][r][0].apply(this._q[e][r][1]);this._q[e]=-1},waitFor:i},e.fastXDM.Server.prototype.start=function(t,r){if(t.contentWindow)this.caller=t.contentWindow,this.frame=t,e.fastXDM.on("helper",(function(){e.fastXDM.onServerStart(this)}),this);else{var n=this;(r=r||0)<50&&setTimeout((function(){n.start.apply(n,[t,r+1])}),100)}},e.fastXDM.Server.prototype.destroy=function(){delete t[this.key]},e.fastXDM.Server.prototype.append=function(e,t,r){var o=document.createElement("DIV");o.innerHTML='<iframe name="'+this.frameName+'"  id="'+this.frameId+'" '+(r||"")+"></iframe>";var i=o.firstChild;!Object(n.isMvk)()&&t.vkApp&&window.cur&&window.cur.app&&i.addEventListener("load",(function(){var e=cur.app.cont,t={type:"VKWebAppSettings",frameId:e.id};e.firstElementChild.contentWindow.postMessage(t,"*")}));var a=this,s=function(){i.frameBorder="0",t&&function e(t,r){for(var n in r)t[n]&&"object"==typeof t[n]?e(t[n],r[n]):t[n]=r[n]}(i,t),e.insertBefore(i,e.firstChild),a.start(i)};return!Object(n.isMvk)()&&~e.className.indexOf("app_container--vk-app")&&delete t.scrolling,a.options.layer?s():setTimeout((function(){s()}),0),i},e.fastXDM.Client.prototype.callMethod=e.fastXDM.Server.prototype.callMethod=function(){for(var t=this,r=Array.prototype.slice.call(arguments),n=r.shift(),o=0,a=r.length;o<a;o++)"function"==typeof r[o]?function(){t.funcsCount=(t.funcsCount||0)+1;var e=r[o],n="_func"+t.funcsCount;t.methods[n]=function(){e.apply(this,arguments),delete this.methods[n]},r[o]={_func:t.funcsCount}}():this.options.safe&&(r[o]=s(r[o],!1));i(this,"caller",(function(){e.fastXDM.on(this.id,(function(){c((function(e){e.send(this,e.json.stringify([n,r]))}),this)}),this)}),this)},e.JSON&&"object"==typeof e.JSON&&e.JSON.parse&&e.JSON.stringify&&'{"a":[1,2,3]}'===e.JSON.stringify({a:[1,2,3]}).replace(/ /g,"")?o.json={parse:e.JSON.parse,stringify:e.JSON.stringify}:e.fastXDM._needJSON=!0,e.postMessage?(o.protocol="p",o.send=function(e,t){var r=e.frame?e.frame.contentWindow:e.caller;if(r)try{r.postMessage(e.key+":"+t,"*")}catch(n){window.postMessage.call(r,e.key+":"+t,"*")}},e.addEventListener?e.addEventListener("message",e.fastXDM.onMessage,!1):e.attachEvent("onmessage",e.fastXDM.onMessage),e.fastXDM._needJSON?(e.fastXDM._onlyJSON=!0,a()):l()):a()}function i(e,t,r,n,o){e[t]?r.apply(n):(o=o||0)<1e3&&setTimeout((function(){i(e,t,r,n,o+1)}),0)}function a(t){setTimeout((function(){var r=document.createElement("script");r.type="text/javascript",r.src=t||e.fastXDM.helperUrl,i(document,"body",(function(){document.getElementsByTagName("HEAD")[0].appendChild(r)}))}),0)}function s(e,t){var r;switch(typeof e){case"string":r=t?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e.replace(/&#039;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");break;case"object":if("[object Array]"===Object.prototype.toString.apply(e)){r=[];for(var n=0,o=e.length;n<o;n++)r[n]=s(e[n],t)}else for(var i in r={},e)Object.hasOwnProperty.call(e,i)&&(r[i]=s(e[i],t));break;default:r=e}return r}function c(e,t){o.loaded?e.apply(t,[o]):r.push([t,e])}function l(){o.loaded=!0;for(var e=0,t=r.length;e<t;e++)r[e][1].apply(r[e][0],[o])}function p(e,t){c((function(r){var n=r.json.parse(e);if(n[0]){n[1]||(n[1]=[]);for(var o=0,i=n[1].length;o<i;o++)n[1][o]&&n[1][o]._func?function(){var e=n[1][o]._func;n[1][o]=function(){var r=Array.prototype.slice.call(arguments);r.unshift("_func"+e),t.callMethod.apply(t,r)}}():t.options.safe&&(n[1][o]=s(n[1][o],!0));setTimeout((function(){t.methods[n[0]]?t.methods[n[0]].apply(t,n[1]):console.warn("fastXDM: Method "+n[0]+" is undefined")}),0)}}))}}(window)},nB7T:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=r("FWc3"),o=r("zxIV");class i{static show(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(window.vk.id){var s=e.tt&&e.tt.container?e.tt.container:null;s&&!Object(o.isVisible)(s)&&(s.classList.remove("tt_left"),s.classList.remove("tt_right"),s.classList.remove("GamesCatalogGameInfoTooltipWrapper--up"));var c,l="left",p=-200,d="",u=document.documentElement.clientWidth,_=document.documentElement.clientHeight,h=e.getBoundingClientRect();return h.left>u-520?(l="right",c=365):c=-h.width-10,h.top>_-400&&(p=0,d="GamesCatalogGameInfoTooltipWrapper--up",s&&s.classList.add(d)),Object(n.showTooltip)(e,{url:"/apps",params:{act:"game_info_tooltip",game_id:t,ref:r,genre_id:i,collection_id:a},className:"GamesCatalogGameInfoTooltipWrapper "+d,dir:l,center:!1,shift:[c,p],hasover:!0,ajaxdt:200,showdt:300,hidedt:300})}}}},qJhe:function(e,t,r){"use strict";r.r(t),r.d(t,"StoryPublisher",(function(){return m}));var n,o=r("q1tI"),i=r("i8i4"),a=r("0fW4"),s=r("EasH"),c=r("6krn"),l=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=r("r7nW").default,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var r=e||Object(c.getLang)("global_error");window.showFastBox({title:Object(c.getLang)("global_error")},r,Object(c.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,r,n){void 0===n&&(n={}),t.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,analytics:n.analytics,mediaEditorAnalytics:n.mediaEditorAnalytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},n.storySaveHash).then((function(e){t.onClose(!0,!1,e),r()})).catch((function(e){return t.errorHandler(e,r),!0}))},t.onClose=function(e,r,n){var o,i;if(r)t.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n);else{(null===(i=null===(o=window.cur.photoEditorStore)||void 0===o?void 0:o.getState())||void 0===i?void 0:i.past.length)>1?Object(s.showFastBox)({title:Object(c.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(c.getLang)("photos_pe_story_editor_close_text"),Object(c.getLang)("box_yes"),(function(){t.props.onClose(!1),window.curBox().hide()}),Object(c.getLang)("box_no"),(function(){window.curBox().hide()})):t.props.onClose(!1)}},t}return l(t,e),t.prototype.render=function(){var e=this,t=window.innerHeight-100,r=t/1.78;return o.createElement(p,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},o.createElement(a.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers}))},t}(o.Component),u=r("ufMw"),_=r("kcIO"),h=r("4+be"),f=r("bKAG"),m={init:function(e,t,r){var n=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(u.sendStat)(u.EVENTS.ADD_STORY_FROM_SHARING):Object(u.sendStat)(u.EVENTS.ADD_STORY);var n=document.querySelector(".StoryPublisher");n||((n=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(n)),i.render(o.createElement(d,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers}),n)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&i.unmountComponentAtNode(r),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,e&&Object(_.showDoneBox)(Object(h.getLang)("photos_pe_story_published"))},saveStory:function(e,t,r){return Object(f.getStoryUploadUrl)(t).then((function(t){return Object(f.uploadStoryBlobToServer)(e,t)})).then((function(e){var t=e.response;return Object(f.saveStoryOnServer)(t&&t.upload_result,r)}))}}},qT12:function(e,t,r){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,p=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,u=n?Symbol.for("react.concurrent_mode"):60111,_=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,b=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,E=n?Symbol.for("react.responder"):60118,w=n?Symbol.for("react.scope"):60119;function O(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case d:case u:case a:case c:case s:case h:return e;default:switch(e=e&&e.$$typeof){case p:case _:case g:case m:case l:return e;default:return t}}case i:return t}}}function y(e){return O(e)===u}t.AsyncMode=d,t.ConcurrentMode=u,t.ContextConsumer=p,t.ContextProvider=l,t.Element=o,t.ForwardRef=_,t.Fragment=a,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=c,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return y(e)||O(e)===d},t.isConcurrentMode=y,t.isContextConsumer=function(e){return O(e)===p},t.isContextProvider=function(e){return O(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return O(e)===_},t.isFragment=function(e){return O(e)===a},t.isLazy=function(e){return O(e)===g},t.isMemo=function(e){return O(e)===m},t.isPortal=function(e){return O(e)===i},t.isProfiler=function(e){return O(e)===c},t.isStrictMode=function(e){return O(e)===s},t.isSuspense=function(e){return O(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===u||e===c||e===s||e===h||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===p||e.$$typeof===_||e.$$typeof===v||e.$$typeof===E||e.$$typeof===w||e.$$typeof===b)},t.typeOf=O},qihR:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),i=r("i8i4"),a=r("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},c=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};t.default=function(e){var t,r=e.x,l=e.y,p=e.text,d=e.position,u=void 0===d?"b":d,_=e.align,h=void 0===_?"center":_,f=e.removed,m=e.maxWidth,g=e.appearance,b=void 0===g?"dark":g,v=e.className,E=e.tooltipRef,w=c(e,["x","y","text","position","align","removed","maxWidth","appearance","className","tooltipRef"]),O=Object(n.useRef)(null);O.current||(O.current=document.createElement("div"),document.body.appendChild(O.current));var y=Object(a.classNames)("Tooltip","Tooltip--"+u,"Tooltip--"+b,((t={"Tooltip--removed":!!f})["Tooltip--align-"+h]="t"===u||"b"===u,t),v);return Object(i.createPortal)(o.a.createElement("div",s({},w,{className:y,ref:E,style:{top:l,left:r}}),"string"==typeof p&&o.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:m},dangerouslySetInnerHTML:{__html:p}}),"string"!=typeof p&&o.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:m}},p)),O.current)}},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("i8i4"),i=(r("17x9"),r("ZxpX"));class a extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+r+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,r=e.onBackdropClick;e.disableBackdropClick||(r?r():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(i.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return o.createPortal(this.renderModal(),document.body)}}a.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=a},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return l})),r.d(t,"prepareStat",(function(){return p})),r.d(t,"prepareMediaEditorStat",(function(){return d}));var n=r("1y80"),o=r("98sY"),i=r("xYVc"),a=r("W9Tc"),s={FLIP_X:"flipX",FLIP_Y:"flipY",ADD_FILTER:"add_filter",REMOVE_FILTER:"remove_filter",UNDO:"undo",REDO:"redo",ENABLE_AUTOCORRECTION:"enable_autocorrection",DISABLE_AUTOCORRECTION:"disable_autocorrection",ENABLE_BLUR:"enable_blur",DISABLE_BLUR:"disable_blur",ZOOM:"zoom",UNZOOM:"unzoom",TURN_LEFT:"turn_left",TURN_RIGHT:"turn_right",ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",SELECT_BACKGROUND:"select_background"},c=[s.ADD_STORY,s.ADD_STORY_FROM_SHARING,s.CLICK_TO_CAMERA_ICON,s.CLICK_TO_GRADIENT_ICON,s.ADD_TEXT,s.EDIT_TEXT,s.DELETE_TEXT,s.ADD_STICKER,s.DELETE_STICKER,s.ADD_GRAFFITI,s.SELECT_BACKGROUND];function l(e){var t=0,r=0;if(window.cur.pvCurPhoto){var i=window.cur.pvCurPhoto.id.split("_"),s=i[0],l=i[1];t=parseInt(s),r=parseInt(l)}var p={event_type:e,media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:t,media_id:r};Object(a.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(p),Object(n.statlogsValueEvent)("media_editor_product_analytics",p),c.includes(e)&&Object(n.statlogsValueEvent)("story_create_product_analytics",{event_type:e,story_type:"photo"})}function p(e,t,r,n){var o=0,a="photo";r===i.default.BACKGROUND_MODES.BACKGROUND&&(a=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:a,background_id:o},c=[],l=[],p=[];return e.forEach((function(e){if(e.type===i.default.LAYER_TYPES.STICKER){var t=(a=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===i.default.LAYER_TYPES.TEXT){var a=e;l.push({text:a.text,font:a.fontStyle,size:Math.round(a.fontSize*i.default.FONT_SIZE_COEFFICIENT),color:a.color.slice(1),background:"none",align:"center"})}})),l.length&&(s.has_text=1,s.texts=l),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){p.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),p.length&&(s.has_graffiti=1,s.graffities=p),s}function d(e,t){var r=0,n=0;if(window.cur.pvCurPhoto){var o=window.cur.pvCurPhoto.id.split("_"),a=o[0],s=o[1];r=parseInt(a),n=parseInt(s)}var c={media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:r,media_id:n,is_cropped:t.isCropped,is_autocorrected:t.isAutoCorrection,rotation:t.rotation,filter:t.filter.name,filter_value:100*t.filter.value,ratio:t.cropAspect,photo_correction:[{type:"exposure",value:100*t.colorCorrection.exposure},{type:"contrast",value:100*t.colorCorrection.contrast},{type:"saturation",value:100*t.colorCorrection.saturation},{type:"warmth",value:100*t.colorCorrection.warmth},{type:"vignette",value:100*t.colorCorrection.vignette},{type:"sharpness",value:100*t.colorCorrection.sharpness},{type:"grain",value:100*t.colorCorrection.grain}]};t.blur.isEnabled&&(c.blur_type=t.blur.form,c.blur_value=t.blur.size);var l=[];return e.forEach((function(e){if(e.type===i.default.LAYER_TYPES.TEXT){var t=e;l.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*i.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),l.length&&(c.has_text=1,c.texts=l),c}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("q1tI"),o=(r("17x9"),r("UlUB")),i=r("PjZB"),a=r("ZxpX");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class l extends n.Component{constructor(e){super(e),this.checkLoad=Object(o.throttle)(e=>{var t=s(e,3),r=t[0],n=t[1],o=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(n-r-o<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,n=this.getChildrenData(e,t||this.getScrollData()),o=n.start,i=n.end,a=n.before,s=n.after;o===r.start&&i===r.end&&a===r.before&&s===r.after||this.setState(n)}getChildrenData(e,t){var r=s(t,3),n=r[0],o=r[1],i=r[2],a=this.useWindowScroll?window:this.container,c=a&&a.offsetHeight;if(!a||0===o||0===i)return{start:0,end:0,before:0,after:e.length};i=Math.max(i,c);var l=e.length,p=Math.max(Math.floor(n/this.props.itemHeight)-1,0),d=Math.min(Math.floor((n+2*i)/this.props.itemHeight+1),l);return{start:p,end:d,before:p,after:l-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return n.createElement("div",{className:Object(a.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&n.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&n.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||n.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},n.createElement(i.default,null))))}}l.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},wZQE:function(e,t,r){e.exports=function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},t=function(e,t,r,n,o){if(e<7&&t<7)return!1;if(e>=r-7&&t<7)return!1;if(e<7&&t>=r-7)return!1;if(o){var i=9;r<=25&&i--;var a=(r-14-i)/2-1;return r<=25&&a++,!(e>7+a&&e<r-7-a-1&&t>7+a&&t<r-7-a-1)&&0<=e&&e<r&&0<=t&&t<r&&n[t][e]}return n[t]&&n[t][e]},r=function(e,r,n,o,i){return void 0===i&&(i=!0),{l:t(e-1,r,n,o,i),r:t(e+1,r,n,o,i),t:t(e,r-1,n,o,i),b:t(e,r+1,n,o,i),current:t(e,r,n,o,i)}},n=function(){function e(t,r,n,o){if(this.version=t,this.errorCorrectionLevel=r,this.mask=o,this.modules=[],this.isFunction=[],t<e.MIN_VERSION||t>e.MAX_VERSION)throw"Version value out of range";if(o<-1||o>7)throw"Mask value out of range";this.size=4*t+17;for(var i=[],a=0;a<this.size;a++)i.push(!1);for(a=0;a<this.size;a++)this.modules.push(i.slice()),this.isFunction.push(i.slice());this.drawFunctionPatterns();var s=this.addEccAndInterleave(n);if(this.drawCodewords(s),-1==o){var c=1e9;for(a=0;a<8;a++){this.applyMask(a),this.drawFormatBits(a);var l=this.getPenaltyScore();l<c&&(o=a,c=l),this.applyMask(a)}}if(o<0||o>7)throw"Assertion error";this.mask=o,this.applyMask(o),this.drawFormatBits(o),this.isFunction=[]}return e.encodeText=function(t,r){var n=i.makeSegments(t);return e.encodeSegments(n,r)},e.encodeBinary=function(t,r){var n=i.makeBytes(t);return e.encodeSegments([n],r)},e.encodeSegments=function(t,r,n,o,a,c){if(void 0===n&&(n=1),void 0===o&&(o=40),void 0===a&&(a=-1),void 0===c&&(c=!0),!(e.MIN_VERSION<=n&&n<=o&&o<=e.MAX_VERSION)||a<-1||a>7)throw"Invalid value";var l,p;for(l=n;;l++){var d=8*e.getNumDataCodewords(l,r),u=i.getTotalBits(t,l);if(u<=d){p=u;break}if(l>=o)throw"Data too long"}for(var _=0,h=[e.Ecc.MEDIUM,e.Ecc.QUARTILE,e.Ecc.HIGH];_<h.length;_++){var f=h[_];c&&p<=8*e.getNumDataCodewords(l,f)&&(r=f)}for(var m=new s,g=0,b=t;g<b.length;g++){var v=b[g];m.appendBits(v.mode.modeBits,4),m.appendBits(v.numChars,v.mode.numCharCountBits(l));for(var E=0,w=v.getData();E<w.length;E++){var O=w[E];m.array.push(O)}}if(m.array.length!=p)throw"Assertion error";var y=8*e.getNumDataCodewords(l,r);if(m.array.length>y)throw"Assertion error";if(m.appendBits(0,Math.min(4,y-m.array.length)),m.appendBits(0,(8-m.array.length%8)%8),m.array.length%8!=0)throw"Assertion error";for(var C=236;m.array.length<y;C^=253)m.appendBits(C,8);for(var S=[];8*S.length<m.array.length;)S.push(0);return m.array.forEach((function(e,t){return S[t>>>3]|=e<<7-(7&t)})),new e(l,r,S,a)},e.prototype.getModule=function(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]},e.prototype.drawCanvas=function(e,t,r){if(e<=0||t<0)throw"Value out of range";var n=(this.size+2*t)*e;r.width=n,r.height=n;for(var o=r.getContext("2d"),i=-t;i<this.size+t;i++)for(var a=-t;a<this.size+t;a++)o.fillStyle=this.getModule(a,i)?"#000000":"#FFFFFF",o.fillRect((a+t)*e,(i+t)*e,e,e)},e.prototype.toSvgString=function(e){if(e<0)throw"Border must be non-negative";for(var t=[],r=0;r<this.size;r++)for(var n=0;n<this.size;n++)this.getModule(n,r)&&t.push("M"+(n+e)+","+(r+e)+"h1v1h-1z");return'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+(this.size+2*e)+" "+(this.size+2*e)+'" stroke="none">\n\t<rect width="100%" height="100%" fill="#FFFFFF"/>\n\t<path d="'+t.join(" ")+'" fill="#000000"/>\n</svg>\n'},e.prototype.drawFunctionPatterns=function(){for(var e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);var t=this.getAlignmentPatternPositions(),r=t.length;for(e=0;e<r;e++)for(var n=0;n<r;n++)0==e&&0==n||0==e&&n==r-1||e==r-1&&0==n||this.drawAlignmentPattern(t[e],t[n]);this.drawFormatBits(0),this.drawVersion()},e.prototype.drawFormatBits=function(e){for(var t=this.errorCorrectionLevel.formatBits<<3|e,r=t,n=0;n<10;n++)r=r<<1^1335*(r>>>9);var i=21522^(t<<10|r);if(i>>>15!=0)throw"Assertion error";for(n=0;n<=5;n++)this.setFunctionModule(8,n,o(i,n));for(this.setFunctionModule(8,7,o(i,6)),this.setFunctionModule(8,8,o(i,7)),this.setFunctionModule(7,8,o(i,8)),n=9;n<15;n++)this.setFunctionModule(14-n,8,o(i,n));for(n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,o(i,n));for(n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,o(i,n));this.setFunctionModule(8,this.size-8,!0)},e.prototype.drawVersion=function(){if(!(this.version<7)){for(var e=this.version,t=0;t<12;t++)e=e<<1^7973*(e>>>11);var r=this.version<<12|e;if(r>>>18!=0)throw"Assertion error";for(t=0;t<18;t++){var n=o(r,t),i=this.size-11+t%3,a=Math.floor(t/3);this.setFunctionModule(i,a,n),this.setFunctionModule(a,i,n)}}},e.prototype.drawFinderPattern=function(e,t){for(var r=-4;r<=4;r++)for(var n=-4;n<=4;n++){var o=Math.max(Math.abs(n),Math.abs(r)),i=e+n,a=t+r;0<=i&&i<this.size&&0<=a&&a<this.size&&this.setFunctionModule(i,a,2!=o&&4!=o)}},e.prototype.drawAlignmentPattern=function(e,t){for(var r=-2;r<=2;r++)for(var n=-2;n<=2;n++)this.setFunctionModule(e+n,t+r,1!=Math.max(Math.abs(n),Math.abs(r)))},e.prototype.setFunctionModule=function(e,t,r){this.modules[t][e]=r,this.isFunction[t][e]=!0},e.prototype.addEccAndInterleave=function(t){var r=this.version,n=this.errorCorrectionLevel;if(t.length!=e.getNumDataCodewords(r,n))throw"Invalid argument";for(var o=e.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][r],i=e.ECC_CODEWORDS_PER_BLOCK[n.ordinal][r],s=Math.floor(e.getNumRawDataModules(r)/8),c=o-s%o,l=Math.floor(s/o),p=[],d=new a(i),u=0,_=0;u<o;u++){var h=t.slice(_,_+l-i+(u<c?0:1));_+=h.length;var f=d.getRemainder(h);u<c&&h.push(0),p.push(h.concat(f))}var m=[];for(u=0;u<p[0].length;u++)for(var g=0;g<p.length;g++)(u!=l-i||g>=c)&&m.push(p[g][u]);if(m.length!=s)throw"Assertion error";return m},e.prototype.drawCodewords=function(t){if(t.length!=Math.floor(e.getNumRawDataModules(this.version)/8))throw"Invalid argument";for(var r=0,n=this.size-1;n>=1;n-=2){6==n&&(n=5);for(var i=0;i<this.size;i++)for(var a=0;a<2;a++){var s=n-a,c=0==(n+1&2)?this.size-1-i:i;!this.isFunction[c][s]&&r<8*t.length&&(this.modules[c][s]=o(t[r>>>3],7-(7&r)),r++)}}if(r!=8*t.length)throw"Assertion error"},e.prototype.applyMask=function(e){if(e<0||e>7)throw"Mask value out of range";for(var t=0;t<this.size;t++)for(var r=0;r<this.size;r++){var n=void 0;switch(e){case 0:n=(r+t)%2==0;break;case 1:n=t%2==0;break;case 2:n=r%3==0;break;case 3:n=(r+t)%3==0;break;case 4:n=(Math.floor(r/3)+Math.floor(t/2))%2==0;break;case 5:n=r*t%2+r*t%3==0;break;case 6:n=(r*t%2+r*t%3)%2==0;break;case 7:n=((r+t)%2+r*t%3)%2==0;break;default:throw"Assertion error"}!this.isFunction[t][r]&&n&&(this.modules[t][r]=!this.modules[t][r])}},e.prototype.getPenaltyScore=function(){for(var t=0,r=0;r<this.size;r++){for(var n=[0,0,0,0,0,0,0],o=!1,i=0,a=0;a<this.size;a++)this.modules[r][a]==o?5==++i?t+=e.PENALTY_N1:i>5&&t++:(e.addRunToHistory(i,n),!o&&e.hasFinderLikePattern(n)&&(t+=e.PENALTY_N3),o=this.modules[r][a],i=1);e.addRunToHistory(i,n),o&&e.addRunToHistory(0,n),e.hasFinderLikePattern(n)&&(t+=e.PENALTY_N3)}for(a=0;a<this.size;a++){n=[0,0,0,0,0,0,0],o=!1;var s=0;for(r=0;r<this.size;r++)this.modules[r][a]==o?5==++s?t+=e.PENALTY_N1:s>5&&t++:(e.addRunToHistory(s,n),!o&&e.hasFinderLikePattern(n)&&(t+=e.PENALTY_N3),o=this.modules[r][a],s=1);e.addRunToHistory(s,n),o&&e.addRunToHistory(0,n),e.hasFinderLikePattern(n)&&(t+=e.PENALTY_N3)}for(r=0;r<this.size-1;r++)for(a=0;a<this.size-1;a++)(o=this.modules[r][a])==this.modules[r][a+1]&&o==this.modules[r+1][a]&&o==this.modules[r+1][a+1]&&(t+=e.PENALTY_N2);for(var c=0,l=0,p=this.modules;l<p.length;l++)for(var d=0,u=p[l];d<u.length;d++)(o=u[d])&&c++;var _=this.size*this.size;return t+=(Math.ceil(Math.abs(20*c-10*_)/_)-1)*e.PENALTY_N4},e.prototype.getAlignmentPatternPositions=function(){if(1==this.version)return[];for(var e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((this.size-13)/(2*e-2)),r=[6],n=this.size-7;r.length<e;n-=t)r.splice(1,0,n);return r},e.getNumRawDataModules=function(t){if(t<e.MIN_VERSION||t>e.MAX_VERSION)throw"Version number out of range";var r=(16*t+128)*t+64;if(t>=2){var n=Math.floor(t/7)+2;r-=(25*n-10)*n-55,t>=7&&(r-=36)}return r},e.getNumDataCodewords=function(t,r){return Math.floor(e.getNumRawDataModules(t)/8)-e.ECC_CODEWORDS_PER_BLOCK[r.ordinal][t]*e.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][t]},e.addRunToHistory=function(e,t){t.pop(),t.unshift(e)},e.hasFinderLikePattern=function(e){var t=e[1];return t>0&&e[2]==t&&e[4]==t&&e[5]==t&&e[3]==3*t&&Math.max(e[0],e[6])>=4*t},e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e}();function o(e,t){return 0!=(e>>>t&1)}var i=function(){function e(e,t,r){if(this.mode=e,this.numChars=t,this.bitData=r,t<0)throw"Invalid argument";this.bitData=r.slice()}return e.makeBytes=function(t){for(var r=new s,n=0,o=t;n<o.length;n++){var i=o[n];r.appendBits(i,8)}return new e(e.Mode.BYTE,t.length,r.array)},e.makeNumeric=function(t){if(!this.NUMERIC_REGEX.test(t))throw"String contains non-numeric characters";for(var r=new s,n=0;n<t.length;){var o=Math.min(t.length-n,3);r.appendBits(parseInt(t.substr(n,o),10),3*o+1),n+=o}return new e(e.Mode.NUMERIC,t.length,r.array)},e.makeAlphanumeric=function(t){if(!this.ALPHANUMERIC_REGEX.test(t))throw"String contains unencodable characters in alphanumeric mode";var r,n=new s;for(r=0;r+2<=t.length;r+=2){var o=45*e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r));o+=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r+1)),n.appendBits(o,11)}return r<t.length&&n.appendBits(e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r)),6),new e(e.Mode.ALPHANUMERIC,t.length,n.array)},e.makeSegments=function(t){return""==t?[]:this.NUMERIC_REGEX.test(t)?[e.makeNumeric(t)]:this.ALPHANUMERIC_REGEX.test(t)?[e.makeAlphanumeric(t)]:[e.makeBytes(e.toUtf8ByteArray(t))]},e.makeEci=function(t){var r=new s;if(t<0)throw"ECI assignment value out of range";if(t<128)r.appendBits(t,8);else if(t<16384)r.appendBits(2,2),r.appendBits(t,14);else{if(!(t<1e6))throw"ECI assignment value out of range";r.appendBits(6,3),r.appendBits(t,21)}return new e(e.Mode.ECI,0,r.array)},e.prototype.getData=function(){return this.bitData.slice()},e.getTotalBits=function(e,t){for(var r=0,n=0,o=e;n<o.length;n++){var i=o[n],a=i.mode.numCharCountBits(t);if(i.numChars>=1<<a)return 1/0;r+=4+a+i.bitData.length}return r},e.toUtf8ByteArray=function(e){e=encodeURI(e);for(var t=[],r=0;r<e.length;r++)"%"!=e.charAt(r)?t.push(e.charCodeAt(r)):(t.push(parseInt(e.substr(r+1,2),16)),r+=2);return t},e.NUMERIC_REGEX=/^[0-9]*$/,e.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,e.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e}(),a=function(){function e(t){if(this.coefficients=[],t<1||t>255)throw"Degree out of range";for(var r=this.coefficients,n=0;n<t-1;n++)r.push(0);r.push(1);var o=1;for(n=0;n<t;n++){for(var i=0;i<r.length;i++)r[i]=e.multiply(r[i],o),i+1<r.length&&(r[i]^=r[i+1]);o=e.multiply(o,2)}}return e.prototype.getRemainder=function(t){for(var r=this.coefficients.map((function(e){return 0})),n=function(t){var n=t^r.shift();r.push(0),o.coefficients.forEach((function(t,o){return r[o]^=e.multiply(t,n)}))},o=this,i=0,a=t;i<a.length;i++)n(a[i]);return r},e.multiply=function(e,t){if(e>>>8!=0||t>>>8!=0)throw"Byte out of range";for(var r=0,n=7;n>=0;n--)r=r<<1^285*(r>>>7),r^=(t>>>n&1)*e;if(r>>>8!=0)throw"Assertion error";return r},e}(),s=function(){function e(){this.array=[]}return e.prototype.appendBits=function(e,t){if(t<0||t>31||e>>>t!=0)throw"Value out of range";for(var r=t-1;r>=0;r--)this.array.push(e>>>r&1)},e}();return function(e){var t=function(){function e(e,t){this.ordinal=e,this.formatBits=t}return e.LOW=new e(0,1),e.MEDIUM=new e(1,0),e.QUARTILE=new e(2,3),e.HIGH=new e(3,2),e}();e.Ecc=t}(n||(n={})),function(e){var t=function(){function e(e,t){this.modeBits=e,this.numBitsCharCount=t}return e.prototype.numCharCountBits=function(e){return this.numBitsCharCount[Math.floor((e+7)/17)]},e.NUMERIC=new e(1,[10,12,14]),e.ALPHANUMERIC=new e(2,[9,11,13]),e.BYTE=new e(4,[8,16,16]),e.KANJI=new e(8,[8,10,12]),e.ECI=new e(7,[0,0,0]),e}();e.Mode=t}(i||(i={})),{createQR:function(o,a,s,c){if("string"!=typeof o)throw new TypeError("Enter text for encoding");var l=e(e(e({},"object"==typeof a&&null!==a?a:{}),"object"==typeof c&&null!==c?c:{}),{qrSize:"object"==typeof a&&null!==a&&"number"==typeof a.qrSize?a.qrSize:a,className:"object"==typeof a&&null!==a&&"string"==typeof a.className?a.className:s}),p=[n.Ecc.LOW,n.Ecc.MEDIUM,n.Ecc.QUARTILE,n.Ecc.HIGH],d={qrSize:"number"==typeof l.qrSize?l.qrSize:128,className:"string"==typeof l.className?l.className:s||"",isShowLogo:!!l.isShowLogo||!1,isShowBackground:!!l.isShowBackground||!1,foregroundColor:"string"==typeof l.foregroundColor?l.foregroundColor:"#000000",backgroundColor:"string"==typeof l.backgroundColor?l.backgroundColor:"#ffffff",logoColor:"string"==typeof l.logoColor?l.logoColor:"#4680c2",suffix:l.suffix?l.suffix.toString():"0",logoData:"string"==typeof l.logoData?l.logoData:null,ecc:"number"==typeof l.ecc&&p[l.ecc]?l.ecc:3},u=i.makeSegments(o);return function(e,n){if("number"!=typeof n.qrSize)throw new Error("Size should be a number");if("string"!=typeof n.className)throw new Error("Classname should be a string");for(var o=84.7776815,i=[],a=0,s=0,c=0,l=0,p=0;p<e.size;p++){a=0;for(var d=0;d<e.size;d++){c=d+a,a+=96,l=p+s;var u,_=r(d,p,e.size,e.modules,n.isShowLogo),h="";_.current?(h=!(h=h||_.l||_.r||_.t||_.b?"":"empty")&&_.l&&_.r||_.t&&_.b?"rect":"")||(h+=_.l?"l":_.r?"r":"",(h+=_.t?"t":_.b?"b":"")||(h="empty")):h=!(h=!(h=!(h=!h&&_.l&&_.t&&t(d-1,p-1,e.size,e.modules,n.isShowLogo)?"n_lt":"")&&_.l&&_.b&&t(d-1,p+1,e.size,e.modules,n.isShowLogo)?"n_lb":"")&&_.r&&_.t&&t(d+1,p-1,e.size,e.modules,n.isShowLogo)?"n_rt":"")&&_.r&&_.b&&t(d+1,p+1,e.size,e.modules,n.isShowLogo)?"n_rb":"",h&&(u='<use xlink:href="#'+h+"-"+n.suffix+'"/>',i.push('<g transform="translate('+c+","+l+')">'+u+"</g>"))}s+=96}var f="",m=(e.size-21)/2*96+672-10;e.size<=25&&(f="scale(0.85)",m+=50);var g=96*(e.size-7);i.push('<use fill-rule="evenodd" transform="translate(0,0)" xlink:href="#point-'+n.suffix+'"/>'),i.push('<use fill-rule="evenodd" transform="translate('+g+',0)" xlink:href="#point-'+n.suffix+'"/>'),i.push('<use fill-rule="evenodd" transform="translate(0,'+g+')" xlink:href="#point-'+n.suffix+'"/>'),n.isShowLogo&&(n.logoData?i.push('\n        <image \n          preserveAspectRatio="xMidYMid slice" clip-path="url(#logo-mask-'+n.suffix+')"\n          style="width: 750px; height: 750px;" width="750" height="750" \n          transform="translate('+m+","+m+") "+f+'" \n          xlink:href="'+n.logoData+'" \n        />\n      '):i.push('\n        <use style="width: 750px; height: 750px;" width="750" height="750" \n          fill="none" \n          fill-rule="evenodd" \n          transform="translate('+m+","+m+") "+f+'" xlink:href="#vk_logo-'+n.suffix+'"\n        />\n      '));var b=99*e.size,v="",E="translate(0,0)";if(n.isShowBackground){var w=(n.qrSize-40)/n.qrSize,O=b/n.qrSize*21;v='\n      <rect \n        x="0" \n        width="'+b+'" \n        height="'+b+'" \n        rx="'+Math.ceil(b/(n.qrSize/36))+'" \n        fill="'+n.backgroundColor+'"\n      />',E="translate("+O+", "+O+") scale("+w+")"}var y="M0,0 L66,0 C"+o+",-3.44940413e-15 100,15.2223185 100,34 L100,66 C100,"+o+" "+o+",100 66,100 L0,100 L0,0 Z",C="M0,0 L100,0 L100,66 C100,"+o+" "+o+",100 66,100 L0,100 L0,0 Z";return'\n  <svg \n    version="1.1" \n    viewBox="0 0 '+b+" "+b+'" \n    width="'+n.qrSize+'px" \n    height="'+n.qrSize+'px"\n    '+(n.className?'class="'+n.className+'"':"")+' \n    xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n  >\n    <defs>\n      <rect id="rect-'+n.suffix+'" width="100" height="100" fill="'+n.foregroundColor+'"/>\n      <path \n        id="empty-'+n.suffix+'" \n        d="M0,28.6v42.9C0,87.3,12.8,100,28.6,100h42.9c15.9,0,28.6-12.8,28.6-28.6V28.6C100,12.7,87.2,0,71.4,0H28.6 C12.8,0,0,12.8,0,28.6z"\n        fill="'+n.foregroundColor+'"\n      />\n      <path id="b-'+n.suffix+'" d="'+y+'" transform="rotate(-90 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="r-'+n.suffix+'" d="'+y+'" transform="rotate(-180 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="l-'+n.suffix+'" d="'+y+'" fill="'+n.foregroundColor+'"/>\n      <path id="t-'+n.suffix+'" d="'+y+'" transform="rotate(90 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="l-'+n.suffix+'" d="'+C+'" transform="rotate(-90 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="lt-'+n.suffix+'" d="'+C+'" fill="'+n.foregroundColor+'"/>\n      <path id="lb-'+n.suffix+'" d="'+C+'" transform="rotate(-90 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="rb-'+n.suffix+'" d="'+C+'" transform="rotate(-180 50 50)" fill="'+n.foregroundColor+'"/>\n      <path id="rt-'+n.suffix+'" d="'+C+'" transform="rotate(90 50 50)" fill="'+n.foregroundColor+'"/>\n      <path \n        id="n_lt-'+n.suffix+'" \n        d="M30.5,2V0H0v30.5h2C2,14.7,14.8,2,30.5,2z" \n        fill="'+n.foregroundColor+'"\n      />\n      <path \n        id="n_lb-'+n.suffix+'"\n        d="M2,69.5H0V100h30.5v-2C14.7,98,2,85.2,2,69.5z" \n        fill="'+n.foregroundColor+'"\n      />\n      <path \n        id="n_rt-'+n.suffix+'" \n        d="M98,30.5h2V0H69.5v2C85.3,2,98,14.8,98,30.5z" \n        fill="'+n.foregroundColor+'"\n      />\n      <path id="n_rb-'+n.suffix+'" \n        d="M69.5,98v2H100V69.5h-2C98,85.3,85.2,98,69.5,98z" \n        fill="'+n.foregroundColor+'"\n      />\n      <path \n        id="point-'+n.suffix+'" \n        fill="'+n.foregroundColor+'"\n        d="M600.001786,457.329333 L600.001786,242.658167 C600.001786,147.372368 587.039517,124.122784 581.464617,118.535383 C575.877216,112.960483 552.627632,99.9982143 457.329333,99.9982143 L242.670667,99.9982143 C147.372368,99.9982143 124.122784,112.960483 118.547883,118.535383 C112.972983,124.122784 99.9982143,147.372368 99.9982143,242.658167 L99.9982143,457.329333 C99.9982143,552.627632 112.972983,575.877216 118.547883,581.464617 C124.122784,587.027017 147.372368,600.001786 242.670667,600.001786 L457.329333,600.001786 C552.627632,600.001786 575.877216,587.027017 581.464617,581.464617 C587.039517,575.877216 600.001786,552.627632 600.001786,457.329333 Z M457.329333,0 C653.338333,0 700,46.6616668 700,242.658167 C700,438.667167 700,261.332833 700,457.329333 C700,653.338333 653.338333,700 457.329333,700 C261.332833,700 438.667167,700 242.670667,700 C46.6616668,700 0,653.338333 0,457.329333 C0,261.332833 0,352.118712 0,242.658167 C0,46.6616668 46.6616668,0 242.670667,0 C438.667167,0 261.332833,0 457.329333,0 Z M395.996667,200 C480.004166,200 500,220.008332 500,303.990835 C500,387.998334 500,312.001666 500,395.996667 C500,479.991668 480.004166,500 395.996667,500 C312.001666,500 387.998334,500 304.003333,500 C220.008332,500 200,479.991668 200,395.996667 C200,312.001666 200,350.906061 200,303.990835 C200,220.008332 220.008332,200 304.003333,200 C387.998334,200 312.001666,200 395.996667,200 Z" \n      />\n      <g id="vk_logo-'+n.suffix+'">\n        <path \n          fill="'+n.logoColor+'" \n          d="M253.066667,0 C457.466667,0 272.533333,0 476.933333,0 C681.333333,0 730,48.6666667 730,253.066667 C730,457.466667 730,272.533333 730,476.933333 C730,681.333333 681.333333,730 476.933333,730 C272.533333,730 457.466667,730 253.066667,730 C48.6666667,730 0,681.333333 0,476.933333 C0,272.533333 0,367.206459 0,253.066667 C0,48.6666667 48.6666667,0 253.066667,0 Z"/><path fill="#FFF" d="M597.816744,251.493445 C601.198942,240.214758 597.816746,231.927083 581.719678,231.927083 L528.490512,231.927083 C514.956087,231.927083 508.716524,239.08642 505.332448,246.981031 C505.332448,246.981031 478.263599,312.960647 439.917002,355.818719 C427.510915,368.224806 421.871102,372.172112 415.10389,372.172112 C411.720753,372.172112 406.822917,368.224806 406.822917,356.947057 L406.822917,251.493445 C406.822917,237.95902 402.895137,231.927083 391.615512,231.927083 L307.969678,231.927083 C299.511836,231.927083 294.425223,238.208719 294.425223,244.162063 C294.425223,256.99245 313.597583,259.951287 315.573845,296.043086 L315.573845,374.428788 C315.573845,391.614583 312.470184,394.730425 305.702972,394.730425 C287.658011,394.730425 243.763595,328.456052 217.730151,252.620844 C212.628223,237.881107 207.511068,231.927083 193.907178,231.927083 L140.678012,231.927083 C125.469678,231.927083 122.427826,239.08642 122.427826,246.981031 C122.427826,261.079625 140.473725,331.006546 206.452402,423.489903 C250.437874,486.648674 312.410515,520.885417 368.803012,520.885417 C402.638134,520.885417 406.823845,513.28125 406.823845,500.183098 L406.823845,452.447917 C406.823845,437.239583 410.029185,434.204421 420.743703,434.204421 C428.638315,434.204421 442.172739,438.151727 473.753063,468.603713 C509.843923,504.694573 515.79398,520.885417 536.094678,520.885417 L589.323845,520.885417 C604.532178,520.885417 612.136345,513.28125 607.749619,498.274853 C602.949226,483.318593 585.717788,461.619053 562.853283,435.89599 C550.446258,421.234166 531.837128,405.444943 526.197316,397.548454 C518.302704,387.399043 520.558441,382.88663 526.197316,373.864619 C526.197316,373.864619 591.049532,282.508661 597.816744,251.493445 Z"\n        />\n      </g>\n      <clipPath id="logo-mask-'+n.suffix+'">\n        <rect x="0" y="0" width="750" height="750" />\n      </clipPath>\n    </defs>\n\n    '+v+'\n\n    <g transform="'+E+'">\n      '+i.join("\n")+"\n    </g>\n  </svg>"}(n.encodeSegments(u,p[d.ecc],1,40,-1,!0),d)}}}()},wx14:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.r(t),r.d(t,"default",(function(){return n}))},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3"),o=[{title:"photos_pe_crop_aspect_free",value:0},{title:"photos_pe_crop_aspect_original",value:-1},{title:"photos_pe_crop_aspect_16_9",value:16/9},{title:"photos_pe_crop_aspect_4_3",value:4/3},{title:"photos_pe_crop_aspect_1_1",value:1},{title:"photos_pe_crop_aspect_3_4",value:3/4},{title:"photos_pe_crop_aspect_9_16",value:9/16}];t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_THUMB:"thumb",STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#FF3301","#FF8C49","#F9D827","#2EBA48","#4189E8","#9F4BED","#69E4B3","#FF84A0","#F7A978","#F8786C","#8B3232","#93B658","#556E35","#5B4490","#1B1B1B","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro","impact","lobster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","contrast","saturation","warmth","vignette","sharpness","grain"],BLUR_TYPES:{ROUND:"round",RECTANGULAR:"rectangular"},AVERAGE_COLORS_MAP:[{s:12,v:-40},{s:9,v:-30},{s:6,v:-20},{s:3,v:-10},{s:0,v:0},{s:-3,v:10},{s:-6,v:20},{s:-9,v:30},{s:-12,v:40}],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image",BACKGROUND:"background"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:95,DRAWING_PREVIEW_WIDTH:270,DRAWING_PREVIEW_HEIGHT:110,CROP_MIN_SIZE:100,CROP_SIDES:{CENTER:"center",NW:"nw",NE:"ne",SW:"sw",SE:"se",N:"n",S:"s",W:"w",E:"e"},CROP_ASPECTS:o,CROP_ASPECT_FREE:0,CROP_ASPECT_ORIGINAL:-1}},xo6n:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return p}));r("KKXr"),r("Vd3H"),r("rGqo"),r("Btvt"),r("91GP");var n=r("UlUB"),o=r("gF8j"),i={id:"active_time",triggerEvents:"mouseover mousedown keypress",timeout:15e3,maxChainInterval:0,doesScrollTriggerIdle:!1,callback:()=>{}};var a=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._timeChainStart=void 0,this._timeStart=0,this._timeActivityStart=0,this._sumActiveTime=0,this.opts=Object.assign({},i,e),this._idle=new o.default({id:this.opts.id,element:document,focusElement:window,triggerEvents:this.opts.triggerEvents,idleTimeout:this.opts.timeout}),window.addEventListener("beforeunload",this._onTabClose.bind(this)),this.opts.doesScrollTriggerIdle&&window.addEventListener("scroll",Object(n.throttle)(this._onScroll.bind(this),this.opts.timeout)),this._idle.on("idle",this._onTabInactive.bind(this)),this._idle.on("unidle",this._onTabActive.bind(this)),this._idle.start(),this._timeChainStart=Date.now(),document.activeElement===document.body&&this.start()}_checkTimeLimit(){this._timeStart&&this.opts.maxChainInterval&&(Date.now()-this._timeStart>this.opts.maxChainInterval&&this.endInterval())}_sessionEnd(){this.opts.callback(this.getData())}getData(){var e=Date.now(),t=this._sumActiveTime;return this._timeActivityStart&&(t+=e-this._timeActivityStart),{timeChainStart:this._timeChainStart,timeStart:this._timeStart,timeEnd:e,activeTime:t}}_onTabActive(){this.start()}_onTabInactive(){this.stop()}_onTabClose(){this.endInterval()}_onScroll(){this._idle.unidle(),clearTimeout(this._idleTimeoutHandler),this._idleTimeoutHandler=setTimeout(()=>this._idle.idle(),2*this.opts.timeout)}stop(){this._timeActivityStart&&(this._sumActiveTime+=Date.now()-this._timeActivityStart,this._checkTimeLimit(),this._timeActivityStart=0)}start(){if(this._checkTimeLimit(),!this._timeActivityStart){var e=Date.now();this._timeStart||(this._timeStart=e),this._timeActivityStart=e}}resetToNewTimer(){this._timeStart=0,this._sumActiveTime=0,this._timeActivityStart=0}endInterval(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._timeActivityStart?(e&&this._sessionEnd(),this._idle.stop(),this.resetToNewTimer(),this):this}startInterval(){return this._idle.start(),this.start(),this}},s=r("J8bf"),c=r("W0P9"),l={triggerEvents:"mousemove keydown keypress",timeout:18e4};class p{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.opts=Object.assign({},l,t),this.activeTime=null,this.sessionId=null,this.sessions={},this.appId=e,this.lastIdleTs=0}start(){this._loadSessions(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] started with session id",this.sessionId),this.activeTime=new a({id:"app_"+this.appId,triggerEvents:this.opts.triggerEvents,timeout:this.opts.timeout,doesScrollTriggerIdle:!0,callback:this._saveSession.bind(this)}),this.activeTime._idle.on("idle",this._onIdle.bind(this)),this.activeTime._idle.on("unidle",this._onUnIdle.bind(this)),this.activeTime.start()}stop(){Object(c.log)("[AppSessionTimeLogger] stopped."),this.activeTime&&(this.activeTime.endInterval(),this.activeTime.stop(),this.sessions={},this.activeTime=null)}idle(){this.activeTime&&this.activeTime._idle.cbInactive()}unIdle(){this.activeTime&&this.activeTime._idle.cbActive()}_clearOldSessions(){var e=Object.keys(this.sessions);e.length>10&&(e.sort((e,t)=>{var r=+e.split("_")[1];return+t.split("_")[1]-r}),e.slice(10).forEach(e=>{delete this.sessions[e],Object(c.log)("[AppSessionTimeLogger] deleted old session",e)}))}_saveSession(){this._logSession(),Object(s.setCookie)("remixapp_session",JSON.stringify(this.sessions),.01)}_logSession(){if(this.sessionId&&this.activeTime){this._clearOldSessions();var e=this.activeTime.getData().activeTime;(e=Math.round(e/1e3))>0&&(this.sessions[this.sessionId]=e),Object(c.log)("[AppSessionTimeLogger] Log sessions:",this.sessions)}}_onIdle(){this.lastIdleTs=Date.now()}_onUnIdle(){this.activeTime&&(this.lastIdleTs&&Date.now()-this.lastIdleTs>this.opts.timeout&&(this.activeTime.endInterval(),this.activeTime.startInterval(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] last session is ended after timeout",this.opts.timeout),Object(c.log)("[AppSessionTimeLogger] start new session with id",this.sessionId)),this.lastIdleTs=0)}_getSessionId(){return`${this.appId}_${Date.now()}`}_loadSessions(){var e=Object(s.getCookie)("remixapp_session");if(e)try{this.sessions=JSON.parse(e)}catch(e){this.sessions={}}Object(c.log)("[AppSessionTimeLogger] Load old sessions from cookie",this.sessions)}}},z9Td:function(e,t,r){"use strict";r.r(t),r.d(t,"PLATFORM_MVK",(function(){return n}));var n="mvk"},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}r.r(t),r.d(t,"default",(function(){return n}))}});